(()=>{var t,e,s={12:(t,e,s)=>{"use strict";const r=s(8311);t.exports=(t,e)=>new r(t,e).set.map((t=>t.map((t=>t.value)).join(" ").trim().split(" ")))},144:(t,e,s)=>{"use strict";const r=s(3908);t.exports=(t,e,s=!1)=>{if(t instanceof r)return t;try{return new r(t,e)}catch(t){if(!s)return null;throw t}}},181:t=>{"use strict";t.exports=require("buffer")},270:(t,e,s)=>{"use strict";const r=s(3908),i=s(8311);t.exports=(t,e,s)=>{let n=null,o=null,a=null;try{a=new i(e,s)}catch(t){return null}return t.forEach((t=>{a.test(t)&&(n&&1!==o.compare(t)||(n=t,o=new r(n,s)))})),n}},321:function(t,e,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,s,r){void 0===r&&(r=s);var i=Object.getOwnPropertyDescriptor(e,s);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[s]}}),Object.defineProperty(t,r,i)}:function(t,e,s,r){void 0===r&&(r=s),t[r]=e[s]}),i=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),n=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var s in t)"default"!==s&&Object.prototype.hasOwnProperty.call(t,s)&&r(e,t,s);return i(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.possibleElisions=e.simpleRegularExpression=e.ADDRESS_BOUNDARY=e.padGroup=e.groupPossibilities=void 0;const o=n(s(8914)),a=s(7604);function h(t){return(0,a.sprintf)("(%s)",t.join("|"))}function l(t){return t.length<4?(0,a.sprintf)("0{0,%d}%s",4-t.length,t):t}e.groupPossibilities=h,e.padGroup=l,e.ADDRESS_BOUNDARY="[^A-Fa-f0-9:]",e.simpleRegularExpression=function(t){const e=[];t.forEach(((t,s)=>{0===parseInt(t,16)&&e.push(s)}));const s=e.map((e=>t.map(((t,s)=>{if(s===e){const e=0===s||s===o.GROUPS-1?":":"";return h([l(t),e])}return l(t)})).join(":")));return s.push(t.map(l).join(":")),h(s)},e.possibleElisions=function(t,e,s){const r=e?"":":",i=s?"":":",n=[];e||s||n.push("::"),e&&s&&n.push(""),(s&&!e||!s&&e)&&n.push(":"),n.push((0,a.sprintf)("%s(:0{1,4}){1,%d}",r,t-1)),n.push((0,a.sprintf)("(0{1,4}:){1,%d}%s",t-1,i)),n.push((0,a.sprintf)("(0{1,4}:){%d}0{1,4}",t-1));for(let e=1;e<t-1;e++)for(let s=1;s<t-e;s++)n.push((0,a.sprintf)("(0{1,4}:){%d}:(0{1,4}:){%d}0{1,4}",s,t-s-e-1));return h(n)}},560:(t,e,s)=>{"use strict";const r=s(3908);t.exports=(t,e,s)=>new r(t,s).compare(new r(e,s))},837:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isCorrect=e.isInSubnet=void 0,e.isInSubnet=function(t){return!(this.subnetMask<t.subnetMask)&&this.mask(t.subnetMask)===t.mask()},e.isCorrect=function(t){return function(){return this.addressMinusSuffix===this.correctForm()&&(this.subnetMask===t&&!this.parsedSubnet||this.parsedSubnet===String(this.subnetMask))}}},857:t=>{"use strict";t.exports=require("os")},909:(t,e,s)=>{"use strict";const r=s(3908);t.exports=(t,e,s)=>{const i=new r(t,s),n=new r(e,s);return i.compare(n)||i.compareBuild(n)}},1123:t=>{"use strict";const e=/^[0-9]+$/,s=(t,s)=>{const r=e.test(t),i=e.test(s);return r&&i&&(t=+t,s=+s),t===s?0:r&&!i?-1:i&&!r?1:t<s?-1:1};t.exports={compareIdentifiers:s,rcompareIdentifiers:(t,e)=>s(e,t)}},1182:function(t,e,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,s,r){void 0===r&&(r=s);var i=Object.getOwnPropertyDescriptor(e,s);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[s]}}),Object.defineProperty(t,r,i)}:function(t,e,s,r){void 0===r&&(r=s),t[r]=e[s]}),i=this&&this.__exportStar||function(t,e){for(var s in t)"default"===s||Object.prototype.hasOwnProperty.call(e,s)||r(e,t,s)},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(s(9912));i(s(9912),e),e.default=o.default},1261:(t,e,s)=>{"use strict";const r=s(3908),i=s(8311),n=s(5580);t.exports=(t,e)=>{t=new i(t,e);let s=new r("0.0.0");if(t.test(s))return s;if(s=new r("0.0.0-0"),t.test(s))return s;s=null;for(let e=0;e<t.set.length;++e){const i=t.set[e];let o=null;i.forEach((t=>{const e=new r(t.semver.version);switch(t.operator){case">":0===e.prerelease.length?e.patch++:e.prerelease.push(0),e.raw=e.format();case"":case">=":o&&!n(e,o)||(o=e);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${t.operator}`)}})),!o||s&&!n(s,o)||(s=o)}return s&&t.test(s)?s:null}},1725:(t,e,s)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=s(181),i={INVALID_ENCODING:"Invalid encoding provided. Please specify a valid encoding the internal Node.js Buffer supports.",INVALID_SMARTBUFFER_SIZE:"Invalid size provided. Size must be a valid integer greater than zero.",INVALID_SMARTBUFFER_BUFFER:"Invalid Buffer provided in SmartBufferOptions.",INVALID_SMARTBUFFER_OBJECT:"Invalid SmartBufferOptions object supplied to SmartBuffer constructor or factory methods.",INVALID_OFFSET:"An invalid offset value was provided.",INVALID_OFFSET_NON_NUMBER:"An invalid offset value was provided. A numeric value is required.",INVALID_LENGTH:"An invalid length value was provided.",INVALID_LENGTH_NON_NUMBER:"An invalid length value was provived. A numeric value is required.",INVALID_TARGET_OFFSET:"Target offset is beyond the bounds of the internal SmartBuffer data.",INVALID_TARGET_LENGTH:"Specified length value moves cursor beyong the bounds of the internal SmartBuffer data.",INVALID_READ_BEYOND_BOUNDS:"Attempted to read beyond the bounds of the managed data.",INVALID_WRITE_BEYOND_BOUNDS:"Attempted to write beyond the bounds of the managed data."};function n(t){return"number"==typeof t&&isFinite(t)&&function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}(t)}function o(t,e){if("number"!=typeof t)throw new Error(e?i.INVALID_OFFSET_NON_NUMBER:i.INVALID_LENGTH_NON_NUMBER);if(!n(t)||t<0)throw new Error(e?i.INVALID_OFFSET:i.INVALID_LENGTH)}e.ERRORS=i,e.checkEncoding=function(t){if(!r.Buffer.isEncoding(t))throw new Error(i.INVALID_ENCODING)},e.isFiniteInteger=n,e.checkLengthValue=function(t){o(t,!1)},e.checkOffsetValue=function(t){o(t,!0)},e.checkTargetOffset=function(t,e){if(t<0||t>e.length)throw new Error(i.INVALID_TARGET_OFFSET)},e.bigIntAndBufferInt64Check=function(t){if("undefined"==typeof BigInt)throw new Error("Platform does not support JS BigInt type.");if(void 0===r.Buffer.prototype[t])throw new Error(`Platform does not support Buffer.prototype.${t}.`)}},1729:(t,e,s)=>{"use strict";const r=s(144);t.exports=(t,e)=>{const s=r(t,e);return s&&s.prerelease.length?s.prerelease:null}},1763:(t,e,s)=>{"use strict";const r=s(560);t.exports=(t,e)=>r(t,e,!0)},1832:(t,e,s)=>{"use strict";const r=s(144);t.exports=(t,e)=>{const s=r(t,null,!0),i=r(e,null,!0),n=s.compare(i);if(0===n)return null;const o=n>0,a=o?s:i,h=o?i:s,l=!!a.prerelease.length;if(h.prerelease.length&&!l){if(!h.patch&&!h.minor)return"major";if(0===h.compareMain(a))return h.minor&&!h.patch?"minor":"patch"}const c=l?"pre":"";return s.major!==i.major?c+"major":s.minor!==i.minor?c+"minor":s.patch!==i.patch?c+"patch":"prerelease"}},2111:(t,e,s)=>{"use strict";const r=s(4641),i=s(3999),n=s(5580),o=s(4089),a=s(7059),h=s(5200);t.exports=(t,e,s,l)=>{switch(e){case"===":return"object"==typeof t&&(t=t.version),"object"==typeof s&&(s=s.version),t===s;case"!==":return"object"==typeof t&&(t=t.version),"object"==typeof s&&(s=s.version),t!==s;case"":case"=":case"==":return r(t,s,l);case"!=":return i(t,s,l);case">":return n(t,s,l);case">=":return o(t,s,l);case"<":return a(t,s,l);case"<=":return h(t,s,l);default:throw new TypeError(`Invalid operator: ${e}`)}}},2203:t=>{"use strict";t.exports=require("stream")},2437:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AddressError=void 0;class s extends Error{constructor(t,e){super(t),this.name="AddressError",null!==e&&(this.parseMessage=e)}}e.AddressError=s},2525:(t,e,s)=>{"use strict";const r=s(7638),i=s(560);t.exports=(t,e,s)=>{const n=[];let o=null,a=null;const h=t.sort(((t,e)=>i(t,e,s)));for(const t of h)r(t,e,s)?(a=t,o||(o=t)):(a&&n.push([o,a]),a=null,o=null);o&&n.push([o,null]);const l=[];for(const[t,e]of n)t===e?l.push(t):e||t!==h[0]?e?t===h[0]?l.push(`<=${e}`):l.push(`${t} - ${e}`):l.push(`>=${t}`):l.push("*");const c=l.join(" || "),u="string"==typeof e.raw?e.raw:String(e);return c.length<u.length?c:e}},2839:function(t,e,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,s,r){void 0===r&&(r=s);var i=Object.getOwnPropertyDescriptor(e,s);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[s]}}),Object.defineProperty(t,r,i)}:function(t,e,s,r){void 0===r&&(r=s),t[r]=e[s]}),i=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),n=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var s in t)"default"!==s&&Object.prototype.hasOwnProperty.call(t,s)&&r(e,t,s);return i(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.Address4=void 0;const o=n(s(837)),a=n(s(9576)),h=s(2437),l=s(9534),c=s(7604);class u{constructor(t){this.groups=a.GROUPS,this.parsedAddress=[],this.parsedSubnet="",this.subnet="/32",this.subnetMask=32,this.v4=!0,this.isCorrect=o.isCorrect(a.BITS),this.isInSubnet=o.isInSubnet,this.address=t;const e=a.RE_SUBNET_STRING.exec(t);if(e){if(this.parsedSubnet=e[0].replace("/",""),this.subnetMask=parseInt(this.parsedSubnet,10),this.subnet=`/${this.subnetMask}`,this.subnetMask<0||this.subnetMask>a.BITS)throw new h.AddressError("Invalid subnet mask.");t=t.replace(a.RE_SUBNET_STRING,"")}this.addressMinusSuffix=t,this.parsedAddress=this.parse(t)}static isValid(t){try{return new u(t),!0}catch(t){return!1}}parse(t){const e=t.split(".");if(!t.match(a.RE_ADDRESS))throw new h.AddressError("Invalid IPv4 address.");return e}correctForm(){return this.parsedAddress.map((t=>parseInt(t,10))).join(".")}static fromHex(t){const e=t.replace(/:/g,"").padStart(8,"0"),s=[];let r;for(r=0;r<8;r+=2){const t=e.slice(r,r+2);s.push(parseInt(t,16))}return new u(s.join("."))}static fromInteger(t){return u.fromHex(t.toString(16))}static fromArpa(t){const e=t.replace(/(\.in-addr\.arpa)?\.$/,"").split(".").reverse().join(".");return new u(e)}toHex(){return this.parsedAddress.map((t=>(0,c.sprintf)("%02x",parseInt(t,10)))).join(":")}toArray(){return this.parsedAddress.map((t=>parseInt(t,10)))}toGroup6(){const t=[];let e;for(e=0;e<a.GROUPS;e+=2){const s=(0,c.sprintf)("%02x%02x",parseInt(this.parsedAddress[e],10),parseInt(this.parsedAddress[e+1],10));t.push((0,c.sprintf)("%x",parseInt(s,16)))}return t.join(":")}bigInteger(){return new l.BigInteger(this.parsedAddress.map((t=>(0,c.sprintf)("%02x",parseInt(t,10)))).join(""),16)}_startAddress(){return new l.BigInteger(this.mask()+"0".repeat(a.BITS-this.subnetMask),2)}startAddress(){return u.fromBigInteger(this._startAddress())}startAddressExclusive(){const t=new l.BigInteger("1");return u.fromBigInteger(this._startAddress().add(t))}_endAddress(){return new l.BigInteger(this.mask()+"1".repeat(a.BITS-this.subnetMask),2)}endAddress(){return u.fromBigInteger(this._endAddress())}endAddressExclusive(){const t=new l.BigInteger("1");return u.fromBigInteger(this._endAddress().subtract(t))}static fromBigInteger(t){return u.fromInteger(parseInt(t.toString(),10))}mask(t){return void 0===t&&(t=this.subnetMask),this.getBitsBase2(0,t)}getBitsBase2(t,e){return this.binaryZeroPad().slice(t,e)}reverseForm(t){t||(t={});const e=this.correctForm().split(".").reverse().join(".");return t.omitSuffix?e:(0,c.sprintf)("%s.in-addr.arpa.",e)}isMulticast(){return this.isInSubnet(new u("224.0.0.0/4"))}binaryZeroPad(){return this.bigInteger().toString(2).padStart(a.BITS,"0")}groupForV6(){const t=this.parsedAddress;return this.address.replace(a.RE_ADDRESS,(0,c.sprintf)('<span class="hover-group group-v4 group-6">%s</span>.<span class="hover-group group-v4 group-7">%s</span>',t.slice(0,2).join("."),t.slice(2,4).join(".")))}}e.Address4=u},2846:(t,e,s)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.simpleGroup=e.spanLeadingZeroes=e.spanAll=e.spanAllZeroes=void 0;const r=s(7604);function i(t){return t.replace(/(0+)/g,'<span class="zero">$1</span>')}function n(t){return t.replace(/^(0+)/,'<span class="zero">$1</span>')}e.spanAllZeroes=i,e.spanAll=function(t,e=0){return t.split("").map(((t,s)=>(0,r.sprintf)('<span class="digit value-%s position-%d">%s</span>',t,s+e,i(t)))).join("")},e.spanLeadingZeroes=function(t){return t.split(":").map((t=>n(t))).join(":")},e.simpleGroup=function(t,e=0){return t.split(":").map(((t,s)=>/group-v4/.test(t)?t:(0,r.sprintf)('<span class="hover-group group-%d">%s</span>',s+e,n(t))))}},2938:(t,e,s)=>{"use strict";const r=s(3908);t.exports=(t,e)=>new r(t,e).major},3007:(t,e,s)=>{"use strict";const r=s(3908);t.exports=(t,e,s,i,n)=>{"string"==typeof s&&(n=i,i=s,s=void 0);try{return new r(t instanceof r?t.version:t,s).inc(e,i,n).version}catch(t){return null}}},3193:t=>{"use strict";t.exports=require("string_decoder")},3763:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.shuffleArray=e.SocksClientError=void 0;class s extends Error{constructor(t,e){super(t),this.options=e}}e.SocksClientError=s,e.shuffleArray=function(t){for(let e=t.length-1;e>0;e--){const s=Math.floor(Math.random()*(e+1));[t[e],t[s]]=[t[s],t[e]]}}},3874:(t,e,s)=>{"use strict";const r=s(8311);t.exports=(t,e)=>{try{return new r(t,e).range||"*"}catch(t){return null}}},3904:(t,e,s)=>{"use strict";const r=Symbol("SemVer ANY");class i{static get ANY(){return r}constructor(t,e){if(e=n(e),t instanceof i){if(t.loose===!!e.loose)return t;t=t.value}t=t.trim().split(/\s+/).join(" "),l("comparator",t,e),this.options=e,this.loose=!!e.loose,this.parse(t),this.semver===r?this.value="":this.value=this.operator+this.semver.version,l("comp",this)}parse(t){const e=this.options.loose?o[a.COMPARATORLOOSE]:o[a.COMPARATOR],s=t.match(e);if(!s)throw new TypeError(`Invalid comparator: ${t}`);this.operator=void 0!==s[1]?s[1]:"","="===this.operator&&(this.operator=""),s[2]?this.semver=new c(s[2],this.options.loose):this.semver=r}toString(){return this.value}test(t){if(l("Comparator.test",t,this.options.loose),this.semver===r||t===r)return!0;if("string"==typeof t)try{t=new c(t,this.options)}catch(t){return!1}return h(t,this.operator,this.semver,this.options)}intersects(t,e){if(!(t instanceof i))throw new TypeError("a Comparator is required");return""===this.operator?""===this.value||new u(t.value,e).test(this.value):""===t.operator?""===t.value||new u(this.value,e).test(t.semver):!((e=n(e)).includePrerelease&&("<0.0.0-0"===this.value||"<0.0.0-0"===t.value)||!e.includePrerelease&&(this.value.startsWith("<0.0.0")||t.value.startsWith("<0.0.0"))||(!this.operator.startsWith(">")||!t.operator.startsWith(">"))&&(!this.operator.startsWith("<")||!t.operator.startsWith("<"))&&(this.semver.version!==t.semver.version||!this.operator.includes("=")||!t.operator.includes("="))&&!(h(this.semver,"<",t.semver,e)&&this.operator.startsWith(">")&&t.operator.startsWith("<"))&&!(h(this.semver,">",t.semver,e)&&this.operator.startsWith("<")&&t.operator.startsWith(">")))}}t.exports=i;const n=s(8587),{safeRe:o,t:a}=s(9718),h=s(2111),l=s(7272),c=s(3908),u=s(8311)},3908:(t,e,s)=>{"use strict";const r=s(7272),{MAX_LENGTH:i,MAX_SAFE_INTEGER:n}=s(6874),{safeRe:o,t:a}=s(9718),h=s(8587),{compareIdentifiers:l}=s(1123);class c{constructor(t,e){if(e=h(e),t instanceof c){if(t.loose===!!e.loose&&t.includePrerelease===!!e.includePrerelease)return t;t=t.version}else if("string"!=typeof t)throw new TypeError(`Invalid version. Must be a string. Got type "${typeof t}".`);if(t.length>i)throw new TypeError(`version is longer than ${i} characters`);r("SemVer",t,e),this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease;const s=t.trim().match(e.loose?o[a.LOOSE]:o[a.FULL]);if(!s)throw new TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+s[1],this.minor=+s[2],this.patch=+s[3],this.major>n||this.major<0)throw new TypeError("Invalid major version");if(this.minor>n||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>n||this.patch<0)throw new TypeError("Invalid patch version");s[4]?this.prerelease=s[4].split(".").map((t=>{if(/^[0-9]+$/.test(t)){const e=+t;if(e>=0&&e<n)return e}return t})):this.prerelease=[],this.build=s[5]?s[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(r("SemVer.compare",this.version,this.options,t),!(t instanceof c)){if("string"==typeof t&&t===this.version)return 0;t=new c(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof c||(t=new c(t,this.options)),l(this.major,t.major)||l(this.minor,t.minor)||l(this.patch,t.patch)}comparePre(t){if(t instanceof c||(t=new c(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let e=0;do{const s=this.prerelease[e],i=t.prerelease[e];if(r("prerelease compare",e,s,i),void 0===s&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===s)return-1;if(s!==i)return l(s,i)}while(++e)}compareBuild(t){t instanceof c||(t=new c(t,this.options));let e=0;do{const s=this.build[e],i=t.build[e];if(r("build compare",e,s,i),void 0===s&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===s)return-1;if(s!==i)return l(s,i)}while(++e)}inc(t,e,s){if(t.startsWith("pre")){if(!e&&!1===s)throw new Error("invalid increment argument: identifier is empty");if(e){const t=`-${e}`.match(this.options.loose?o[a.PRERELEASELOOSE]:o[a.PRERELEASE]);if(!t||t[1]!==e)throw new Error(`invalid identifier: ${e}`)}}switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e,s);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e,s);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e,s),this.inc("pre",e,s);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",e,s),this.inc("pre",e,s);break;case"release":if(0===this.prerelease.length)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{const t=Number(s)?1:0;if(0===this.prerelease.length)this.prerelease=[t];else{let r=this.prerelease.length;for(;--r>=0;)"number"==typeof this.prerelease[r]&&(this.prerelease[r]++,r=-2);if(-1===r){if(e===this.prerelease.join(".")&&!1===s)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(t)}}if(e){let r=[e,t];!1===s&&(r=[e]),0===l(this.prerelease[0],e)?isNaN(this.prerelease[1])&&(this.prerelease=r):this.prerelease=r}break}default:throw new Error(`invalid increment argument: ${t}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}t.exports=c},3927:(t,e,s)=>{"use strict";const r=s(909);t.exports=(t,e)=>t.sort(((t,s)=>r(t,s,e)))},3999:(t,e,s)=>{"use strict";const r=s(560);t.exports=(t,e,s)=>0!==r(t,e,s)},4089:(t,e,s)=>{"use strict";const r=s(560);t.exports=(t,e,s)=>r(t,e,s)>=0},4277:(t,e,s)=>{"use strict";const r=s(909);t.exports=(t,e)=>t.sort(((t,s)=>r(s,t,e)))},4434:t=>{"use strict";t.exports=require("events")},4493:(t,e,s)=>{"use strict";const r=s(3908);t.exports=(t,e)=>new r(t,e).patch},4615:(t,e,s)=>{"use strict";const{Transform:r}=s(2203),{StringDecoder:i}=s(3193),n=Symbol("last"),o=Symbol("decoder");function a(t,e,s){let r;if(this.overflow){if(r=this[o].write(t).split(this.matcher),1===r.length)return s();r.shift(),this.overflow=!1}else this[n]+=this[o].write(t),r=this[n].split(this.matcher);this[n]=r.pop();for(let t=0;t<r.length;t++)try{l(this,this.mapper(r[t]))}catch(t){return s(t)}this.overflow=this[n].length>this.maxLength,!this.overflow||this.skipOverflow?s():s(new Error("maximum buffer reached"))}function h(t){if(this[n]+=this[o].end(),this[n])try{l(this,this.mapper(this[n]))}catch(e){return t(e)}t()}function l(t,e){void 0!==e&&t.push(e)}function c(t){return t}t.exports=function(t,e,s){switch(t=t||/\r?\n/,e=e||c,s=s||{},arguments.length){case 1:"function"==typeof t?(e=t,t=/\r?\n/):"object"!=typeof t||t instanceof RegExp||t[Symbol.split]||(s=t,t=/\r?\n/);break;case 2:"function"==typeof t?(s=e,e=t,t=/\r?\n/):"object"==typeof e&&(s=e,e=c)}(s=Object.assign({},s)).autoDestroy=!0,s.transform=a,s.flush=h,s.readableObjectMode=!0;const l=new r(s);return l[n]="",l[o]=new i("utf8"),l.matcher=t,l.mapper=e,l.maxLength=s.maxLength,l.skipOverflow=s.skipOverflow||!1,l.overflow=!1,l._destroy=function(t,e){this._writableState.errorEmitted=!1,e(t)},l}},4641:(t,e,s)=>{"use strict";const r=s(560);t.exports=(t,e,s)=>0===r(t,e,s)},5032:(t,e,s)=>{"use strict";const r=s(8311),i=s(3904),{ANY:n}=i,o=s(7638),a=s(560),h=[new i(">=0.0.0-0")],l=[new i(">=0.0.0")],c=(t,e,s)=>{if(t===e)return!0;if(1===t.length&&t[0].semver===n){if(1===e.length&&e[0].semver===n)return!0;t=s.includePrerelease?h:l}if(1===e.length&&e[0].semver===n){if(s.includePrerelease)return!0;e=l}const r=new Set;let i,c,p,f,m,g,E;for(const e of t)">"===e.operator||">="===e.operator?i=u(i,e,s):"<"===e.operator||"<="===e.operator?c=d(c,e,s):r.add(e.semver);if(r.size>1)return null;if(i&&c){if(p=a(i.semver,c.semver,s),p>0)return null;if(0===p&&(">="!==i.operator||"<="!==c.operator))return null}for(const t of r){if(i&&!o(t,String(i),s))return null;if(c&&!o(t,String(c),s))return null;for(const r of e)if(!o(t,String(r),s))return!1;return!0}let S=!(!c||s.includePrerelease||!c.semver.prerelease.length)&&c.semver,w=!(!i||s.includePrerelease||!i.semver.prerelease.length)&&i.semver;S&&1===S.prerelease.length&&"<"===c.operator&&0===S.prerelease[0]&&(S=!1);for(const t of e){if(E=E||">"===t.operator||">="===t.operator,g=g||"<"===t.operator||"<="===t.operator,i)if(w&&t.semver.prerelease&&t.semver.prerelease.length&&t.semver.major===w.major&&t.semver.minor===w.minor&&t.semver.patch===w.patch&&(w=!1),">"===t.operator||">="===t.operator){if(f=u(i,t,s),f===t&&f!==i)return!1}else if(">="===i.operator&&!o(i.semver,String(t),s))return!1;if(c)if(S&&t.semver.prerelease&&t.semver.prerelease.length&&t.semver.major===S.major&&t.semver.minor===S.minor&&t.semver.patch===S.patch&&(S=!1),"<"===t.operator||"<="===t.operator){if(m=d(c,t,s),m===t&&m!==c)return!1}else if("<="===c.operator&&!o(c.semver,String(t),s))return!1;if(!t.operator&&(c||i)&&0!==p)return!1}return!(i&&g&&!c&&0!==p||c&&E&&!i&&0!==p||w||S)},u=(t,e,s)=>{if(!t)return e;const r=a(t.semver,e.semver,s);return r>0?t:r<0||">"===e.operator&&">="===t.operator?e:t},d=(t,e,s)=>{if(!t)return e;const r=a(t.semver,e.semver,s);return r<0?t:r>0||"<"===e.operator&&"<="===t.operator?e:t};t.exports=(t,e,s={})=>{if(t===e)return!0;t=new r(t,s),e=new r(e,s);let i=!1;t:for(const r of t.set){for(const t of e.set){const e=c(r,t,s);if(i=i||null!==e,e)continue t}if(i)return!1}return!0}},5200:(t,e,s)=>{"use strict";const r=s(560);t.exports=(t,e,s)=>r(t,e,s)<=0},5317:t=>{"use strict";t.exports=require("child_process")},5342:(t,e,s)=>{"use strict";const r=s(7075);t.exports=(t,e,s)=>r(t,e,"<",s)},5438:(t,e)=>{"use strict";var s,r,i,n,o,a;Object.defineProperty(e,"__esModule",{value:!0}),e.SOCKS5_NO_ACCEPTABLE_AUTH=e.SOCKS5_CUSTOM_AUTH_END=e.SOCKS5_CUSTOM_AUTH_START=e.SOCKS_INCOMING_PACKET_SIZES=e.SocksClientState=e.Socks5Response=e.Socks5HostType=e.Socks5Auth=e.Socks4Response=e.SocksCommand=e.ERRORS=e.DEFAULT_TIMEOUT=void 0,e.DEFAULT_TIMEOUT=3e4,e.ERRORS={InvalidSocksCommand:"An invalid SOCKS command was provided. Valid options are connect, bind, and associate.",InvalidSocksCommandForOperation:"An invalid SOCKS command was provided. Only a subset of commands are supported for this operation.",InvalidSocksCommandChain:"An invalid SOCKS command was provided. Chaining currently only supports the connect command.",InvalidSocksClientOptionsDestination:"An invalid destination host was provided.",InvalidSocksClientOptionsExistingSocket:"An invalid existing socket was provided. This should be an instance of stream.Duplex.",InvalidSocksClientOptionsProxy:"Invalid SOCKS proxy details were provided.",InvalidSocksClientOptionsTimeout:"An invalid timeout value was provided. Please enter a value above 0 (in ms).",InvalidSocksClientOptionsProxiesLength:"At least two socks proxies must be provided for chaining.",InvalidSocksClientOptionsCustomAuthRange:"Custom auth must be a value between 0x80 and 0xFE.",InvalidSocksClientOptionsCustomAuthOptions:"When a custom_auth_method is provided, custom_auth_request_handler, custom_auth_response_size, and custom_auth_response_handler must also be provided and valid.",NegotiationError:"Negotiation error",SocketClosed:"Socket closed",ProxyConnectionTimedOut:"Proxy connection timed out",InternalError:"SocksClient internal error (this should not happen)",InvalidSocks4HandshakeResponse:"Received invalid Socks4 handshake response",Socks4ProxyRejectedConnection:"Socks4 Proxy rejected connection",InvalidSocks4IncomingConnectionResponse:"Socks4 invalid incoming connection response",Socks4ProxyRejectedIncomingBoundConnection:"Socks4 Proxy rejected incoming bound connection",InvalidSocks5InitialHandshakeResponse:"Received invalid Socks5 initial handshake response",InvalidSocks5IntiailHandshakeSocksVersion:"Received invalid Socks5 initial handshake (invalid socks version)",InvalidSocks5InitialHandshakeNoAcceptedAuthType:"Received invalid Socks5 initial handshake (no accepted authentication type)",InvalidSocks5InitialHandshakeUnknownAuthType:"Received invalid Socks5 initial handshake (unknown authentication type)",Socks5AuthenticationFailed:"Socks5 Authentication failed",InvalidSocks5FinalHandshake:"Received invalid Socks5 final handshake response",InvalidSocks5FinalHandshakeRejected:"Socks5 proxy rejected connection",InvalidSocks5IncomingConnectionResponse:"Received invalid Socks5 incoming connection response",Socks5ProxyRejectedIncomingBoundConnection:"Socks5 Proxy rejected incoming bound connection"},e.SOCKS_INCOMING_PACKET_SIZES={Socks5InitialHandshakeResponse:2,Socks5UserPassAuthenticationResponse:2,Socks5ResponseHeader:5,Socks5ResponseIPv4:10,Socks5ResponseIPv6:22,Socks5ResponseHostname:t=>t+7,Socks4Response:8},function(t){t[t.connect=1]="connect",t[t.bind=2]="bind",t[t.associate=3]="associate"}(s||(e.SocksCommand=s={})),function(t){t[t.Granted=90]="Granted",t[t.Failed=91]="Failed",t[t.Rejected=92]="Rejected",t[t.RejectedIdent=93]="RejectedIdent"}(r||(e.Socks4Response=r={})),function(t){t[t.NoAuth=0]="NoAuth",t[t.GSSApi=1]="GSSApi",t[t.UserPass=2]="UserPass"}(i||(e.Socks5Auth=i={})),e.SOCKS5_CUSTOM_AUTH_START=128,e.SOCKS5_CUSTOM_AUTH_END=254,e.SOCKS5_NO_ACCEPTABLE_AUTH=255,function(t){t[t.Granted=0]="Granted",t[t.Failure=1]="Failure",t[t.NotAllowed=2]="NotAllowed",t[t.NetworkUnreachable=3]="NetworkUnreachable",t[t.HostUnreachable=4]="HostUnreachable",t[t.ConnectionRefused=5]="ConnectionRefused",t[t.TTLExpired=6]="TTLExpired",t[t.CommandNotSupported=7]="CommandNotSupported",t[t.AddressNotSupported=8]="AddressNotSupported"}(n||(e.Socks5Response=n={})),function(t){t[t.IPv4=1]="IPv4",t[t.Hostname=3]="Hostname",t[t.IPv6=4]="IPv6"}(o||(e.Socks5HostType=o={})),function(t){t[t.Created=0]="Created",t[t.Connecting=1]="Connecting",t[t.Connected=2]="Connected",t[t.SentInitialHandshake=3]="SentInitialHandshake",t[t.ReceivedInitialHandshakeResponse=4]="ReceivedInitialHandshakeResponse",t[t.SentAuthentication=5]="SentAuthentication",t[t.ReceivedAuthenticationResponse=6]="ReceivedAuthenticationResponse",t[t.SentFinalHandshake=7]="SentFinalHandshake",t[t.ReceivedFinalResponse=8]="ReceivedFinalResponse",t[t.BoundWaitingForConnection=9]="BoundWaitingForConnection",t[t.Established=10]="Established",t[t.Disconnected=11]="Disconnected",t[t.Error=99]="Error"}(a||(e.SocksClientState=a={}))},5571:(t,e,s)=>{"use strict";const r=s(7075);t.exports=(t,e,s)=>r(t,e,">",s)},5580:(t,e,s)=>{"use strict";const r=s(560);t.exports=(t,e,s)=>r(t,e,s)>0},5861:function(t,e,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,s,r){void 0===r&&(r=s);var i=Object.getOwnPropertyDescriptor(e,s);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[s]}}),Object.defineProperty(t,r,i)}:function(t,e,s,r){void 0===r&&(r=s),t[r]=e[s]}),i=this&&this.__exportStar||function(t,e){for(var s in t)"default"===s||Object.prototype.hasOwnProperty.call(e,s)||r(e,t,s)};Object.defineProperty(e,"__esModule",{value:!0}),i(s(7631),e)},6170:(t,e,s)=>{"use strict";const r=s(3908),i=s(144),{safeRe:n,t:o}=s(9718);t.exports=(t,e)=>{if(t instanceof r)return t;if("number"==typeof t&&(t=String(t)),"string"!=typeof t)return null;let s=null;if((e=e||{}).rtl){const r=e.includePrerelease?n[o.COERCERTLFULL]:n[o.COERCERTL];let i;for(;(i=r.exec(t))&&(!s||s.index+s[0].length!==t.length);)s&&i.index+i[0].length===s.index+s[0].length||(s=i),r.lastIndex=i.index+i[1].length+i[2].length;r.lastIndex=-1}else s=t.match(e.includePrerelease?n[o.COERCEFULL]:n[o.COERCE]);if(null===s)return null;const a=s[2],h=s[3]||"0",l=s[4]||"0",c=e.includePrerelease&&s[5]?`-${s[5]}`:"",u=e.includePrerelease&&s[6]?`+${s[6]}`:"";return i(`${a}.${h}.${l}${c}${u}`,e)}},6254:(t,e,s)=>{"use strict";const r=s(3908);t.exports=(t,e)=>new r(t,e).minor},6329:function(t,e,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,s,r){void 0===r&&(r=s);var i=Object.getOwnPropertyDescriptor(e,s);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[s]}}),Object.defineProperty(t,r,i)}:function(t,e,s,r){void 0===r&&(r=s),t[r]=e[s]}),i=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),n=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var s in t)"default"!==s&&Object.prototype.hasOwnProperty.call(t,s)&&r(e,t,s);return i(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.Address6=void 0;const o=n(s(837)),a=n(s(9576)),h=n(s(8914)),l=n(s(2846)),c=s(2839),u=s(321),d=s(2437),p=s(9534),f=s(7604);function m(t){if(!t)throw new Error("Assertion failed.")}function g(t){return(t=t.replace(/^(0{1,})([1-9]+)$/,'<span class="parse-error">$1</span>$2')).replace(/^(0{1,})(0)$/,'<span class="parse-error">$1</span>$2')}function E(t){return(0,f.sprintf)("%04x",parseInt(t,16))}function S(t){return 255&t}class w{constructor(t,e){this.addressMinusSuffix="",this.parsedSubnet="",this.subnet="/128",this.subnetMask=128,this.v4=!1,this.zone="",this.isInSubnet=o.isInSubnet,this.isCorrect=o.isCorrect(h.BITS),this.groups=void 0===e?h.GROUPS:e,this.address=t;const s=h.RE_SUBNET_STRING.exec(t);if(s){if(this.parsedSubnet=s[0].replace("/",""),this.subnetMask=parseInt(this.parsedSubnet,10),this.subnet=`/${this.subnetMask}`,Number.isNaN(this.subnetMask)||this.subnetMask<0||this.subnetMask>h.BITS)throw new d.AddressError("Invalid subnet mask.");t=t.replace(h.RE_SUBNET_STRING,"")}else if(/\//.test(t))throw new d.AddressError("Invalid subnet mask.");const r=h.RE_ZONE_STRING.exec(t);r&&(this.zone=r[0],t=t.replace(h.RE_ZONE_STRING,"")),this.addressMinusSuffix=t,this.parsedAddress=this.parse(this.addressMinusSuffix)}static isValid(t){try{return new w(t),!0}catch(t){return!1}}static fromBigInteger(t){const e=t.toString(16).padStart(32,"0"),s=[];let r;for(r=0;r<h.GROUPS;r++)s.push(e.slice(4*r,4*(r+1)));return new w(s.join(":"))}static fromURL(t){let e,s,r=null;if(-1!==t.indexOf("[")&&-1!==t.indexOf("]:")){if(s=h.RE_URL_WITH_PORT.exec(t),null===s)return{error:"failed to parse address with port",address:null,port:null};e=s[1],r=s[2]}else if(-1!==t.indexOf("/")){if(t=t.replace(/^[a-z0-9]+:\/\//,""),s=h.RE_URL.exec(t),null===s)return{error:"failed to parse address from URL",address:null,port:null};e=s[1]}else e=t;return r?(r=parseInt(r,10),(r<0||r>65536)&&(r=null)):r=null,{address:new w(e),port:r}}static fromAddress4(t){const e=new c.Address4(t),s=h.BITS-(a.BITS-e.subnetMask);return new w(`::ffff:${e.correctForm()}/${s}`)}static fromArpa(t){let e=t.replace(/(\.ip6\.arpa)?\.$/,"");if(63!==e.length)throw new d.AddressError("Invalid 'ip6.arpa' form.");const s=e.split(".").reverse();for(let t=7;t>0;t--){const e=4*t;s.splice(e,0,":")}return e=s.join(""),new w(e)}microsoftTranscription(){return(0,f.sprintf)("%s.ipv6-literal.net",this.correctForm().replace(/:/g,"-"))}mask(t=this.subnetMask){return this.getBitsBase2(0,t)}possibleSubnets(t=128){const e=h.BITS-this.subnetMask-Math.abs(t-h.BITS);return e<0?"0":function(t){const e=/(\d+)(\d{3})/;for(;e.test(t);)t=t.replace(e,"$1,$2");return t}(new p.BigInteger("2",10).pow(e).toString(10))}_startAddress(){return new p.BigInteger(this.mask()+"0".repeat(h.BITS-this.subnetMask),2)}startAddress(){return w.fromBigInteger(this._startAddress())}startAddressExclusive(){const t=new p.BigInteger("1");return w.fromBigInteger(this._startAddress().add(t))}_endAddress(){return new p.BigInteger(this.mask()+"1".repeat(h.BITS-this.subnetMask),2)}endAddress(){return w.fromBigInteger(this._endAddress())}endAddressExclusive(){const t=new p.BigInteger("1");return w.fromBigInteger(this._endAddress().subtract(t))}getScope(){let t=h.SCOPES[this.getBits(12,16).intValue()];return"Global unicast"===this.getType()&&"Link local"!==t&&(t="Global"),t||"Unknown"}getType(){for(const t of Object.keys(h.TYPES))if(this.isInSubnet(new w(t)))return h.TYPES[t];return"Global unicast"}getBits(t,e){return new p.BigInteger(this.getBitsBase2(t,e),2)}getBitsBase2(t,e){return this.binaryZeroPad().slice(t,e)}getBitsBase16(t,e){const s=e-t;if(s%4!=0)throw new Error("Length of bits to retrieve must be divisible by four");return this.getBits(t,e).toString(16).padStart(s/4,"0")}getBitsPastSubnet(){return this.getBitsBase2(this.subnetMask,h.BITS)}reverseForm(t){t||(t={});const e=Math.floor(this.subnetMask/4),s=this.canonicalForm().replace(/:/g,"").split("").slice(0,e).reverse().join(".");return e>0?t.omitSuffix?s:(0,f.sprintf)("%s.ip6.arpa.",s):t.omitSuffix?"":"ip6.arpa."}correctForm(){let t,e=[],s=0;const r=[];for(t=0;t<this.parsedAddress.length;t++){const e=parseInt(this.parsedAddress[t],16);0===e&&s++,0!==e&&s>0&&(s>1&&r.push([t-s,t-1]),s=0)}s>1&&r.push([this.parsedAddress.length-s,this.parsedAddress.length-1]);const i=r.map((t=>t[1]-t[0]+1));if(r.length>0){const t=i.indexOf(Math.max(...i));e=function(t,e){const s=[],r=[];let i;for(i=0;i<t.length;i++)i<e[0]?s.push(t[i]):i>e[1]&&r.push(t[i]);return s.concat(["compact"]).concat(r)}(this.parsedAddress,r[t])}else e=this.parsedAddress;for(t=0;t<e.length;t++)"compact"!==e[t]&&(e[t]=parseInt(e[t],16).toString(16));let n=e.join(":");return n=n.replace(/^compact$/,"::"),n=n.replace(/^compact|compact$/,":"),n=n.replace(/compact/,""),n}binaryZeroPad(){return this.bigInteger().toString(2).padStart(h.BITS,"0")}parse4in6(t){const e=t.split(":"),s=e.slice(-1)[0].match(a.RE_ADDRESS);if(s){this.parsedAddress4=s[0],this.address4=new c.Address4(this.parsedAddress4);for(let e=0;e<this.address4.groups;e++)if(/^0[0-9]+/.test(this.address4.parsedAddress[e]))throw new d.AddressError("IPv4 addresses can't have leading zeroes.",t.replace(a.RE_ADDRESS,this.address4.parsedAddress.map(g).join(".")));this.v4=!0,e[e.length-1]=this.address4.toGroup6(),t=e.join(":")}return t}parse(t){const e=(t=this.parse4in6(t)).match(h.RE_BAD_CHARACTERS);if(e)throw new d.AddressError((0,f.sprintf)("Bad character%s detected in address: %s",e.length>1?"s":"",e.join("")),t.replace(h.RE_BAD_CHARACTERS,'<span class="parse-error">$1</span>'));const s=t.match(h.RE_BAD_ADDRESS);if(s)throw new d.AddressError((0,f.sprintf)("Address failed regex: %s",s.join("")),t.replace(h.RE_BAD_ADDRESS,'<span class="parse-error">$1</span>'));let r=[];const i=t.split("::");if(2===i.length){let t=i[0].split(":"),e=i[1].split(":");1===t.length&&""===t[0]&&(t=[]),1===e.length&&""===e[0]&&(e=[]);const s=this.groups-(t.length+e.length);if(!s)throw new d.AddressError("Error parsing groups");this.elidedGroups=s,this.elisionBegin=t.length,this.elisionEnd=t.length+this.elidedGroups,r=r.concat(t);for(let t=0;t<s;t++)r.push("0");r=r.concat(e)}else{if(1!==i.length)throw new d.AddressError("Too many :: groups found");r=t.split(":"),this.elidedGroups=0}if(r=r.map((t=>(0,f.sprintf)("%x",parseInt(t,16)))),r.length!==this.groups)throw new d.AddressError("Incorrect number of groups found");return r}canonicalForm(){return this.parsedAddress.map(E).join(":")}decimal(){return this.parsedAddress.map((t=>(0,f.sprintf)("%05d",parseInt(t,16)))).join(":")}bigInteger(){return new p.BigInteger(this.parsedAddress.map(E).join(""),16)}to4(){const t=this.binaryZeroPad().split("");return c.Address4.fromHex(new p.BigInteger(t.slice(96,128).join(""),2).toString(16))}to4in6(){const t=this.to4(),e=new w(this.parsedAddress.slice(0,6).join(":"),6).correctForm();let s="";return/:$/.test(e)||(s=":"),e+s+t.address}inspectTeredo(){const t=this.getBitsBase16(0,32),e=this.getBits(80,96).xor(new p.BigInteger("ffff",16)).toString(),s=c.Address4.fromHex(this.getBitsBase16(32,64)),r=c.Address4.fromHex(this.getBits(96,128).xor(new p.BigInteger("ffffffff",16)).toString(16)),i=this.getBits(64,80),n=this.getBitsBase2(64,80),o=i.testBit(15),a=i.testBit(14),h=i.testBit(8),l=i.testBit(9),u=new p.BigInteger(n.slice(2,6)+n.slice(8,16),2).toString(10);return{prefix:(0,f.sprintf)("%s:%s",t.slice(0,4),t.slice(4,8)),server4:s.address,client4:r.address,flags:n,coneNat:o,microsoft:{reserved:a,universalLocal:l,groupIndividual:h,nonce:u},udpPort:e}}inspect6to4(){const t=this.getBitsBase16(0,16),e=c.Address4.fromHex(this.getBitsBase16(16,48));return{prefix:(0,f.sprintf)("%s",t.slice(0,4)),gateway:e.address}}to6to4(){if(!this.is4())return null;const t=["2002",this.getBitsBase16(96,112),this.getBitsBase16(112,128),"","/16"].join(":");return new w(t)}toByteArray(){const t=this.bigInteger().toByteArray();return 17===t.length&&0===t[0]?t.slice(1):t}toUnsignedByteArray(){return this.toByteArray().map(S)}static fromByteArray(t){return this.fromUnsignedByteArray(t.map(S))}static fromUnsignedByteArray(t){const e=new p.BigInteger("256",10);let s=new p.BigInteger("0",10),r=new p.BigInteger("1",10);for(let i=t.length-1;i>=0;i--)s=s.add(r.multiply(new p.BigInteger(t[i].toString(10),10))),r=r.multiply(e);return w.fromBigInteger(s)}isCanonical(){return this.addressMinusSuffix===this.canonicalForm()}isLinkLocal(){return"1111111010000000000000000000000000000000000000000000000000000000"===this.getBitsBase2(0,64)}isMulticast(){return"Multicast"===this.getType()}is4(){return this.v4}isTeredo(){return this.isInSubnet(new w("2001::/32"))}is6to4(){return this.isInSubnet(new w("2002::/16"))}isLoopback(){return"Loopback"===this.getType()}href(t){return t=void 0===t?"":(0,f.sprintf)(":%s",t),(0,f.sprintf)("http://[%s]%s/",this.correctForm(),t)}link(t){t||(t={}),void 0===t.className&&(t.className=""),void 0===t.prefix&&(t.prefix="/#address="),void 0===t.v4&&(t.v4=!1);let e=this.correctForm;return t.v4&&(e=this.to4in6),t.className?(0,f.sprintf)('<a href="%1$s%2$s" class="%3$s">%2$s</a>',t.prefix,e.call(this),t.className):(0,f.sprintf)('<a href="%1$s%2$s">%2$s</a>',t.prefix,e.call(this))}group(){if(0===this.elidedGroups)return l.simpleGroup(this.address).join(":");m("number"==typeof this.elidedGroups),m("number"==typeof this.elisionBegin);const t=[],[e,s]=this.address.split("::");e.length?t.push(...l.simpleGroup(e)):t.push("");const r=["hover-group"];for(let t=this.elisionBegin;t<this.elisionBegin+this.elidedGroups;t++)r.push((0,f.sprintf)("group-%d",t));return t.push((0,f.sprintf)('<span class="%s"></span>',r.join(" "))),s.length?t.push(...l.simpleGroup(s,this.elisionEnd)):t.push(""),this.is4()&&(m(this.address4 instanceof c.Address4),t.pop(),t.push(this.address4.groupForV6())),t.join(":")}regularExpressionString(t=!1){let e=[];const s=new w(this.correctForm());if(0===s.elidedGroups)e.push((0,u.simpleRegularExpression)(s.parsedAddress));else if(s.elidedGroups===h.GROUPS)e.push((0,u.possibleElisions)(h.GROUPS));else{const t=s.address.split("::");t[0].length&&e.push((0,u.simpleRegularExpression)(t[0].split(":"))),m("number"==typeof s.elidedGroups),e.push((0,u.possibleElisions)(s.elidedGroups,0!==t[0].length,0!==t[1].length)),t[1].length&&e.push((0,u.simpleRegularExpression)(t[1].split(":"))),e=[e.join(":")]}return t||(e=["(?=^|",u.ADDRESS_BOUNDARY,"|[^\\w\\:])(",...e,")(?=[^\\w\\:]|",u.ADDRESS_BOUNDARY,"|$)"]),e.join("")}regularExpression(t=!1){return new RegExp(this.regularExpressionString(t),"i")}}e.Address6=w},6780:(t,e,s)=>{"use strict";const r=s(8311);t.exports=(t,e,s)=>(t=new r(t,s),e=new r(e,s),t.intersects(e,s))},6874:t=>{"use strict";const e=Number.MAX_SAFE_INTEGER||9007199254740991;t.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:e,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},6953:(t,e,s)=>{"use strict";const r=s(144);t.exports=(t,e)=>{const s=r(t,e);return s?s.version:null}},7059:(t,e,s)=>{"use strict";const r=s(560);t.exports=(t,e,s)=>r(t,e,s)<0},7075:(t,e,s)=>{"use strict";const r=s(3908),i=s(3904),{ANY:n}=i,o=s(8311),a=s(7638),h=s(5580),l=s(7059),c=s(5200),u=s(4089);t.exports=(t,e,s,d)=>{let p,f,m,g,E;switch(t=new r(t,d),e=new o(e,d),s){case">":p=h,f=c,m=l,g=">",E=">=";break;case"<":p=l,f=u,m=h,g="<",E="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(a(t,e,d))return!1;for(let s=0;s<e.set.length;++s){const r=e.set[s];let o=null,a=null;if(r.forEach((t=>{t.semver===n&&(t=new i(">=0.0.0")),o=o||t,a=a||t,p(t.semver,o.semver,d)?o=t:m(t.semver,a.semver,d)&&(a=t)})),o.operator===g||o.operator===E)return!1;if((!a.operator||a.operator===g)&&f(t,a.semver))return!1;if(a.operator===E&&m(t,a.semver))return!1}return!0}},7130:(t,e,s)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ipToBuffer=e.int32ToIpv4=e.ipv4ToInt32=e.validateSocksClientChainOptions=e.validateSocksClientOptions=void 0;const r=s(3763),i=s(5438),n=s(2203),o=s(9424),a=s(9278);function h(t,e){if(void 0!==t.custom_auth_method){if(t.custom_auth_method<i.SOCKS5_CUSTOM_AUTH_START||t.custom_auth_method>i.SOCKS5_CUSTOM_AUTH_END)throw new r.SocksClientError(i.ERRORS.InvalidSocksClientOptionsCustomAuthRange,e);if(void 0===t.custom_auth_request_handler||"function"!=typeof t.custom_auth_request_handler)throw new r.SocksClientError(i.ERRORS.InvalidSocksClientOptionsCustomAuthOptions,e);if(void 0===t.custom_auth_response_size)throw new r.SocksClientError(i.ERRORS.InvalidSocksClientOptionsCustomAuthOptions,e);if(void 0===t.custom_auth_response_handler||"function"!=typeof t.custom_auth_response_handler)throw new r.SocksClientError(i.ERRORS.InvalidSocksClientOptionsCustomAuthOptions,e)}}function l(t){return t&&"string"==typeof t.host&&"number"==typeof t.port&&t.port>=0&&t.port<=65535}function c(t){return t&&("string"==typeof t.host||"string"==typeof t.ipaddress)&&"number"==typeof t.port&&t.port>=0&&t.port<=65535&&(4===t.type||5===t.type)}function u(t){return"number"==typeof t&&t>0}e.validateSocksClientOptions=function(t,e=["connect","bind","associate"]){if(!i.SocksCommand[t.command])throw new r.SocksClientError(i.ERRORS.InvalidSocksCommand,t);if(-1===e.indexOf(t.command))throw new r.SocksClientError(i.ERRORS.InvalidSocksCommandForOperation,t);if(!l(t.destination))throw new r.SocksClientError(i.ERRORS.InvalidSocksClientOptionsDestination,t);if(!c(t.proxy))throw new r.SocksClientError(i.ERRORS.InvalidSocksClientOptionsProxy,t);if(h(t.proxy,t),t.timeout&&!u(t.timeout))throw new r.SocksClientError(i.ERRORS.InvalidSocksClientOptionsTimeout,t);if(t.existing_socket&&!(t.existing_socket instanceof n.Duplex))throw new r.SocksClientError(i.ERRORS.InvalidSocksClientOptionsExistingSocket,t)},e.validateSocksClientChainOptions=function(t){if("connect"!==t.command)throw new r.SocksClientError(i.ERRORS.InvalidSocksCommandChain,t);if(!l(t.destination))throw new r.SocksClientError(i.ERRORS.InvalidSocksClientOptionsDestination,t);if(!(t.proxies&&Array.isArray(t.proxies)&&t.proxies.length>=2))throw new r.SocksClientError(i.ERRORS.InvalidSocksClientOptionsProxiesLength,t);if(t.proxies.forEach((e=>{if(!c(e))throw new r.SocksClientError(i.ERRORS.InvalidSocksClientOptionsProxy,t);h(e,t)})),t.timeout&&!u(t.timeout))throw new r.SocksClientError(i.ERRORS.InvalidSocksClientOptionsTimeout,t)},e.ipv4ToInt32=function(t){return new o.Address4(t).toArray().reduce(((t,e)=>(t<<8)+e),0)},e.int32ToIpv4=function(t){return[t>>>24&255,t>>>16&255,t>>>8&255,255&t].join(".")},e.ipToBuffer=function(t){if(a.isIPv4(t)){const e=new o.Address4(t);return Buffer.from(e.toArray())}if(a.isIPv6(t)){const e=new o.Address6(t);return Buffer.from(e.canonicalForm().split(":").map((t=>t.padStart(4,"0"))).join(""),"hex")}throw new Error("Invalid IP address format")}},7272:t=>{"use strict";const e="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{};t.exports=e},7414:(t,e,s)=>{"use strict";const r=s(144);t.exports=(t,e)=>{const s=r(t.trim().replace(/^[=v]+/,""),e);return s?s.version:null}},7575:(t,e,s)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=s(1725);class i{constructor(t){if(this.length=0,this._encoding="utf8",this._writeOffset=0,this._readOffset=0,i.isSmartBufferOptions(t))if(t.encoding&&(r.checkEncoding(t.encoding),this._encoding=t.encoding),t.size){if(!(r.isFiniteInteger(t.size)&&t.size>0))throw new Error(r.ERRORS.INVALID_SMARTBUFFER_SIZE);this._buff=Buffer.allocUnsafe(t.size)}else if(t.buff){if(!Buffer.isBuffer(t.buff))throw new Error(r.ERRORS.INVALID_SMARTBUFFER_BUFFER);this._buff=t.buff,this.length=t.buff.length}else this._buff=Buffer.allocUnsafe(4096);else{if(void 0!==t)throw new Error(r.ERRORS.INVALID_SMARTBUFFER_OBJECT);this._buff=Buffer.allocUnsafe(4096)}}static fromSize(t,e){return new this({size:t,encoding:e})}static fromBuffer(t,e){return new this({buff:t,encoding:e})}static fromOptions(t){return new this(t)}static isSmartBufferOptions(t){const e=t;return e&&(void 0!==e.encoding||void 0!==e.size||void 0!==e.buff)}readInt8(t){return this._readNumberValue(Buffer.prototype.readInt8,1,t)}readInt16BE(t){return this._readNumberValue(Buffer.prototype.readInt16BE,2,t)}readInt16LE(t){return this._readNumberValue(Buffer.prototype.readInt16LE,2,t)}readInt32BE(t){return this._readNumberValue(Buffer.prototype.readInt32BE,4,t)}readInt32LE(t){return this._readNumberValue(Buffer.prototype.readInt32LE,4,t)}readBigInt64BE(t){return r.bigIntAndBufferInt64Check("readBigInt64BE"),this._readNumberValue(Buffer.prototype.readBigInt64BE,8,t)}readBigInt64LE(t){return r.bigIntAndBufferInt64Check("readBigInt64LE"),this._readNumberValue(Buffer.prototype.readBigInt64LE,8,t)}writeInt8(t,e){return this._writeNumberValue(Buffer.prototype.writeInt8,1,t,e),this}insertInt8(t,e){return this._insertNumberValue(Buffer.prototype.writeInt8,1,t,e)}writeInt16BE(t,e){return this._writeNumberValue(Buffer.prototype.writeInt16BE,2,t,e)}insertInt16BE(t,e){return this._insertNumberValue(Buffer.prototype.writeInt16BE,2,t,e)}writeInt16LE(t,e){return this._writeNumberValue(Buffer.prototype.writeInt16LE,2,t,e)}insertInt16LE(t,e){return this._insertNumberValue(Buffer.prototype.writeInt16LE,2,t,e)}writeInt32BE(t,e){return this._writeNumberValue(Buffer.prototype.writeInt32BE,4,t,e)}insertInt32BE(t,e){return this._insertNumberValue(Buffer.prototype.writeInt32BE,4,t,e)}writeInt32LE(t,e){return this._writeNumberValue(Buffer.prototype.writeInt32LE,4,t,e)}insertInt32LE(t,e){return this._insertNumberValue(Buffer.prototype.writeInt32LE,4,t,e)}writeBigInt64BE(t,e){return r.bigIntAndBufferInt64Check("writeBigInt64BE"),this._writeNumberValue(Buffer.prototype.writeBigInt64BE,8,t,e)}insertBigInt64BE(t,e){return r.bigIntAndBufferInt64Check("writeBigInt64BE"),this._insertNumberValue(Buffer.prototype.writeBigInt64BE,8,t,e)}writeBigInt64LE(t,e){return r.bigIntAndBufferInt64Check("writeBigInt64LE"),this._writeNumberValue(Buffer.prototype.writeBigInt64LE,8,t,e)}insertBigInt64LE(t,e){return r.bigIntAndBufferInt64Check("writeBigInt64LE"),this._insertNumberValue(Buffer.prototype.writeBigInt64LE,8,t,e)}readUInt8(t){return this._readNumberValue(Buffer.prototype.readUInt8,1,t)}readUInt16BE(t){return this._readNumberValue(Buffer.prototype.readUInt16BE,2,t)}readUInt16LE(t){return this._readNumberValue(Buffer.prototype.readUInt16LE,2,t)}readUInt32BE(t){return this._readNumberValue(Buffer.prototype.readUInt32BE,4,t)}readUInt32LE(t){return this._readNumberValue(Buffer.prototype.readUInt32LE,4,t)}readBigUInt64BE(t){return r.bigIntAndBufferInt64Check("readBigUInt64BE"),this._readNumberValue(Buffer.prototype.readBigUInt64BE,8,t)}readBigUInt64LE(t){return r.bigIntAndBufferInt64Check("readBigUInt64LE"),this._readNumberValue(Buffer.prototype.readBigUInt64LE,8,t)}writeUInt8(t,e){return this._writeNumberValue(Buffer.prototype.writeUInt8,1,t,e)}insertUInt8(t,e){return this._insertNumberValue(Buffer.prototype.writeUInt8,1,t,e)}writeUInt16BE(t,e){return this._writeNumberValue(Buffer.prototype.writeUInt16BE,2,t,e)}insertUInt16BE(t,e){return this._insertNumberValue(Buffer.prototype.writeUInt16BE,2,t,e)}writeUInt16LE(t,e){return this._writeNumberValue(Buffer.prototype.writeUInt16LE,2,t,e)}insertUInt16LE(t,e){return this._insertNumberValue(Buffer.prototype.writeUInt16LE,2,t,e)}writeUInt32BE(t,e){return this._writeNumberValue(Buffer.prototype.writeUInt32BE,4,t,e)}insertUInt32BE(t,e){return this._insertNumberValue(Buffer.prototype.writeUInt32BE,4,t,e)}writeUInt32LE(t,e){return this._writeNumberValue(Buffer.prototype.writeUInt32LE,4,t,e)}insertUInt32LE(t,e){return this._insertNumberValue(Buffer.prototype.writeUInt32LE,4,t,e)}writeBigUInt64BE(t,e){return r.bigIntAndBufferInt64Check("writeBigUInt64BE"),this._writeNumberValue(Buffer.prototype.writeBigUInt64BE,8,t,e)}insertBigUInt64BE(t,e){return r.bigIntAndBufferInt64Check("writeBigUInt64BE"),this._insertNumberValue(Buffer.prototype.writeBigUInt64BE,8,t,e)}writeBigUInt64LE(t,e){return r.bigIntAndBufferInt64Check("writeBigUInt64LE"),this._writeNumberValue(Buffer.prototype.writeBigUInt64LE,8,t,e)}insertBigUInt64LE(t,e){return r.bigIntAndBufferInt64Check("writeBigUInt64LE"),this._insertNumberValue(Buffer.prototype.writeBigUInt64LE,8,t,e)}readFloatBE(t){return this._readNumberValue(Buffer.prototype.readFloatBE,4,t)}readFloatLE(t){return this._readNumberValue(Buffer.prototype.readFloatLE,4,t)}writeFloatBE(t,e){return this._writeNumberValue(Buffer.prototype.writeFloatBE,4,t,e)}insertFloatBE(t,e){return this._insertNumberValue(Buffer.prototype.writeFloatBE,4,t,e)}writeFloatLE(t,e){return this._writeNumberValue(Buffer.prototype.writeFloatLE,4,t,e)}insertFloatLE(t,e){return this._insertNumberValue(Buffer.prototype.writeFloatLE,4,t,e)}readDoubleBE(t){return this._readNumberValue(Buffer.prototype.readDoubleBE,8,t)}readDoubleLE(t){return this._readNumberValue(Buffer.prototype.readDoubleLE,8,t)}writeDoubleBE(t,e){return this._writeNumberValue(Buffer.prototype.writeDoubleBE,8,t,e)}insertDoubleBE(t,e){return this._insertNumberValue(Buffer.prototype.writeDoubleBE,8,t,e)}writeDoubleLE(t,e){return this._writeNumberValue(Buffer.prototype.writeDoubleLE,8,t,e)}insertDoubleLE(t,e){return this._insertNumberValue(Buffer.prototype.writeDoubleLE,8,t,e)}readString(t,e){let s;"number"==typeof t?(r.checkLengthValue(t),s=Math.min(t,this.length-this._readOffset)):(e=t,s=this.length-this._readOffset),void 0!==e&&r.checkEncoding(e);const i=this._buff.slice(this._readOffset,this._readOffset+s).toString(e||this._encoding);return this._readOffset+=s,i}insertString(t,e,s){return r.checkOffsetValue(e),this._handleString(t,!0,e,s)}writeString(t,e,s){return this._handleString(t,!1,e,s)}readStringNT(t){void 0!==t&&r.checkEncoding(t);let e=this.length;for(let t=this._readOffset;t<this.length;t++)if(0===this._buff[t]){e=t;break}const s=this._buff.slice(this._readOffset,e);return this._readOffset=e+1,s.toString(t||this._encoding)}insertStringNT(t,e,s){return r.checkOffsetValue(e),this.insertString(t,e,s),this.insertUInt8(0,e+t.length),this}writeStringNT(t,e,s){return this.writeString(t,e,s),this.writeUInt8(0,"number"==typeof e?e+t.length:this.writeOffset),this}readBuffer(t){void 0!==t&&r.checkLengthValue(t);const e="number"==typeof t?t:this.length,s=Math.min(this.length,this._readOffset+e),i=this._buff.slice(this._readOffset,s);return this._readOffset=s,i}insertBuffer(t,e){return r.checkOffsetValue(e),this._handleBuffer(t,!0,e)}writeBuffer(t,e){return this._handleBuffer(t,!1,e)}readBufferNT(){let t=this.length;for(let e=this._readOffset;e<this.length;e++)if(0===this._buff[e]){t=e;break}const e=this._buff.slice(this._readOffset,t);return this._readOffset=t+1,e}insertBufferNT(t,e){return r.checkOffsetValue(e),this.insertBuffer(t,e),this.insertUInt8(0,e+t.length),this}writeBufferNT(t,e){return void 0!==e&&r.checkOffsetValue(e),this.writeBuffer(t,e),this.writeUInt8(0,"number"==typeof e?e+t.length:this._writeOffset),this}clear(){return this._writeOffset=0,this._readOffset=0,this.length=0,this}remaining(){return this.length-this._readOffset}get readOffset(){return this._readOffset}set readOffset(t){r.checkOffsetValue(t),r.checkTargetOffset(t,this),this._readOffset=t}get writeOffset(){return this._writeOffset}set writeOffset(t){r.checkOffsetValue(t),r.checkTargetOffset(t,this),this._writeOffset=t}get encoding(){return this._encoding}set encoding(t){r.checkEncoding(t),this._encoding=t}get internalBuffer(){return this._buff}toBuffer(){return this._buff.slice(0,this.length)}toString(t){const e="string"==typeof t?t:this._encoding;return r.checkEncoding(e),this._buff.toString(e,0,this.length)}destroy(){return this.clear(),this}_handleString(t,e,s,i){let n=this._writeOffset,o=this._encoding;"number"==typeof s?n=s:"string"==typeof s&&(r.checkEncoding(s),o=s),"string"==typeof i&&(r.checkEncoding(i),o=i);const a=Buffer.byteLength(t,o);return e?this.ensureInsertable(a,n):this._ensureWriteable(a,n),this._buff.write(t,n,a,o),e?this._writeOffset+=a:"number"==typeof s?this._writeOffset=Math.max(this._writeOffset,n+a):this._writeOffset+=a,this}_handleBuffer(t,e,s){const r="number"==typeof s?s:this._writeOffset;return e?this.ensureInsertable(t.length,r):this._ensureWriteable(t.length,r),t.copy(this._buff,r),e?this._writeOffset+=t.length:"number"==typeof s?this._writeOffset=Math.max(this._writeOffset,r+t.length):this._writeOffset+=t.length,this}ensureReadable(t,e){let s=this._readOffset;if(void 0!==e&&(r.checkOffsetValue(e),s=e),s<0||s+t>this.length)throw new Error(r.ERRORS.INVALID_READ_BEYOND_BOUNDS)}ensureInsertable(t,e){r.checkOffsetValue(e),this._ensureCapacity(this.length+t),e<this.length&&this._buff.copy(this._buff,e+t,e,this._buff.length),e+t>this.length?this.length=e+t:this.length+=t}_ensureWriteable(t,e){const s="number"==typeof e?e:this._writeOffset;this._ensureCapacity(s+t),s+t>this.length&&(this.length=s+t)}_ensureCapacity(t){const e=this._buff.length;if(t>e){let s=this._buff,r=3*e/2+1;r<t&&(r=t),this._buff=Buffer.allocUnsafe(r),s.copy(this._buff,0,0,e)}}_readNumberValue(t,e,s){this.ensureReadable(e,s);const r=t.call(this._buff,"number"==typeof s?s:this._readOffset);return void 0===s&&(this._readOffset+=e),r}_insertNumberValue(t,e,s,i){return r.checkOffsetValue(i),this.ensureInsertable(e,i),t.call(this._buff,s,i),this._writeOffset+=e,this}_writeNumberValue(t,e,s,i){if("number"==typeof i){if(i<0)throw new Error(r.ERRORS.INVALID_WRITE_BEYOND_BOUNDS);r.checkOffsetValue(i)}const n="number"==typeof i?i:this._writeOffset;return this._ensureWriteable(e,n),t.call(this._buff,s,n),"number"==typeof i?this._writeOffset=Math.max(this._writeOffset,n+e):this._writeOffset+=e,this}}e.SmartBuffer=i},7604:(t,e,s)=>{var r;!function(){"use strict";var i={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function n(t){return function(t,e){var s,r,o,a,h,l,c,u,d,p=1,f=t.length,m="";for(r=0;r<f;r++)if("string"==typeof t[r])m+=t[r];else if("object"==typeof t[r]){if((a=t[r]).keys)for(s=e[p],o=0;o<a.keys.length;o++){if(null==s)throw new Error(n('[sprintf] Cannot access property "%s" of undefined value "%s"',a.keys[o],a.keys[o-1]));s=s[a.keys[o]]}else s=a.param_no?e[a.param_no]:e[p++];if(i.not_type.test(a.type)&&i.not_primitive.test(a.type)&&s instanceof Function&&(s=s()),i.numeric_arg.test(a.type)&&"number"!=typeof s&&isNaN(s))throw new TypeError(n("[sprintf] expecting number but found %T",s));switch(i.number.test(a.type)&&(u=s>=0),a.type){case"b":s=parseInt(s,10).toString(2);break;case"c":s=String.fromCharCode(parseInt(s,10));break;case"d":case"i":s=parseInt(s,10);break;case"j":s=JSON.stringify(s,null,a.width?parseInt(a.width):0);break;case"e":s=a.precision?parseFloat(s).toExponential(a.precision):parseFloat(s).toExponential();break;case"f":s=a.precision?parseFloat(s).toFixed(a.precision):parseFloat(s);break;case"g":s=a.precision?String(Number(s.toPrecision(a.precision))):parseFloat(s);break;case"o":s=(parseInt(s,10)>>>0).toString(8);break;case"s":s=String(s),s=a.precision?s.substring(0,a.precision):s;break;case"t":s=String(!!s),s=a.precision?s.substring(0,a.precision):s;break;case"T":s=Object.prototype.toString.call(s).slice(8,-1).toLowerCase(),s=a.precision?s.substring(0,a.precision):s;break;case"u":s=parseInt(s,10)>>>0;break;case"v":s=s.valueOf(),s=a.precision?s.substring(0,a.precision):s;break;case"x":s=(parseInt(s,10)>>>0).toString(16);break;case"X":s=(parseInt(s,10)>>>0).toString(16).toUpperCase()}i.json.test(a.type)?m+=s:(!i.number.test(a.type)||u&&!a.sign?d="":(d=u?"+":"-",s=s.toString().replace(i.sign,"")),l=a.pad_char?"0"===a.pad_char?"0":a.pad_char.charAt(1):" ",c=a.width-(d+s).length,h=a.width&&c>0?l.repeat(c):"",m+=a.align?d+s+h:"0"===l?d+h+s:h+d+s)}return m}(function(t){if(a[t])return a[t];for(var e,s=t,r=[],n=0;s;){if(null!==(e=i.text.exec(s)))r.push(e[0]);else if(null!==(e=i.modulo.exec(s)))r.push("%");else{if(null===(e=i.placeholder.exec(s)))throw new SyntaxError("[sprintf] unexpected placeholder");if(e[2]){n|=1;var o=[],h=e[2],l=[];if(null===(l=i.key.exec(h)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(o.push(l[1]);""!==(h=h.substring(l[0].length));)if(null!==(l=i.key_access.exec(h)))o.push(l[1]);else{if(null===(l=i.index_access.exec(h)))throw new SyntaxError("[sprintf] failed to parse named argument key");o.push(l[1])}e[2]=o}else n|=2;if(3===n)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");r.push({placeholder:e[0],param_no:e[1],keys:e[2],sign:e[3],pad_char:e[4],align:e[5],width:e[6],precision:e[7],type:e[8]})}s=s.substring(e[0].length)}return a[t]=r}(t),arguments)}function o(t,e){return n.apply(null,[t].concat(e||[]))}var a=Object.create(null);e.sprintf=n,e.vsprintf=o,"undefined"!=typeof window&&(window.sprintf=n,window.vsprintf=o,void 0===(r=function(){return{sprintf:n,vsprintf:o}}.call(e,s,e,t))||(t.exports=r))}()},7631:function(t,e,s){"use strict";var r=this&&this.__awaiter||function(t,e,s,r){return new(s||(s=Promise))((function(i,n){function o(t){try{h(r.next(t))}catch(t){n(t)}}function a(t){try{h(r.throw(t))}catch(t){n(t)}}function h(t){var e;t.done?i(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}h((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.SocksClientError=e.SocksClient=void 0;const i=s(4434),n=s(9278),o=s(7575),a=s(5438),h=s(7130),l=s(7736),c=s(3763);Object.defineProperty(e,"SocksClientError",{enumerable:!0,get:function(){return c.SocksClientError}});const u=s(9424);class d extends i.EventEmitter{constructor(t){super(),this.options=Object.assign({},t),(0,h.validateSocksClientOptions)(t),this.setState(a.SocksClientState.Created)}static createConnection(t,e){return new Promise(((s,r)=>{try{(0,h.validateSocksClientOptions)(t,["connect"])}catch(t){return"function"==typeof e?(e(t),s(t)):r(t)}const i=new d(t);i.connect(t.existing_socket),i.once("established",(t=>{i.removeAllListeners(),"function"==typeof e?(e(null,t),s(t)):s(t)})),i.once("error",(t=>{i.removeAllListeners(),"function"==typeof e?(e(t),s(t)):r(t)}))}))}static createConnectionChain(t,e){return new Promise(((s,i)=>r(this,void 0,void 0,(function*(){try{(0,h.validateSocksClientChainOptions)(t)}catch(t){return"function"==typeof e?(e(t),s(t)):i(t)}t.randomizeChain&&(0,c.shuffleArray)(t.proxies);try{let r;for(let e=0;e<t.proxies.length;e++){const s=t.proxies[e],i=e===t.proxies.length-1?t.destination:{host:t.proxies[e+1].host||t.proxies[e+1].ipaddress,port:t.proxies[e+1].port},n=yield d.createConnection({command:"connect",proxy:s,destination:i,existing_socket:r});r=r||n.socket}"function"==typeof e?(e(null,{socket:r}),s({socket:r})):s({socket:r})}catch(t){"function"==typeof e?(e(t),s(t)):i(t)}}))))}static createUDPFrame(t){const e=new o.SmartBuffer;return e.writeUInt16BE(0),e.writeUInt8(t.frameNumber||0),n.isIPv4(t.remoteHost.host)?(e.writeUInt8(a.Socks5HostType.IPv4),e.writeUInt32BE((0,h.ipv4ToInt32)(t.remoteHost.host))):n.isIPv6(t.remoteHost.host)?(e.writeUInt8(a.Socks5HostType.IPv6),e.writeBuffer((0,h.ipToBuffer)(t.remoteHost.host))):(e.writeUInt8(a.Socks5HostType.Hostname),e.writeUInt8(Buffer.byteLength(t.remoteHost.host)),e.writeString(t.remoteHost.host)),e.writeUInt16BE(t.remoteHost.port),e.writeBuffer(t.data),e.toBuffer()}static parseUDPFrame(t){const e=o.SmartBuffer.fromBuffer(t);e.readOffset=2;const s=e.readUInt8(),r=e.readUInt8();let i;return i=r===a.Socks5HostType.IPv4?(0,h.int32ToIpv4)(e.readUInt32BE()):r===a.Socks5HostType.IPv6?u.Address6.fromByteArray(Array.from(e.readBuffer(16))).canonicalForm():e.readString(e.readUInt8()),{frameNumber:s,remoteHost:{host:i,port:e.readUInt16BE()},data:e.readBuffer()}}setState(t){this.state!==a.SocksClientState.Error&&(this.state=t)}connect(t){this.onDataReceived=t=>this.onDataReceivedHandler(t),this.onClose=()=>this.onCloseHandler(),this.onError=t=>this.onErrorHandler(t),this.onConnect=()=>this.onConnectHandler();const e=setTimeout((()=>this.onEstablishedTimeout()),this.options.timeout||a.DEFAULT_TIMEOUT);e.unref&&"function"==typeof e.unref&&e.unref(),this.socket=t||new n.Socket,this.socket.once("close",this.onClose),this.socket.once("error",this.onError),this.socket.once("connect",this.onConnect),this.socket.on("data",this.onDataReceived),this.setState(a.SocksClientState.Connecting),this.receiveBuffer=new l.ReceiveBuffer,t?this.socket.emit("connect"):(this.socket.connect(this.getSocketOptions()),void 0!==this.options.set_tcp_nodelay&&null!==this.options.set_tcp_nodelay&&this.socket.setNoDelay(!!this.options.set_tcp_nodelay)),this.prependOnceListener("established",(t=>{setImmediate((()=>{if(this.receiveBuffer.length>0){const e=this.receiveBuffer.get(this.receiveBuffer.length);t.socket.emit("data",e)}t.socket.resume()}))}))}getSocketOptions(){return Object.assign(Object.assign({},this.options.socket_options),{host:this.options.proxy.host||this.options.proxy.ipaddress,port:this.options.proxy.port})}onEstablishedTimeout(){this.state!==a.SocksClientState.Established&&this.state!==a.SocksClientState.BoundWaitingForConnection&&this.closeSocket(a.ERRORS.ProxyConnectionTimedOut)}onConnectHandler(){this.setState(a.SocksClientState.Connected),4===this.options.proxy.type?this.sendSocks4InitialHandshake():this.sendSocks5InitialHandshake(),this.setState(a.SocksClientState.SentInitialHandshake)}onDataReceivedHandler(t){this.receiveBuffer.append(t),this.processData()}processData(){for(;this.state!==a.SocksClientState.Established&&this.state!==a.SocksClientState.Error&&this.receiveBuffer.length>=this.nextRequiredPacketBufferSize;)if(this.state===a.SocksClientState.SentInitialHandshake)4===this.options.proxy.type?this.handleSocks4FinalHandshakeResponse():this.handleInitialSocks5HandshakeResponse();else if(this.state===a.SocksClientState.SentAuthentication)this.handleInitialSocks5AuthenticationHandshakeResponse();else if(this.state===a.SocksClientState.SentFinalHandshake)this.handleSocks5FinalHandshakeResponse();else{if(this.state!==a.SocksClientState.BoundWaitingForConnection){this.closeSocket(a.ERRORS.InternalError);break}4===this.options.proxy.type?this.handleSocks4IncomingConnectionResponse():this.handleSocks5IncomingConnectionResponse()}}onCloseHandler(){this.closeSocket(a.ERRORS.SocketClosed)}onErrorHandler(t){this.closeSocket(t.message)}removeInternalSocketHandlers(){this.socket.pause(),this.socket.removeListener("data",this.onDataReceived),this.socket.removeListener("close",this.onClose),this.socket.removeListener("error",this.onError),this.socket.removeListener("connect",this.onConnect)}closeSocket(t){this.state!==a.SocksClientState.Error&&(this.setState(a.SocksClientState.Error),this.socket.destroy(),this.removeInternalSocketHandlers(),this.emit("error",new c.SocksClientError(t,this.options)))}sendSocks4InitialHandshake(){const t=this.options.proxy.userId||"",e=new o.SmartBuffer;e.writeUInt8(4),e.writeUInt8(a.SocksCommand[this.options.command]),e.writeUInt16BE(this.options.destination.port),n.isIPv4(this.options.destination.host)?(e.writeBuffer((0,h.ipToBuffer)(this.options.destination.host)),e.writeStringNT(t)):(e.writeUInt8(0),e.writeUInt8(0),e.writeUInt8(0),e.writeUInt8(1),e.writeStringNT(t),e.writeStringNT(this.options.destination.host)),this.nextRequiredPacketBufferSize=a.SOCKS_INCOMING_PACKET_SIZES.Socks4Response,this.socket.write(e.toBuffer())}handleSocks4FinalHandshakeResponse(){const t=this.receiveBuffer.get(8);if(t[1]!==a.Socks4Response.Granted)this.closeSocket(`${a.ERRORS.Socks4ProxyRejectedConnection} - (${a.Socks4Response[t[1]]})`);else if(a.SocksCommand[this.options.command]===a.SocksCommand.bind){const e=o.SmartBuffer.fromBuffer(t);e.readOffset=2;const s={port:e.readUInt16BE(),host:(0,h.int32ToIpv4)(e.readUInt32BE())};"0.0.0.0"===s.host&&(s.host=this.options.proxy.ipaddress),this.setState(a.SocksClientState.BoundWaitingForConnection),this.emit("bound",{remoteHost:s,socket:this.socket})}else this.setState(a.SocksClientState.Established),this.removeInternalSocketHandlers(),this.emit("established",{socket:this.socket})}handleSocks4IncomingConnectionResponse(){const t=this.receiveBuffer.get(8);if(t[1]!==a.Socks4Response.Granted)this.closeSocket(`${a.ERRORS.Socks4ProxyRejectedIncomingBoundConnection} - (${a.Socks4Response[t[1]]})`);else{const e=o.SmartBuffer.fromBuffer(t);e.readOffset=2;const s={port:e.readUInt16BE(),host:(0,h.int32ToIpv4)(e.readUInt32BE())};this.setState(a.SocksClientState.Established),this.removeInternalSocketHandlers(),this.emit("established",{remoteHost:s,socket:this.socket})}}sendSocks5InitialHandshake(){const t=new o.SmartBuffer,e=[a.Socks5Auth.NoAuth];(this.options.proxy.userId||this.options.proxy.password)&&e.push(a.Socks5Auth.UserPass),void 0!==this.options.proxy.custom_auth_method&&e.push(this.options.proxy.custom_auth_method),t.writeUInt8(5),t.writeUInt8(e.length);for(const s of e)t.writeUInt8(s);this.nextRequiredPacketBufferSize=a.SOCKS_INCOMING_PACKET_SIZES.Socks5InitialHandshakeResponse,this.socket.write(t.toBuffer()),this.setState(a.SocksClientState.SentInitialHandshake)}handleInitialSocks5HandshakeResponse(){const t=this.receiveBuffer.get(2);5!==t[0]?this.closeSocket(a.ERRORS.InvalidSocks5IntiailHandshakeSocksVersion):t[1]===a.SOCKS5_NO_ACCEPTABLE_AUTH?this.closeSocket(a.ERRORS.InvalidSocks5InitialHandshakeNoAcceptedAuthType):t[1]===a.Socks5Auth.NoAuth?(this.socks5ChosenAuthType=a.Socks5Auth.NoAuth,this.sendSocks5CommandRequest()):t[1]===a.Socks5Auth.UserPass?(this.socks5ChosenAuthType=a.Socks5Auth.UserPass,this.sendSocks5UserPassAuthentication()):t[1]===this.options.proxy.custom_auth_method?(this.socks5ChosenAuthType=this.options.proxy.custom_auth_method,this.sendSocks5CustomAuthentication()):this.closeSocket(a.ERRORS.InvalidSocks5InitialHandshakeUnknownAuthType)}sendSocks5UserPassAuthentication(){const t=this.options.proxy.userId||"",e=this.options.proxy.password||"",s=new o.SmartBuffer;s.writeUInt8(1),s.writeUInt8(Buffer.byteLength(t)),s.writeString(t),s.writeUInt8(Buffer.byteLength(e)),s.writeString(e),this.nextRequiredPacketBufferSize=a.SOCKS_INCOMING_PACKET_SIZES.Socks5UserPassAuthenticationResponse,this.socket.write(s.toBuffer()),this.setState(a.SocksClientState.SentAuthentication)}sendSocks5CustomAuthentication(){return r(this,void 0,void 0,(function*(){this.nextRequiredPacketBufferSize=this.options.proxy.custom_auth_response_size,this.socket.write(yield this.options.proxy.custom_auth_request_handler()),this.setState(a.SocksClientState.SentAuthentication)}))}handleSocks5CustomAuthHandshakeResponse(t){return r(this,void 0,void 0,(function*(){return yield this.options.proxy.custom_auth_response_handler(t)}))}handleSocks5AuthenticationNoAuthHandshakeResponse(t){return r(this,void 0,void 0,(function*(){return 0===t[1]}))}handleSocks5AuthenticationUserPassHandshakeResponse(t){return r(this,void 0,void 0,(function*(){return 0===t[1]}))}handleInitialSocks5AuthenticationHandshakeResponse(){return r(this,void 0,void 0,(function*(){this.setState(a.SocksClientState.ReceivedAuthenticationResponse);let t=!1;this.socks5ChosenAuthType===a.Socks5Auth.NoAuth?t=yield this.handleSocks5AuthenticationNoAuthHandshakeResponse(this.receiveBuffer.get(2)):this.socks5ChosenAuthType===a.Socks5Auth.UserPass?t=yield this.handleSocks5AuthenticationUserPassHandshakeResponse(this.receiveBuffer.get(2)):this.socks5ChosenAuthType===this.options.proxy.custom_auth_method&&(t=yield this.handleSocks5CustomAuthHandshakeResponse(this.receiveBuffer.get(this.options.proxy.custom_auth_response_size))),t?this.sendSocks5CommandRequest():this.closeSocket(a.ERRORS.Socks5AuthenticationFailed)}))}sendSocks5CommandRequest(){const t=new o.SmartBuffer;t.writeUInt8(5),t.writeUInt8(a.SocksCommand[this.options.command]),t.writeUInt8(0),n.isIPv4(this.options.destination.host)?(t.writeUInt8(a.Socks5HostType.IPv4),t.writeBuffer((0,h.ipToBuffer)(this.options.destination.host))):n.isIPv6(this.options.destination.host)?(t.writeUInt8(a.Socks5HostType.IPv6),t.writeBuffer((0,h.ipToBuffer)(this.options.destination.host))):(t.writeUInt8(a.Socks5HostType.Hostname),t.writeUInt8(this.options.destination.host.length),t.writeString(this.options.destination.host)),t.writeUInt16BE(this.options.destination.port),this.nextRequiredPacketBufferSize=a.SOCKS_INCOMING_PACKET_SIZES.Socks5ResponseHeader,this.socket.write(t.toBuffer()),this.setState(a.SocksClientState.SentFinalHandshake)}handleSocks5FinalHandshakeResponse(){const t=this.receiveBuffer.peek(5);if(5!==t[0]||t[1]!==a.Socks5Response.Granted)this.closeSocket(`${a.ERRORS.InvalidSocks5FinalHandshakeRejected} - ${a.Socks5Response[t[1]]}`);else{const e=t[3];let s,r;if(e===a.Socks5HostType.IPv4){const t=a.SOCKS_INCOMING_PACKET_SIZES.Socks5ResponseIPv4;if(this.receiveBuffer.length<t)return void(this.nextRequiredPacketBufferSize=t);r=o.SmartBuffer.fromBuffer(this.receiveBuffer.get(t).slice(4)),s={host:(0,h.int32ToIpv4)(r.readUInt32BE()),port:r.readUInt16BE()},"0.0.0.0"===s.host&&(s.host=this.options.proxy.ipaddress)}else if(e===a.Socks5HostType.Hostname){const e=t[4],i=a.SOCKS_INCOMING_PACKET_SIZES.Socks5ResponseHostname(e);if(this.receiveBuffer.length<i)return void(this.nextRequiredPacketBufferSize=i);r=o.SmartBuffer.fromBuffer(this.receiveBuffer.get(i).slice(5)),s={host:r.readString(e),port:r.readUInt16BE()}}else if(e===a.Socks5HostType.IPv6){const t=a.SOCKS_INCOMING_PACKET_SIZES.Socks5ResponseIPv6;if(this.receiveBuffer.length<t)return void(this.nextRequiredPacketBufferSize=t);r=o.SmartBuffer.fromBuffer(this.receiveBuffer.get(t).slice(4)),s={host:u.Address6.fromByteArray(Array.from(r.readBuffer(16))).canonicalForm(),port:r.readUInt16BE()}}this.setState(a.SocksClientState.ReceivedFinalResponse),a.SocksCommand[this.options.command]===a.SocksCommand.connect?(this.setState(a.SocksClientState.Established),this.removeInternalSocketHandlers(),this.emit("established",{remoteHost:s,socket:this.socket})):a.SocksCommand[this.options.command]===a.SocksCommand.bind?(this.setState(a.SocksClientState.BoundWaitingForConnection),this.nextRequiredPacketBufferSize=a.SOCKS_INCOMING_PACKET_SIZES.Socks5ResponseHeader,this.emit("bound",{remoteHost:s,socket:this.socket})):a.SocksCommand[this.options.command]===a.SocksCommand.associate&&(this.setState(a.SocksClientState.Established),this.removeInternalSocketHandlers(),this.emit("established",{remoteHost:s,socket:this.socket}))}}handleSocks5IncomingConnectionResponse(){const t=this.receiveBuffer.peek(5);if(5!==t[0]||t[1]!==a.Socks5Response.Granted)this.closeSocket(`${a.ERRORS.Socks5ProxyRejectedIncomingBoundConnection} - ${a.Socks5Response[t[1]]}`);else{const e=t[3];let s,r;if(e===a.Socks5HostType.IPv4){const t=a.SOCKS_INCOMING_PACKET_SIZES.Socks5ResponseIPv4;if(this.receiveBuffer.length<t)return void(this.nextRequiredPacketBufferSize=t);r=o.SmartBuffer.fromBuffer(this.receiveBuffer.get(t).slice(4)),s={host:(0,h.int32ToIpv4)(r.readUInt32BE()),port:r.readUInt16BE()},"0.0.0.0"===s.host&&(s.host=this.options.proxy.ipaddress)}else if(e===a.Socks5HostType.Hostname){const e=t[4],i=a.SOCKS_INCOMING_PACKET_SIZES.Socks5ResponseHostname(e);if(this.receiveBuffer.length<i)return void(this.nextRequiredPacketBufferSize=i);r=o.SmartBuffer.fromBuffer(this.receiveBuffer.get(i).slice(5)),s={host:r.readString(e),port:r.readUInt16BE()}}else if(e===a.Socks5HostType.IPv6){const t=a.SOCKS_INCOMING_PACKET_SIZES.Socks5ResponseIPv6;if(this.receiveBuffer.length<t)return void(this.nextRequiredPacketBufferSize=t);r=o.SmartBuffer.fromBuffer(this.receiveBuffer.get(t).slice(4)),s={host:u.Address6.fromByteArray(Array.from(r.readBuffer(16))).canonicalForm(),port:r.readUInt16BE()}}this.setState(a.SocksClientState.Established),this.removeInternalSocketHandlers(),this.emit("established",{remoteHost:s,socket:this.socket})}}get socksClientOptions(){return Object.assign({},this.options)}}e.SocksClient=d},7638:(t,e,s)=>{"use strict";const r=s(8311);t.exports=(t,e,s)=>{try{e=new r(e,s)}catch(t){return!1}return e.test(t)}},7736:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ReceiveBuffer=void 0,e.ReceiveBuffer=class{constructor(t=4096){this.buffer=Buffer.allocUnsafe(t),this.offset=0,this.originalSize=t}get length(){return this.offset}append(t){if(!Buffer.isBuffer(t))throw new Error("Attempted to append a non-buffer instance to ReceiveBuffer.");if(this.offset+t.length>=this.buffer.length){const e=this.buffer;this.buffer=Buffer.allocUnsafe(Math.max(this.buffer.length+this.originalSize,this.buffer.length+t.length)),e.copy(this.buffer)}return t.copy(this.buffer,this.offset),this.offset+=t.length}peek(t){if(t>this.offset)throw new Error("Attempted to read beyond the bounds of the managed internal data.");return this.buffer.slice(0,t)}get(t){if(t>this.offset)throw new Error("Attempted to read beyond the bounds of the managed internal data.");const e=Buffer.allocUnsafe(t);return this.buffer.slice(0,t).copy(e),this.buffer.copyWithin(0,t,t+this.offset-t),this.offset-=t,e}}},8311:(t,e,s)=>{"use strict";const r=/\s+/g;class i{constructor(t,e){if(e=o(e),t instanceof i)return t.loose===!!e.loose&&t.includePrerelease===!!e.includePrerelease?t:new i(t.raw,e);if(t instanceof a)return this.raw=t.value,this.set=[[t]],this.formatted=void 0,this;if(this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease,this.raw=t.trim().replace(r," "),this.set=this.raw.split("||").map((t=>this.parseRange(t.trim()))).filter((t=>t.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const t=this.set[0];if(this.set=this.set.filter((t=>!E(t[0]))),0===this.set.length)this.set=[t];else if(this.set.length>1)for(const t of this.set)if(1===t.length&&S(t[0])){this.set=[t];break}}this.formatted=void 0}get range(){if(void 0===this.formatted){this.formatted="";for(let t=0;t<this.set.length;t++){t>0&&(this.formatted+="||");const e=this.set[t];for(let t=0;t<e.length;t++)t>0&&(this.formatted+=" "),this.formatted+=e[t].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(t){const e=((this.options.includePrerelease&&m)|(this.options.loose&&g))+":"+t,s=n.get(e);if(s)return s;const r=this.options.loose,i=r?c[u.HYPHENRANGELOOSE]:c[u.HYPHENRANGE];t=t.replace(i,C(this.options.includePrerelease)),h("hyphen replace",t),t=t.replace(c[u.COMPARATORTRIM],d),h("comparator trim",t),t=t.replace(c[u.TILDETRIM],p),h("tilde trim",t),t=t.replace(c[u.CARETTRIM],f),h("caret trim",t);let o=t.split(" ").map((t=>v(t,this.options))).join(" ").split(/\s+/).map((t=>k(t,this.options)));r&&(o=o.filter((t=>(h("loose invalid filter",t,this.options),!!t.match(c[u.COMPARATORLOOSE]))))),h("range list",o);const l=new Map,S=o.map((t=>new a(t,this.options)));for(const t of S){if(E(t))return[t];l.set(t.value,t)}l.size>1&&l.has("")&&l.delete("");const w=[...l.values()];return n.set(e,w),w}intersects(t,e){if(!(t instanceof i))throw new TypeError("a Range is required");return this.set.some((s=>w(s,e)&&t.set.some((t=>w(t,e)&&s.every((s=>t.every((t=>s.intersects(t,e)))))))))}test(t){if(!t)return!1;if("string"==typeof t)try{t=new l(t,this.options)}catch(t){return!1}for(let e=0;e<this.set.length;e++)if(A(this.set[e],t,this.options))return!0;return!1}}t.exports=i;const n=new(s(8794)),o=s(8587),a=s(3904),h=s(7272),l=s(3908),{safeRe:c,t:u,comparatorTrimReplace:d,tildeTrimReplace:p,caretTrimReplace:f}=s(9718),{FLAG_INCLUDE_PRERELEASE:m,FLAG_LOOSE:g}=s(6874),E=t=>"<0.0.0-0"===t.value,S=t=>""===t.value,w=(t,e)=>{let s=!0;const r=t.slice();let i=r.pop();for(;s&&r.length;)s=r.every((t=>i.intersects(t,e))),i=r.pop();return s},v=(t,e)=>(h("comp",t,e),t=I(t,e),h("caret",t),t=y(t,e),h("tildes",t),t=$(t,e),h("xrange",t),t=O(t,e),h("stars",t),t),R=t=>!t||"x"===t.toLowerCase()||"*"===t,y=(t,e)=>t.trim().split(/\s+/).map((t=>_(t,e))).join(" "),_=(t,e)=>{const s=e.loose?c[u.TILDELOOSE]:c[u.TILDE];return t.replace(s,((e,s,r,i,n)=>{let o;return h("tilde",t,e,s,r,i,n),R(s)?o="":R(r)?o=`>=${s}.0.0 <${+s+1}.0.0-0`:R(i)?o=`>=${s}.${r}.0 <${s}.${+r+1}.0-0`:n?(h("replaceTilde pr",n),o=`>=${s}.${r}.${i}-${n} <${s}.${+r+1}.0-0`):o=`>=${s}.${r}.${i} <${s}.${+r+1}.0-0`,h("tilde return",o),o}))},I=(t,e)=>t.trim().split(/\s+/).map((t=>b(t,e))).join(" "),b=(t,e)=>{h("caret",t,e);const s=e.loose?c[u.CARETLOOSE]:c[u.CARET],r=e.includePrerelease?"-0":"";return t.replace(s,((e,s,i,n,o)=>{let a;return h("caret",t,e,s,i,n,o),R(s)?a="":R(i)?a=`>=${s}.0.0${r} <${+s+1}.0.0-0`:R(n)?a="0"===s?`>=${s}.${i}.0${r} <${s}.${+i+1}.0-0`:`>=${s}.${i}.0${r} <${+s+1}.0.0-0`:o?(h("replaceCaret pr",o),a="0"===s?"0"===i?`>=${s}.${i}.${n}-${o} <${s}.${i}.${+n+1}-0`:`>=${s}.${i}.${n}-${o} <${s}.${+i+1}.0-0`:`>=${s}.${i}.${n}-${o} <${+s+1}.0.0-0`):(h("no pr"),a="0"===s?"0"===i?`>=${s}.${i}.${n}${r} <${s}.${i}.${+n+1}-0`:`>=${s}.${i}.${n}${r} <${s}.${+i+1}.0-0`:`>=${s}.${i}.${n} <${+s+1}.0.0-0`),h("caret return",a),a}))},$=(t,e)=>(h("replaceXRanges",t,e),t.split(/\s+/).map((t=>T(t,e))).join(" ")),T=(t,e)=>{t=t.trim();const s=e.loose?c[u.XRANGELOOSE]:c[u.XRANGE];return t.replace(s,((s,r,i,n,o,a)=>{h("xRange",t,s,r,i,n,o,a);const l=R(i),c=l||R(n),u=c||R(o),d=u;return"="===r&&d&&(r=""),a=e.includePrerelease?"-0":"",l?s=">"===r||"<"===r?"<0.0.0-0":"*":r&&d?(c&&(n=0),o=0,">"===r?(r=">=",c?(i=+i+1,n=0,o=0):(n=+n+1,o=0)):"<="===r&&(r="<",c?i=+i+1:n=+n+1),"<"===r&&(a="-0"),s=`${r+i}.${n}.${o}${a}`):c?s=`>=${i}.0.0${a} <${+i+1}.0.0-0`:u&&(s=`>=${i}.${n}.0${a} <${i}.${+n+1}.0-0`),h("xRange return",s),s}))},O=(t,e)=>(h("replaceStars",t,e),t.trim().replace(c[u.STAR],"")),k=(t,e)=>(h("replaceGTE0",t,e),t.trim().replace(c[e.includePrerelease?u.GTE0PRE:u.GTE0],"")),C=t=>(e,s,r,i,n,o,a,h,l,c,u,d)=>`${s=R(r)?"":R(i)?`>=${r}.0.0${t?"-0":""}`:R(n)?`>=${r}.${i}.0${t?"-0":""}`:o?`>=${s}`:`>=${s}${t?"-0":""}`} ${h=R(l)?"":R(c)?`<${+l+1}.0.0-0`:R(u)?`<${l}.${+c+1}.0-0`:d?`<=${l}.${c}.${u}-${d}`:t?`<${l}.${c}.${+u+1}-0`:`<=${h}`}`.trim(),A=(t,e,s)=>{for(let s=0;s<t.length;s++)if(!t[s].test(e))return!1;if(e.prerelease.length&&!s.includePrerelease){for(let s=0;s<t.length;s++)if(h(t[s].semver),t[s].semver!==a.ANY&&t[s].semver.prerelease.length>0){const r=t[s].semver;if(r.major===e.major&&r.minor===e.minor&&r.patch===e.patch)return!0}return!1}return!0}},8422:(t,e,s)=>{var r=s(8505);t.exports=function(t){return t?("{}"===t.substr(0,2)&&(t="\\{\\}"+t.substr(2)),g(function(t){return t.split("\\\\").join(i).split("\\{").join(n).split("\\}").join(o).split("\\,").join(a).split("\\.").join(h)}(t),!0).map(c)):[]};var i="\0SLASH"+Math.random()+"\0",n="\0OPEN"+Math.random()+"\0",o="\0CLOSE"+Math.random()+"\0",a="\0COMMA"+Math.random()+"\0",h="\0PERIOD"+Math.random()+"\0";function l(t){return parseInt(t,10)==t?parseInt(t,10):t.charCodeAt(0)}function c(t){return t.split(i).join("\\").split(n).join("{").split(o).join("}").split(a).join(",").split(h).join(".")}function u(t){if(!t)return[""];var e=[],s=r("{","}",t);if(!s)return t.split(",");var i=s.pre,n=s.body,o=s.post,a=i.split(",");a[a.length-1]+="{"+n+"}";var h=u(o);return o.length&&(a[a.length-1]+=h.shift(),a.push.apply(a,h)),e.push.apply(e,a),e}function d(t){return"{"+t+"}"}function p(t){return/^-?0\d/.test(t)}function f(t,e){return t<=e}function m(t,e){return t>=e}function g(t,e){var s=[],i=r("{","}",t);if(!i)return[t];var n=i.pre,a=i.post.length?g(i.post,!1):[""];if(/\$$/.test(i.pre))for(var h=0;h<a.length;h++){var c=n+"{"+i.body+"}"+a[h];s.push(c)}else{var E,S,w=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(i.body),v=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(i.body),R=w||v,y=i.body.indexOf(",")>=0;if(!R&&!y)return i.post.match(/,.*\}/)?g(t=i.pre+"{"+i.body+o+i.post):[t];if(R)E=i.body.split(/\.\./);else if(1===(E=u(i.body)).length&&1===(E=g(E[0],!1).map(d)).length)return a.map((function(t){return i.pre+E[0]+t}));if(R){var _=l(E[0]),I=l(E[1]),b=Math.max(E[0].length,E[1].length),$=3==E.length?Math.abs(l(E[2])):1,T=f;I<_&&($*=-1,T=m);var O=E.some(p);S=[];for(var k=_;T(k,I);k+=$){var C;if(v)"\\"===(C=String.fromCharCode(k))&&(C="");else if(C=String(k),O){var A=b-C.length;if(A>0){var L=new Array(A+1).join("0");C=k<0?"-"+L+C.slice(1):L+C}}S.push(C)}}else{S=[];for(var x=0;x<E.length;x++)S.push.apply(S,g(E[x],!1))}for(x=0;x<S.length;x++)for(h=0;h<a.length;h++)c=n+S[x]+a[h],(!e||R||c)&&s.push(c)}return s}},8505:t=>{"use strict";function e(t,e,i){t instanceof RegExp&&(t=s(t,i)),e instanceof RegExp&&(e=s(e,i));var n=r(t,e,i);return n&&{start:n[0],end:n[1],pre:i.slice(0,n[0]),body:i.slice(n[0]+t.length,n[1]),post:i.slice(n[1]+e.length)}}function s(t,e){var s=e.match(t);return s?s[0]:null}function r(t,e,s){var r,i,n,o,a,h=s.indexOf(t),l=s.indexOf(e,h+1),c=h;if(h>=0&&l>0){if(t===e)return[h,l];for(r=[],n=s.length;c>=0&&!a;)c==h?(r.push(c),h=s.indexOf(t,c+1)):1==r.length?a=[r.pop(),l]:((i=r.pop())<n&&(n=i,o=l),l=s.indexOf(e,c+1)),c=h<l&&h>=0?h:l;r.length&&(a=[n,o])}return a}t.exports=e,e.range=r},8587:t=>{"use strict";const e=Object.freeze({loose:!0}),s=Object.freeze({});t.exports=t=>t?"object"!=typeof t?e:t:s},8601:(t,e)=>{"use strict";function s(t,e){return t=function(t){for(let e of"\\()[]{}.+^$|")t=t.replace(new RegExp("\\"+e,"g"),"\\"+e);return t}(t),t=t.replace(/\*/g,".*").replace(/\?/g,".?"),new RegExp("^(?:"+t+")$").test(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){const r=Array.isArray(t)?t:t.split(/,/);let i=!1;for(const t of r){if("!"==t[0]&&s(t.slice(1),e))return!1;s(t,e)&&(i=!0)}return i}},8794:t=>{"use strict";t.exports=class{constructor(){this.max=1e3,this.map=new Map}get(t){const e=this.map.get(t);return void 0===e?void 0:(this.map.delete(t),this.map.set(t,e),e)}delete(t){return this.map.delete(t)}set(t,e){if(!this.delete(t)&&void 0!==e){if(this.map.size>=this.max){const t=this.map.keys().next().value;this.delete(t)}this.map.set(t,e)}return this}}},8914:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RE_URL_WITH_PORT=e.RE_URL=e.RE_ZONE_STRING=e.RE_SUBNET_STRING=e.RE_BAD_ADDRESS=e.RE_BAD_CHARACTERS=e.TYPES=e.SCOPES=e.GROUPS=e.BITS=void 0,e.BITS=128,e.GROUPS=8,e.SCOPES={0:"Reserved",1:"Interface local",2:"Link local",4:"Admin local",5:"Site local",8:"Organization local",14:"Global",15:"Reserved"},e.TYPES={"ff01::1/128":"Multicast (All nodes on this interface)","ff01::2/128":"Multicast (All routers on this interface)","ff02::1/128":"Multicast (All nodes on this link)","ff02::2/128":"Multicast (All routers on this link)","ff05::2/128":"Multicast (All routers in this site)","ff02::5/128":"Multicast (OSPFv3 AllSPF routers)","ff02::6/128":"Multicast (OSPFv3 AllDR routers)","ff02::9/128":"Multicast (RIP routers)","ff02::a/128":"Multicast (EIGRP routers)","ff02::d/128":"Multicast (PIM routers)","ff02::16/128":"Multicast (MLDv2 reports)","ff01::fb/128":"Multicast (mDNSv6)","ff02::fb/128":"Multicast (mDNSv6)","ff05::fb/128":"Multicast (mDNSv6)","ff02::1:2/128":"Multicast (All DHCP servers and relay agents on this link)","ff05::1:2/128":"Multicast (All DHCP servers and relay agents in this site)","ff02::1:3/128":"Multicast (All DHCP servers on this link)","ff05::1:3/128":"Multicast (All DHCP servers in this site)","::/128":"Unspecified","::1/128":"Loopback","ff00::/8":"Multicast","fe80::/10":"Link-local unicast"},e.RE_BAD_CHARACTERS=/([^0-9a-f:/%])/gi,e.RE_BAD_ADDRESS=/([0-9a-f]{5,}|:{3,}|[^:]:$|^:[^:]|\/$)/gi,e.RE_SUBNET_STRING=/\/\d{1,3}(?=%|$)/,e.RE_ZONE_STRING=/%.*$/,e.RE_URL=new RegExp(/^\[{0,1}([0-9a-f:]+)\]{0,1}/),e.RE_URL_WITH_PORT=new RegExp(/\[([0-9a-f:]+)\]:([0-9]{1,5})/)},9278:t=>{"use strict";t.exports=require("net")},9424:function(t,e,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,s,r){void 0===r&&(r=s);var i=Object.getOwnPropertyDescriptor(e,s);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[s]}}),Object.defineProperty(t,r,i)}:function(t,e,s,r){void 0===r&&(r=s),t[r]=e[s]}),i=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),n=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var s in t)"default"!==s&&Object.prototype.hasOwnProperty.call(t,s)&&r(e,t,s);return i(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.v6=e.AddressError=e.Address6=e.Address4=void 0;const o=s(2839);Object.defineProperty(e,"Address4",{enumerable:!0,get:function(){return o.Address4}});const a=s(6329);Object.defineProperty(e,"Address6",{enumerable:!0,get:function(){return a.Address6}});const h=s(2437);Object.defineProperty(e,"AddressError",{enumerable:!0,get:function(){return h.AddressError}});const l=n(s(2846));e.v6={helpers:l}},9534:function(t,e){(function(){var e;function s(t,e,s){null!=t&&("number"==typeof t?this.fromNumber(t,e,s):null==e&&"string"!=typeof t?this.fromString(t,256):this.fromString(t,e))}function r(){return new s(null)}var i="undefined"!=typeof navigator;i&&"Microsoft Internet Explorer"==navigator.appName?(s.prototype.am=function(t,e,s,r,i,n){for(var o=32767&e,a=e>>15;--n>=0;){var h=32767&this[t],l=this[t++]>>15,c=a*h+l*o;i=((h=o*h+((32767&c)<<15)+s[r]+(1073741823&i))>>>30)+(c>>>15)+a*l+(i>>>30),s[r++]=1073741823&h}return i},e=30):i&&"Netscape"!=navigator.appName?(s.prototype.am=function(t,e,s,r,i,n){for(;--n>=0;){var o=e*this[t++]+s[r]+i;i=Math.floor(o/67108864),s[r++]=67108863&o}return i},e=26):(s.prototype.am=function(t,e,s,r,i,n){for(var o=16383&e,a=e>>14;--n>=0;){var h=16383&this[t],l=this[t++]>>14,c=a*h+l*o;i=((h=o*h+((16383&c)<<14)+s[r]+i)>>28)+(c>>14)+a*l,s[r++]=268435455&h}return i},e=28),s.prototype.DB=e,s.prototype.DM=(1<<e)-1,s.prototype.DV=1<<e,s.prototype.FV=Math.pow(2,52),s.prototype.F1=52-e,s.prototype.F2=2*e-52;var n,o,a=new Array;for(n="0".charCodeAt(0),o=0;o<=9;++o)a[n++]=o;for(n="a".charCodeAt(0),o=10;o<36;++o)a[n++]=o;for(n="A".charCodeAt(0),o=10;o<36;++o)a[n++]=o;function h(t){return"0123456789abcdefghijklmnopqrstuvwxyz".charAt(t)}function l(t,e){var s=a[t.charCodeAt(e)];return null==s?-1:s}function c(t){var e=r();return e.fromInt(t),e}function u(t){var e,s=1;return 0!=(e=t>>>16)&&(t=e,s+=16),0!=(e=t>>8)&&(t=e,s+=8),0!=(e=t>>4)&&(t=e,s+=4),0!=(e=t>>2)&&(t=e,s+=2),0!=(e=t>>1)&&(t=e,s+=1),s}function d(t){this.m=t}function p(t){this.m=t,this.mp=t.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function f(t,e){return t&e}function m(t,e){return t|e}function g(t,e){return t^e}function E(t,e){return t&~e}function S(t){if(0==t)return-1;var e=0;return 65535&t||(t>>=16,e+=16),255&t||(t>>=8,e+=8),15&t||(t>>=4,e+=4),3&t||(t>>=2,e+=2),1&t||++e,e}function w(t){for(var e=0;0!=t;)t&=t-1,++e;return e}function v(){}function R(t){return t}function y(t){this.r2=r(),this.q3=r(),s.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t),this.m=t}d.prototype.convert=function(t){return t.s<0||t.compareTo(this.m)>=0?t.mod(this.m):t},d.prototype.revert=function(t){return t},d.prototype.reduce=function(t){t.divRemTo(this.m,null,t)},d.prototype.mulTo=function(t,e,s){t.multiplyTo(e,s),this.reduce(s)},d.prototype.sqrTo=function(t,e){t.squareTo(e),this.reduce(e)},p.prototype.convert=function(t){var e=r();return t.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),t.s<0&&e.compareTo(s.ZERO)>0&&this.m.subTo(e,e),e},p.prototype.revert=function(t){var e=r();return t.copyTo(e),this.reduce(e),e},p.prototype.reduce=function(t){for(;t.t<=this.mt2;)t[t.t++]=0;for(var e=0;e<this.m.t;++e){var s=32767&t[e],r=s*this.mpl+((s*this.mph+(t[e]>>15)*this.mpl&this.um)<<15)&t.DM;for(t[s=e+this.m.t]+=this.m.am(0,r,t,e,0,this.m.t);t[s]>=t.DV;)t[s]-=t.DV,t[++s]++}t.clamp(),t.drShiftTo(this.m.t,t),t.compareTo(this.m)>=0&&t.subTo(this.m,t)},p.prototype.mulTo=function(t,e,s){t.multiplyTo(e,s),this.reduce(s)},p.prototype.sqrTo=function(t,e){t.squareTo(e),this.reduce(e)},s.prototype.copyTo=function(t){for(var e=this.t-1;e>=0;--e)t[e]=this[e];t.t=this.t,t.s=this.s},s.prototype.fromInt=function(t){this.t=1,this.s=t<0?-1:0,t>0?this[0]=t:t<-1?this[0]=t+this.DV:this.t=0},s.prototype.fromString=function(t,e){var r;if(16==e)r=4;else if(8==e)r=3;else if(256==e)r=8;else if(2==e)r=1;else if(32==e)r=5;else{if(4!=e)return void this.fromRadix(t,e);r=2}this.t=0,this.s=0;for(var i=t.length,n=!1,o=0;--i>=0;){var a=8==r?255&t[i]:l(t,i);a<0?"-"==t.charAt(i)&&(n=!0):(n=!1,0==o?this[this.t++]=a:o+r>this.DB?(this[this.t-1]|=(a&(1<<this.DB-o)-1)<<o,this[this.t++]=a>>this.DB-o):this[this.t-1]|=a<<o,(o+=r)>=this.DB&&(o-=this.DB))}8==r&&128&t[0]&&(this.s=-1,o>0&&(this[this.t-1]|=(1<<this.DB-o)-1<<o)),this.clamp(),n&&s.ZERO.subTo(this,this)},s.prototype.clamp=function(){for(var t=this.s&this.DM;this.t>0&&this[this.t-1]==t;)--this.t},s.prototype.dlShiftTo=function(t,e){var s;for(s=this.t-1;s>=0;--s)e[s+t]=this[s];for(s=t-1;s>=0;--s)e[s]=0;e.t=this.t+t,e.s=this.s},s.prototype.drShiftTo=function(t,e){for(var s=t;s<this.t;++s)e[s-t]=this[s];e.t=Math.max(this.t-t,0),e.s=this.s},s.prototype.lShiftTo=function(t,e){var s,r=t%this.DB,i=this.DB-r,n=(1<<i)-1,o=Math.floor(t/this.DB),a=this.s<<r&this.DM;for(s=this.t-1;s>=0;--s)e[s+o+1]=this[s]>>i|a,a=(this[s]&n)<<r;for(s=o-1;s>=0;--s)e[s]=0;e[o]=a,e.t=this.t+o+1,e.s=this.s,e.clamp()},s.prototype.rShiftTo=function(t,e){e.s=this.s;var s=Math.floor(t/this.DB);if(s>=this.t)e.t=0;else{var r=t%this.DB,i=this.DB-r,n=(1<<r)-1;e[0]=this[s]>>r;for(var o=s+1;o<this.t;++o)e[o-s-1]|=(this[o]&n)<<i,e[o-s]=this[o]>>r;r>0&&(e[this.t-s-1]|=(this.s&n)<<i),e.t=this.t-s,e.clamp()}},s.prototype.subTo=function(t,e){for(var s=0,r=0,i=Math.min(t.t,this.t);s<i;)r+=this[s]-t[s],e[s++]=r&this.DM,r>>=this.DB;if(t.t<this.t){for(r-=t.s;s<this.t;)r+=this[s],e[s++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;s<t.t;)r-=t[s],e[s++]=r&this.DM,r>>=this.DB;r-=t.s}e.s=r<0?-1:0,r<-1?e[s++]=this.DV+r:r>0&&(e[s++]=r),e.t=s,e.clamp()},s.prototype.multiplyTo=function(t,e){var r=this.abs(),i=t.abs(),n=r.t;for(e.t=n+i.t;--n>=0;)e[n]=0;for(n=0;n<i.t;++n)e[n+r.t]=r.am(0,i[n],e,n,0,r.t);e.s=0,e.clamp(),this.s!=t.s&&s.ZERO.subTo(e,e)},s.prototype.squareTo=function(t){for(var e=this.abs(),s=t.t=2*e.t;--s>=0;)t[s]=0;for(s=0;s<e.t-1;++s){var r=e.am(s,e[s],t,2*s,0,1);(t[s+e.t]+=e.am(s+1,2*e[s],t,2*s+1,r,e.t-s-1))>=e.DV&&(t[s+e.t]-=e.DV,t[s+e.t+1]=1)}t.t>0&&(t[t.t-1]+=e.am(s,e[s],t,2*s,0,1)),t.s=0,t.clamp()},s.prototype.divRemTo=function(t,e,i){var n=t.abs();if(!(n.t<=0)){var o=this.abs();if(o.t<n.t)return null!=e&&e.fromInt(0),void(null!=i&&this.copyTo(i));null==i&&(i=r());var a=r(),h=this.s,l=t.s,c=this.DB-u(n[n.t-1]);c>0?(n.lShiftTo(c,a),o.lShiftTo(c,i)):(n.copyTo(a),o.copyTo(i));var d=a.t,p=a[d-1];if(0!=p){var f=p*(1<<this.F1)+(d>1?a[d-2]>>this.F2:0),m=this.FV/f,g=(1<<this.F1)/f,E=1<<this.F2,S=i.t,w=S-d,v=null==e?r():e;for(a.dlShiftTo(w,v),i.compareTo(v)>=0&&(i[i.t++]=1,i.subTo(v,i)),s.ONE.dlShiftTo(d,v),v.subTo(a,a);a.t<d;)a[a.t++]=0;for(;--w>=0;){var R=i[--S]==p?this.DM:Math.floor(i[S]*m+(i[S-1]+E)*g);if((i[S]+=a.am(0,R,i,w,0,d))<R)for(a.dlShiftTo(w,v),i.subTo(v,i);i[S]<--R;)i.subTo(v,i)}null!=e&&(i.drShiftTo(d,e),h!=l&&s.ZERO.subTo(e,e)),i.t=d,i.clamp(),c>0&&i.rShiftTo(c,i),h<0&&s.ZERO.subTo(i,i)}}},s.prototype.invDigit=function(){if(this.t<1)return 0;var t=this[0];if(!(1&t))return 0;var e=3&t;return(e=(e=(e=(e=e*(2-(15&t)*e)&15)*(2-(255&t)*e)&255)*(2-((65535&t)*e&65535))&65535)*(2-t*e%this.DV)%this.DV)>0?this.DV-e:-e},s.prototype.isEven=function(){return 0==(this.t>0?1&this[0]:this.s)},s.prototype.exp=function(t,e){if(t>4294967295||t<1)return s.ONE;var i=r(),n=r(),o=e.convert(this),a=u(t)-1;for(o.copyTo(i);--a>=0;)if(e.sqrTo(i,n),(t&1<<a)>0)e.mulTo(n,o,i);else{var h=i;i=n,n=h}return e.revert(i)},s.prototype.toString=function(t){if(this.s<0)return"-"+this.negate().toString(t);var e;if(16==t)e=4;else if(8==t)e=3;else if(2==t)e=1;else if(32==t)e=5;else{if(4!=t)return this.toRadix(t);e=2}var s,r=(1<<e)-1,i=!1,n="",o=this.t,a=this.DB-o*this.DB%e;if(o-- >0)for(a<this.DB&&(s=this[o]>>a)>0&&(i=!0,n=h(s));o>=0;)a<e?(s=(this[o]&(1<<a)-1)<<e-a,s|=this[--o]>>(a+=this.DB-e)):(s=this[o]>>(a-=e)&r,a<=0&&(a+=this.DB,--o)),s>0&&(i=!0),i&&(n+=h(s));return i?n:"0"},s.prototype.negate=function(){var t=r();return s.ZERO.subTo(this,t),t},s.prototype.abs=function(){return this.s<0?this.negate():this},s.prototype.compareTo=function(t){var e=this.s-t.s;if(0!=e)return e;var s=this.t;if(0!=(e=s-t.t))return this.s<0?-e:e;for(;--s>=0;)if(0!=(e=this[s]-t[s]))return e;return 0},s.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+u(this[this.t-1]^this.s&this.DM)},s.prototype.mod=function(t){var e=r();return this.abs().divRemTo(t,null,e),this.s<0&&e.compareTo(s.ZERO)>0&&t.subTo(e,e),e},s.prototype.modPowInt=function(t,e){var s;return s=t<256||e.isEven()?new d(e):new p(e),this.exp(t,s)},s.ZERO=c(0),s.ONE=c(1),v.prototype.convert=R,v.prototype.revert=R,v.prototype.mulTo=function(t,e,s){t.multiplyTo(e,s)},v.prototype.sqrTo=function(t,e){t.squareTo(e)},y.prototype.convert=function(t){if(t.s<0||t.t>2*this.m.t)return t.mod(this.m);if(t.compareTo(this.m)<0)return t;var e=r();return t.copyTo(e),this.reduce(e),e},y.prototype.revert=function(t){return t},y.prototype.reduce=function(t){for(t.drShiftTo(this.m.t-1,this.r2),t.t>this.m.t+1&&(t.t=this.m.t+1,t.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);t.compareTo(this.r2)<0;)t.dAddOffset(1,this.m.t+1);for(t.subTo(this.r2,t);t.compareTo(this.m)>=0;)t.subTo(this.m,t)},y.prototype.mulTo=function(t,e,s){t.multiplyTo(e,s),this.reduce(s)},y.prototype.sqrTo=function(t,e){t.squareTo(e),this.reduce(e)};var _,I,b,$=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],T=(1<<26)/$[$.length-1];function O(){var t;t=(new Date).getTime(),I[b++]^=255&t,I[b++]^=t>>8&255,I[b++]^=t>>16&255,I[b++]^=t>>24&255,b>=P&&(b-=P)}if(s.prototype.chunkSize=function(t){return Math.floor(Math.LN2*this.DB/Math.log(t))},s.prototype.toRadix=function(t){if(null==t&&(t=10),0==this.signum()||t<2||t>36)return"0";var e=this.chunkSize(t),s=Math.pow(t,e),i=c(s),n=r(),o=r(),a="";for(this.divRemTo(i,n,o);n.signum()>0;)a=(s+o.intValue()).toString(t).substr(1)+a,n.divRemTo(i,n,o);return o.intValue().toString(t)+a},s.prototype.fromRadix=function(t,e){this.fromInt(0),null==e&&(e=10);for(var r=this.chunkSize(e),i=Math.pow(e,r),n=!1,o=0,a=0,h=0;h<t.length;++h){var c=l(t,h);c<0?"-"==t.charAt(h)&&0==this.signum()&&(n=!0):(a=e*a+c,++o>=r&&(this.dMultiply(i),this.dAddOffset(a,0),o=0,a=0))}o>0&&(this.dMultiply(Math.pow(e,o)),this.dAddOffset(a,0)),n&&s.ZERO.subTo(this,this)},s.prototype.fromNumber=function(t,e,r){if("number"==typeof e)if(t<2)this.fromInt(1);else for(this.fromNumber(t,r),this.testBit(t-1)||this.bitwiseTo(s.ONE.shiftLeft(t-1),m,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(e);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(s.ONE.shiftLeft(t-1),this);else{var i=new Array,n=7&t;i.length=1+(t>>3),e.nextBytes(i),n>0?i[0]&=(1<<n)-1:i[0]=0,this.fromString(i,256)}},s.prototype.bitwiseTo=function(t,e,s){var r,i,n=Math.min(t.t,this.t);for(r=0;r<n;++r)s[r]=e(this[r],t[r]);if(t.t<this.t){for(i=t.s&this.DM,r=n;r<this.t;++r)s[r]=e(this[r],i);s.t=this.t}else{for(i=this.s&this.DM,r=n;r<t.t;++r)s[r]=e(i,t[r]);s.t=t.t}s.s=e(this.s,t.s),s.clamp()},s.prototype.changeBit=function(t,e){var r=s.ONE.shiftLeft(t);return this.bitwiseTo(r,e,r),r},s.prototype.addTo=function(t,e){for(var s=0,r=0,i=Math.min(t.t,this.t);s<i;)r+=this[s]+t[s],e[s++]=r&this.DM,r>>=this.DB;if(t.t<this.t){for(r+=t.s;s<this.t;)r+=this[s],e[s++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;s<t.t;)r+=t[s],e[s++]=r&this.DM,r>>=this.DB;r+=t.s}e.s=r<0?-1:0,r>0?e[s++]=r:r<-1&&(e[s++]=this.DV+r),e.t=s,e.clamp()},s.prototype.dMultiply=function(t){this[this.t]=this.am(0,t-1,this,0,0,this.t),++this.t,this.clamp()},s.prototype.dAddOffset=function(t,e){if(0!=t){for(;this.t<=e;)this[this.t++]=0;for(this[e]+=t;this[e]>=this.DV;)this[e]-=this.DV,++e>=this.t&&(this[this.t++]=0),++this[e]}},s.prototype.multiplyLowerTo=function(t,e,s){var r,i=Math.min(this.t+t.t,e);for(s.s=0,s.t=i;i>0;)s[--i]=0;for(r=s.t-this.t;i<r;++i)s[i+this.t]=this.am(0,t[i],s,i,0,this.t);for(r=Math.min(t.t,e);i<r;++i)this.am(0,t[i],s,i,0,e-i);s.clamp()},s.prototype.multiplyUpperTo=function(t,e,s){--e;var r=s.t=this.t+t.t-e;for(s.s=0;--r>=0;)s[r]=0;for(r=Math.max(e-this.t,0);r<t.t;++r)s[this.t+r-e]=this.am(e-r,t[r],s,0,0,this.t+r-e);s.clamp(),s.drShiftTo(1,s)},s.prototype.modInt=function(t){if(t<=0)return 0;var e=this.DV%t,s=this.s<0?t-1:0;if(this.t>0)if(0==e)s=this[0]%t;else for(var r=this.t-1;r>=0;--r)s=(e*s+this[r])%t;return s},s.prototype.millerRabin=function(t){var e=this.subtract(s.ONE),i=e.getLowestSetBit();if(i<=0)return!1;var n=e.shiftRight(i);(t=t+1>>1)>$.length&&(t=$.length);for(var o=r(),a=0;a<t;++a){o.fromInt($[Math.floor(Math.random()*$.length)]);var h=o.modPow(n,this);if(0!=h.compareTo(s.ONE)&&0!=h.compareTo(e)){for(var l=1;l++<i&&0!=h.compareTo(e);)if(0==(h=h.modPowInt(2,this)).compareTo(s.ONE))return!1;if(0!=h.compareTo(e))return!1}}return!0},s.prototype.clone=function(){var t=r();return this.copyTo(t),t},s.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},s.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24},s.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16},s.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},s.prototype.toByteArray=function(){var t=this.t,e=new Array;e[0]=this.s;var s,r=this.DB-t*this.DB%8,i=0;if(t-- >0)for(r<this.DB&&(s=this[t]>>r)!=(this.s&this.DM)>>r&&(e[i++]=s|this.s<<this.DB-r);t>=0;)r<8?(s=(this[t]&(1<<r)-1)<<8-r,s|=this[--t]>>(r+=this.DB-8)):(s=this[t]>>(r-=8)&255,r<=0&&(r+=this.DB,--t)),128&s&&(s|=-256),0==i&&(128&this.s)!=(128&s)&&++i,(i>0||s!=this.s)&&(e[i++]=s);return e},s.prototype.equals=function(t){return 0==this.compareTo(t)},s.prototype.min=function(t){return this.compareTo(t)<0?this:t},s.prototype.max=function(t){return this.compareTo(t)>0?this:t},s.prototype.and=function(t){var e=r();return this.bitwiseTo(t,f,e),e},s.prototype.or=function(t){var e=r();return this.bitwiseTo(t,m,e),e},s.prototype.xor=function(t){var e=r();return this.bitwiseTo(t,g,e),e},s.prototype.andNot=function(t){var e=r();return this.bitwiseTo(t,E,e),e},s.prototype.not=function(){for(var t=r(),e=0;e<this.t;++e)t[e]=this.DM&~this[e];return t.t=this.t,t.s=~this.s,t},s.prototype.shiftLeft=function(t){var e=r();return t<0?this.rShiftTo(-t,e):this.lShiftTo(t,e),e},s.prototype.shiftRight=function(t){var e=r();return t<0?this.lShiftTo(-t,e):this.rShiftTo(t,e),e},s.prototype.getLowestSetBit=function(){for(var t=0;t<this.t;++t)if(0!=this[t])return t*this.DB+S(this[t]);return this.s<0?this.t*this.DB:-1},s.prototype.bitCount=function(){for(var t=0,e=this.s&this.DM,s=0;s<this.t;++s)t+=w(this[s]^e);return t},s.prototype.testBit=function(t){var e=Math.floor(t/this.DB);return e>=this.t?0!=this.s:!!(this[e]&1<<t%this.DB)},s.prototype.setBit=function(t){return this.changeBit(t,m)},s.prototype.clearBit=function(t){return this.changeBit(t,E)},s.prototype.flipBit=function(t){return this.changeBit(t,g)},s.prototype.add=function(t){var e=r();return this.addTo(t,e),e},s.prototype.subtract=function(t){var e=r();return this.subTo(t,e),e},s.prototype.multiply=function(t){var e=r();return this.multiplyTo(t,e),e},s.prototype.divide=function(t){var e=r();return this.divRemTo(t,e,null),e},s.prototype.remainder=function(t){var e=r();return this.divRemTo(t,null,e),e},s.prototype.divideAndRemainder=function(t){var e=r(),s=r();return this.divRemTo(t,e,s),new Array(e,s)},s.prototype.modPow=function(t,e){var s,i,n=t.bitLength(),o=c(1);if(n<=0)return o;s=n<18?1:n<48?3:n<144?4:n<768?5:6,i=n<8?new d(e):e.isEven()?new y(e):new p(e);var a=new Array,h=3,l=s-1,f=(1<<s)-1;if(a[1]=i.convert(this),s>1){var m=r();for(i.sqrTo(a[1],m);h<=f;)a[h]=r(),i.mulTo(m,a[h-2],a[h]),h+=2}var g,E,S=t.t-1,w=!0,v=r();for(n=u(t[S])-1;S>=0;){for(n>=l?g=t[S]>>n-l&f:(g=(t[S]&(1<<n+1)-1)<<l-n,S>0&&(g|=t[S-1]>>this.DB+n-l)),h=s;!(1&g);)g>>=1,--h;if((n-=h)<0&&(n+=this.DB,--S),w)a[g].copyTo(o),w=!1;else{for(;h>1;)i.sqrTo(o,v),i.sqrTo(v,o),h-=2;h>0?i.sqrTo(o,v):(E=o,o=v,v=E),i.mulTo(v,a[g],o)}for(;S>=0&&!(t[S]&1<<n);)i.sqrTo(o,v),E=o,o=v,v=E,--n<0&&(n=this.DB-1,--S)}return i.revert(o)},s.prototype.modInverse=function(t){var e=t.isEven();if(this.isEven()&&e||0==t.signum())return s.ZERO;for(var r=t.clone(),i=this.clone(),n=c(1),o=c(0),a=c(0),h=c(1);0!=r.signum();){for(;r.isEven();)r.rShiftTo(1,r),e?(n.isEven()&&o.isEven()||(n.addTo(this,n),o.subTo(t,o)),n.rShiftTo(1,n)):o.isEven()||o.subTo(t,o),o.rShiftTo(1,o);for(;i.isEven();)i.rShiftTo(1,i),e?(a.isEven()&&h.isEven()||(a.addTo(this,a),h.subTo(t,h)),a.rShiftTo(1,a)):h.isEven()||h.subTo(t,h),h.rShiftTo(1,h);r.compareTo(i)>=0?(r.subTo(i,r),e&&n.subTo(a,n),o.subTo(h,o)):(i.subTo(r,i),e&&a.subTo(n,a),h.subTo(o,h))}return 0!=i.compareTo(s.ONE)?s.ZERO:h.compareTo(t)>=0?h.subtract(t):h.signum()<0?(h.addTo(t,h),h.signum()<0?h.add(t):h):h},s.prototype.pow=function(t){return this.exp(t,new v)},s.prototype.gcd=function(t){var e=this.s<0?this.negate():this.clone(),s=t.s<0?t.negate():t.clone();if(e.compareTo(s)<0){var r=e;e=s,s=r}var i=e.getLowestSetBit(),n=s.getLowestSetBit();if(n<0)return e;for(i<n&&(n=i),n>0&&(e.rShiftTo(n,e),s.rShiftTo(n,s));e.signum()>0;)(i=e.getLowestSetBit())>0&&e.rShiftTo(i,e),(i=s.getLowestSetBit())>0&&s.rShiftTo(i,s),e.compareTo(s)>=0?(e.subTo(s,e),e.rShiftTo(1,e)):(s.subTo(e,s),s.rShiftTo(1,s));return n>0&&s.lShiftTo(n,s),s},s.prototype.isProbablePrime=function(t){var e,s=this.abs();if(1==s.t&&s[0]<=$[$.length-1]){for(e=0;e<$.length;++e)if(s[0]==$[e])return!0;return!1}if(s.isEven())return!1;for(e=1;e<$.length;){for(var r=$[e],i=e+1;i<$.length&&r<T;)r*=$[i++];for(r=s.modInt(r);e<i;)if(r%$[e++]==0)return!1}return s.millerRabin(t)},s.prototype.square=function(){var t=r();return this.squareTo(t),t},s.prototype.Barrett=y,null==I){var k;if(I=new Array,b=0,"undefined"!=typeof window&&window.crypto)if(window.crypto.getRandomValues){var C=new Uint8Array(32);for(window.crypto.getRandomValues(C),k=0;k<32;++k)I[b++]=C[k]}else if("Netscape"==navigator.appName&&navigator.appVersion<"5"){var A=window.crypto.random(32);for(k=0;k<A.length;++k)I[b++]=255&A.charCodeAt(k)}for(;b<P;)k=Math.floor(65536*Math.random()),I[b++]=k>>>8,I[b++]=255&k;b=0,O()}function L(){if(null==_){for(O(),(_=new N).init(I),b=0;b<I.length;++b)I[b]=0;b=0}return _.next()}function x(){}function N(){this.i=0,this.j=0,this.S=new Array}x.prototype.nextBytes=function(t){var e;for(e=0;e<t.length;++e)t[e]=L()},N.prototype.init=function(t){var e,s,r;for(e=0;e<256;++e)this.S[e]=e;for(s=0,e=0;e<256;++e)s=s+this.S[e]+t[e%t.length]&255,r=this.S[e],this.S[e]=this.S[s],this.S[s]=r;this.i=0,this.j=0},N.prototype.next=function(){var t;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,t=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=t,this.S[t+this.S[this.i]&255]};var P=256;t.exports={default:s,BigInteger:s,SecureRandom:x}}).call(this)},9576:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RE_SUBNET_STRING=e.RE_ADDRESS=e.GROUPS=e.BITS=void 0,e.BITS=32,e.GROUPS=4,e.RE_ADDRESS=/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/g,e.RE_SUBNET_STRING=/\/\d{1,2}$/},9589:(t,e,s)=>{"use strict";const r=s(9718),i=s(6874),n=s(3908),o=s(1123),a=s(144),h=s(6953),l=s(7414),c=s(3007),u=s(1832),d=s(2938),p=s(6254),f=s(4493),m=s(1729),g=s(560),E=s(9970),S=s(1763),w=s(909),v=s(3927),R=s(4277),y=s(5580),_=s(7059),I=s(4641),b=s(3999),$=s(4089),T=s(5200),O=s(2111),k=s(6170),C=s(3904),A=s(8311),L=s(7638),x=s(12),N=s(9628),P=s(270),D=s(1261),B=s(3874),M=s(7075),F=s(5571),U=s(5342),V=s(6780),H=s(2525),j=s(5032);t.exports={parse:a,valid:h,clean:l,inc:c,diff:u,major:d,minor:p,patch:f,prerelease:m,compare:g,rcompare:E,compareLoose:S,compareBuild:w,sort:v,rsort:R,gt:y,lt:_,eq:I,neq:b,gte:$,lte:T,cmp:O,coerce:k,Comparator:C,Range:A,satisfies:L,toComparators:x,maxSatisfying:N,minSatisfying:P,minVersion:D,validRange:B,outside:M,gtr:F,ltr:U,intersects:V,simplifyRange:H,subset:j,SemVer:n,re:r.re,src:r.src,tokens:r.t,SEMVER_SPEC_VERSION:i.SEMVER_SPEC_VERSION,RELEASE_TYPES:i.RELEASE_TYPES,compareIdentifiers:o.compareIdentifiers,rcompareIdentifiers:o.rcompareIdentifiers}},9628:(t,e,s)=>{"use strict";const r=s(3908),i=s(8311);t.exports=(t,e,s)=>{let n=null,o=null,a=null;try{a=new i(e,s)}catch(t){return null}return t.forEach((t=>{a.test(t)&&(n&&-1!==o.compare(t)||(n=t,o=new r(n,s)))})),n}},9718:(t,e,s)=>{"use strict";const{MAX_SAFE_COMPONENT_LENGTH:r,MAX_SAFE_BUILD_LENGTH:i,MAX_LENGTH:n}=s(6874),o=s(7272),a=(e=t.exports={}).re=[],h=e.safeRe=[],l=e.src=[],c=e.safeSrc=[],u=e.t={};let d=0;const p="[a-zA-Z0-9-]",f=[["\\s",1],["\\d",n],[p,i]],m=(t,e,s)=>{const r=(t=>{for(const[e,s]of f)t=t.split(`${e}*`).join(`${e}{0,${s}}`).split(`${e}+`).join(`${e}{1,${s}}`);return t})(e),i=d++;o(t,i,e),u[t]=i,l[i]=e,c[i]=r,a[i]=new RegExp(e,s?"g":void 0),h[i]=new RegExp(r,s?"g":void 0)};m("NUMERICIDENTIFIER","0|[1-9]\\d*"),m("NUMERICIDENTIFIERLOOSE","\\d+"),m("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${p}*`),m("MAINVERSION",`(${l[u.NUMERICIDENTIFIER]})\\.(${l[u.NUMERICIDENTIFIER]})\\.(${l[u.NUMERICIDENTIFIER]})`),m("MAINVERSIONLOOSE",`(${l[u.NUMERICIDENTIFIERLOOSE]})\\.(${l[u.NUMERICIDENTIFIERLOOSE]})\\.(${l[u.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASEIDENTIFIER",`(?:${l[u.NONNUMERICIDENTIFIER]}|${l[u.NUMERICIDENTIFIER]})`),m("PRERELEASEIDENTIFIERLOOSE",`(?:${l[u.NONNUMERICIDENTIFIER]}|${l[u.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASE",`(?:-(${l[u.PRERELEASEIDENTIFIER]}(?:\\.${l[u.PRERELEASEIDENTIFIER]})*))`),m("PRERELEASELOOSE",`(?:-?(${l[u.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${l[u.PRERELEASEIDENTIFIERLOOSE]})*))`),m("BUILDIDENTIFIER",`${p}+`),m("BUILD",`(?:\\+(${l[u.BUILDIDENTIFIER]}(?:\\.${l[u.BUILDIDENTIFIER]})*))`),m("FULLPLAIN",`v?${l[u.MAINVERSION]}${l[u.PRERELEASE]}?${l[u.BUILD]}?`),m("FULL",`^${l[u.FULLPLAIN]}$`),m("LOOSEPLAIN",`[v=\\s]*${l[u.MAINVERSIONLOOSE]}${l[u.PRERELEASELOOSE]}?${l[u.BUILD]}?`),m("LOOSE",`^${l[u.LOOSEPLAIN]}$`),m("GTLT","((?:<|>)?=?)"),m("XRANGEIDENTIFIERLOOSE",`${l[u.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),m("XRANGEIDENTIFIER",`${l[u.NUMERICIDENTIFIER]}|x|X|\\*`),m("XRANGEPLAIN",`[v=\\s]*(${l[u.XRANGEIDENTIFIER]})(?:\\.(${l[u.XRANGEIDENTIFIER]})(?:\\.(${l[u.XRANGEIDENTIFIER]})(?:${l[u.PRERELEASE]})?${l[u.BUILD]}?)?)?`),m("XRANGEPLAINLOOSE",`[v=\\s]*(${l[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[u.XRANGEIDENTIFIERLOOSE]})(?:${l[u.PRERELEASELOOSE]})?${l[u.BUILD]}?)?)?`),m("XRANGE",`^${l[u.GTLT]}\\s*${l[u.XRANGEPLAIN]}$`),m("XRANGELOOSE",`^${l[u.GTLT]}\\s*${l[u.XRANGEPLAINLOOSE]}$`),m("COERCEPLAIN",`(^|[^\\d])(\\d{1,${r}})(?:\\.(\\d{1,${r}}))?(?:\\.(\\d{1,${r}}))?`),m("COERCE",`${l[u.COERCEPLAIN]}(?:$|[^\\d])`),m("COERCEFULL",l[u.COERCEPLAIN]+`(?:${l[u.PRERELEASE]})?`+`(?:${l[u.BUILD]})?(?:$|[^\\d])`),m("COERCERTL",l[u.COERCE],!0),m("COERCERTLFULL",l[u.COERCEFULL],!0),m("LONETILDE","(?:~>?)"),m("TILDETRIM",`(\\s*)${l[u.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",m("TILDE",`^${l[u.LONETILDE]}${l[u.XRANGEPLAIN]}$`),m("TILDELOOSE",`^${l[u.LONETILDE]}${l[u.XRANGEPLAINLOOSE]}$`),m("LONECARET","(?:\\^)"),m("CARETTRIM",`(\\s*)${l[u.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",m("CARET",`^${l[u.LONECARET]}${l[u.XRANGEPLAIN]}$`),m("CARETLOOSE",`^${l[u.LONECARET]}${l[u.XRANGEPLAINLOOSE]}$`),m("COMPARATORLOOSE",`^${l[u.GTLT]}\\s*(${l[u.LOOSEPLAIN]})$|^$`),m("COMPARATOR",`^${l[u.GTLT]}\\s*(${l[u.FULLPLAIN]})$|^$`),m("COMPARATORTRIM",`(\\s*)${l[u.GTLT]}\\s*(${l[u.LOOSEPLAIN]}|${l[u.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",m("HYPHENRANGE",`^\\s*(${l[u.XRANGEPLAIN]})\\s+-\\s+(${l[u.XRANGEPLAIN]})\\s*$`),m("HYPHENRANGELOOSE",`^\\s*(${l[u.XRANGEPLAINLOOSE]})\\s+-\\s+(${l[u.XRANGEPLAINLOOSE]})\\s*$`),m("STAR","(<|>)?=?\\s*\\*"),m("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),m("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},9912:function(t,e,s){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.stringify=e.parse=e.LineType=void 0;const i=r(s(8601)),n=s(5317),o=r(s(857)),a=/\s/,h=/\r|\n/,l=/^(Host|Match)$/i,c=/^(GlobalKnownHostsFile|Host|IPQoS|SendEnv|UserKnownHostsFile|ProxyCommand|Match|CanonicalDomains)$/i,u=/^(?:CertificateFile|IdentityFile|IdentityAgent|User)$/i,d=/^(Include|IdentityFile)$/i;var p;!function(t){t[t.DIRECTIVE=1]="DIRECTIVE",t[t.COMMENT=2]="COMMENT"}(p||(e.LineType=p={}));const f=["IdentityFile","LocalForward","RemoteForward","DynamicForward","CertificateFile"];function m(t,e){return e.hasOwnProperty(t.param)&&e[t.param]===t.value}function g(t){for(const e of t)if(e.type===p.DIRECTIVE&&"config"in e)for(const t of e.config)if(t.before)return t.before;return"  "}function E(t,e){const s=(t,s)=>{switch(t.toLowerCase()){case"all":return!0;case"final":return!!e.inFinalPass||(e.doFinalPass=!0,!1);case"exec":const t=`function main {\n          ${s}\n        }\n        main`;return 0===(0,n.spawnSync)(t,{shell:!0}).status;case"host":return(0,i.default)(s,e.params.HostName);case"originalhost":return(0,i.default)(s,e.params.OriginalHost);case"user":return(0,i.default)(s,e.params.User);case"localuser":return(0,i.default)(s,e.params.LocalUser)}};for(const e in t)if(!s(e,t[e]))return!1;return!0}class S extends Array{static parse(t){return w(t)}static stringify(t){return v(t)}compute(t){let e;"string"==typeof t&&(t={Host:t});try{e=o.default.userInfo()}catch(t){e={username:process.env.USER||process.env.USERNAME||""}}const s={params:{Host:t.Host,HostName:t.Host,OriginalHost:t.Host,User:e.username,LocalUser:e.username},inFinalPass:!1,doFinalPass:!1},r={},a=(t,e)=>{f.includes(t)?(r[t]||(r[t]=[])).push(e):null==r[t]&&("HostName"===t?s.params.HostName=e:"User"===t&&(s.params.User=e),r[t]=e)};void 0!==t.User&&a("User",t.User);const h=()=>{for(const t of this)if(t.type===p.DIRECTIVE)if("Host"===t.param&&(0,i.default)(t.value,s.params.Host)){let e=!1,r=[];a(t.param,t.value);for(const s of t.config)s.type===p.DIRECTIVE&&(a(s.param,s.value),/^CanonicalizeHostName$/i.test(s.param)&&"yes"===s.value&&(e=!0),/^CanonicalDomains$/i.test(s.param)&&Array.isArray(s.value)&&(r=s.value));if(r.length>0&&e&&s.params.Host===s.params.OriginalHost)for(const t of r){const e=`${s.params.OriginalHost}.${t}`,{status:r,stderr:i}=(0,n.spawnSync)("nslookup",[e]);if(0===r&&!/can't find/.test(i.toString())){s.params.Host=e,a("Host",e),h();break}}}else if("Match"===t.param&&"criteria"in t&&E(t.criteria,s))for(const e of t.config)e.type===p.DIRECTIVE&&a(e.param,e.value);else"Host"!==t.param&&"Match"!==t.param&&a(t.param,t.value)};return h(),s.doFinalPass&&(s.inFinalPass=!0,s.params.Host=s.params.HostName,h()),r}find(t){if("function"==typeof t)return super.find(t);if(!t||!("Host"in t)&&!("Match"in t))throw new Error("Can only find by Host or Match");return super.find((e=>m(e,t)))}remove(t){let e;if("function"==typeof t)e=super.findIndex(t);else{if(!t||!("Host"in t)&&!("Match"in t))throw new Error("Can only remove by Host or Match");e=super.findIndex((e=>m(e,t)))}if(e>=0)return this.splice(e,1)}toString(){return v(this)}append(t){const e=g(this),s=this.length>0?this[this.length-1]:null;let r=s&&s.config||this,i=this,n=r.length>0?r[r.length-1]:s;n&&!n.after&&(n.after="\n");let o=r!==i;for(const s in t){const a=t[s],h={type:p.DIRECTIVE,param:s,separator:" ",value:a,before:o?e:e.replace(/  |\t/,""),after:"\n"};l.test(s)?(o=!0,h.before=e.replace(/  |\t/,""),r=i,n&&"\n"===n.after&&(n.after+="\n"),r.push(h),r=h.config=new S):r.push(h),n=h}return i}prepend(t,e=!1){const s=g(this);let r=this,i=0;if(e){for(;i<this.length&&!("config"in this[i]);)i+=1;if(i>=this.length)return this.append(t)}let n=!1,o=0;for(const e in t){o+=1;const a=t[e],h={type:p.DIRECTIVE,param:e,separator:" ",value:a,before:"",after:"\n"};l.test(e)?(h.before=s.replace(/  |\t/,""),r.splice(i,0,h),r=h.config=new S,n=!0):(o===Object.keys(t).length&&(h.after+="\n"),n?(h.before=s,r.push(h)):(r.splice(i,0,h),i+=1,d.test(e)&&(h.after+="\n")))}return r}}function w(t){let e=0,s=n(),r=new S,i=r;function n(){return t[e++]}function o(){let t="";for(;a.test(s);)t+=s,s=n();return t}function u(){let t=o();return"="===s&&(t+=s,s=n()),t+o()}function d(){let t="",e=!1,r=!1;for(;s&&!h.test(s);){if(r)t+='"'===s?s:`\\${s}`,r=!1;else if('"'!==s||t&&!e)if("\\"===s)r=!0;else{if("#"===s&&!e)break;t+=s}else e=!e;s=n()}if(e||r)throw new Error(`Unexpected line break at ${t}`);return t.trim()}function f(){const t=[];let e="",r=!1,i=!1;for(;s&&!h.test(s);){if(i)e+='"'===s?s:`\\${s}`,i=!1;else if('"'===s)r=!r;else if("\\"===s)i=!0;else if(r)e+=s;else if(/[ \t=]/.test(s))e&&(t.push(e),e="");else{if("#"===s&&t.length>0)break;e+=s}s=n()}if(r||i)throw new Error(`Unexpected line break at ${t.concat(e).join(" ")}`);return e&&t.push(e),t.length>1?t:t[0]}function m(){const t=o(),e="#"===s?function(){const t=p.COMMENT;let e="";for(;s&&!h.test(s);)e+=s,s=n();return{type:t,content:e,before:"",after:""}}():function(){const t=p.DIRECTIVE,e=function(){let t="";for(;s&&/[^ \t=]/.test(s);)t+=s,s=n();return t}(),r=c.test(e),i={type:t,param:e,separator:u(),quoted:!r&&'"'===s,value:r?f():d(),before:"",after:""};if(i.quoted||delete i.quoted,/^Match$/i.test(e)){const t={};"string"==typeof i.value&&(i.value=[i.value]);let e=0;for(;e<i.value.length;){const s=i.value[e];switch(s.toLowerCase()){case"all":case"canonical":case"final":t[s]=[],e+=1;break;default:if(e+1>=i.value.length)throw new Error(`Missing value for match criteria ${s}`);t[s]=i.value[e+1],e+=2}}i.criteria=t}return i}(),r=function(){let t="";for(;h.test(s);)t+=s,s=n();return t}();return e.before=t,e.after=r,e}for(;s;){let t=m();t.type===p.DIRECTIVE&&l.test(t.param)?(r=i,r.push(t),r=t.config=new S):t.type!==p.DIRECTIVE||t.param?r.push(t):0===r.length?i[i.length-1].after+=t.before:r[r.length-1].after+=t.before}return i}function v(t){let e="";function s(t,e){return Array.isArray(t)?t.map((t=>s(t,a.test(t)))).join(" "):e?`"${t}"`:t}function r(t){const e=t.quoted||u.test(t.param)&&a.test(t.value),r=s(t.value,e);return`${t.param}${t.separator}${r}`}const i=t=>{e+=t.before,t.type===p.COMMENT?e+=t.content:t.type===p.DIRECTIVE&&f.includes(t.param)?[].concat(t.value).forEach((function(s,i,n){e+=r({...t,value:s}),i<n.length-1&&(e+=`\n${t.before}`)})):t.type===p.DIRECTIVE&&(e+=r(t)),e+=t.after,t.config&&t.config.forEach(i)};return t.forEach(i),e}S.DIRECTIVE=p.DIRECTIVE,S.COMMENT=p.COMMENT,e.default=S,e.parse=w,e.stringify=v},9970:(t,e,s)=>{"use strict";const r=s(560);t.exports=(t,e,s)=>r(e,t,s)}},r={};function i(t){var e=r[t];if(void 0!==e)return e.exports;var n=r[t]={exports:{}};return s[t].call(n.exports,n,n.exports,i),n.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},e=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,i.t=function(s,r){if(1&r&&(s=this(s)),8&r)return s;if("object"==typeof s&&s){if(4&r&&s.__esModule)return s;if(16&r&&"function"==typeof s.then)return s}var n=Object.create(null);i.r(n);var o={};t=t||[null,e({}),e([]),e(e)];for(var a=2&r&&s;"object"==typeof a&&!~t.indexOf(a);a=e(a))Object.getOwnPropertyNames(a).forEach((t=>o[t]=()=>s[t]));return o.default=()=>s,i.d(n,o),n},i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};(()=>{"use strict";i.r(n),i.d(n,{activate:()=>li,deactivate:()=>ci});const t=require("vscode");var e=i(5317),s=i(9278),r=i(5861);class o{constructor(t,e,s){this.hostname=t,this.user=e,this.port=s}static parse(t){let e;const s=t.lastIndexOf("@");let r;-1!==s&&(e=t.substring(0,s));const i=t.lastIndexOf(":");-1!==i&&(r=parseInt(t.substring(i+1),10));const n=-1!==s?s+1:0,a=-1!==i?i:t.length,h=t.substring(n,a);return new o(h,e,r)}toConnectionString(){let t=this.hostname;return this.user&&(t=`${this.user}@${t}`),this.port&&(t=`-p ${this.port} ${t}`),t}toString(){let t=this.hostname;return this.user&&(t=`${this.user}@`+t),this.port&&(t+=`:${this.port}`),t}static parseAuthorityNew(t){const e=JSON.parse(Buffer.from(t,"hex").toString());return new o(e.hostName,e.user,e.port)}static parseEncoded(t){try{return o.parseAuthorityNew(t)}catch{}return o.parse(t.replace(/\\x([0-9a-f]{2})/g,((t,e)=>String.fromCharCode(parseInt(e,16)))))}toEncodedString(){return Buffer.from(JSON.stringify({hostName:this.hostname,user:this.user,port:this.port})).toString("hex")}}var a=i(857);const h=require("fs"),l=require("path");var c=i.n(l),u=i(1182),d=i.n(u);const p=a.homedir();async function f(t){try{return await h.promises.access(t),!0}catch{return!1}}function m(t){return t.replace(/^~(?=$|\/|\\)/,p)}function g(t){return t.replace(/\\/g,"/")}const E="win32"===process.platform,S="darwin"===process.platform,w="linux"===process.platform;var v=i(8422);const R=t=>{if("string"!=typeof t)throw new TypeError("invalid pattern");if(t.length>65536)throw new TypeError("pattern is too long")},y={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},_=t=>t.replace(/[[\]\\-]/g,"\\$&"),I=t=>t.join(""),b=(t,e)=>{const s=e;if("["!==t.charAt(s))throw new Error("not in a brace expression");const r=[],i=[];let n=s+1,o=!1,a=!1,h=!1,l=!1,c=s,u="";t:for(;n<t.length;){const e=t.charAt(n);if("!"!==e&&"^"!==e||n!==s+1){if("]"===e&&o&&!h){c=n+1;break}if(o=!0,"\\"!==e||h){if("["===e&&!h)for(const[e,[o,h,l]]of Object.entries(y))if(t.startsWith(e,n)){if(u)return["$.",!1,t.length-s,!0];n+=e.length,l?i.push(o):r.push(o),a=a||h;continue t}h=!1,u?(e>u?r.push(_(u)+"-"+_(e)):e===u&&r.push(_(e)),u="",n++):t.startsWith("-]",n+1)?(r.push(_(e+"-")),n+=2):t.startsWith("-",n+1)?(u=e,n+=2):(r.push(_(e)),n++)}else h=!0,n++}else l=!0,n++}if(c<n)return["",!1,0,!1];if(!r.length&&!i.length)return["$.",!1,t.length-s,!0];if(0===i.length&&1===r.length&&/^\\?.$/.test(r[0])&&!l){return[(d=2===r[0].length?r[0].slice(-1):r[0],d.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")),!1,c-s,!1]}var d;const p="["+(l?"^":"")+I(r)+"]",f="["+(l?"":"^")+I(i)+"]";return[r.length&&i.length?"("+p+"|"+f+")":r.length?p:f,a,c-s,!0]},$=(t,{windowsPathsNoEscape:e=!1}={})=>e?t.replace(/\[([^\/\\])\]/g,"$1"):t.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1"),T=new Set(["!","?","+","*","@"]),O=t=>T.has(t),k="(?!\\.)",C=new Set(["[","."]),A=new Set(["..","."]),L=new Set("().*{}+?[]^$\\!"),x="[^/]",N=x+"*?",P=x+"+?";class D{type;#t;#e;#s=!1;#r=[];#i;#n;#o;#a=!1;#h;#l;#c=!1;constructor(t,e,s={}){this.type=t,t&&(this.#e=!0),this.#i=e,this.#t=this.#i?this.#i.#t:this,this.#h=this.#t===this?s:this.#t.#h,this.#o=this.#t===this?[]:this.#t.#o,"!"!==t||this.#t.#a||this.#o.push(this),this.#n=this.#i?this.#i.#r.length:0}get hasMagic(){if(void 0!==this.#e)return this.#e;for(const t of this.#r)if("string"!=typeof t&&(t.type||t.hasMagic))return this.#e=!0;return this.#e}toString(){return void 0!==this.#l?this.#l:this.type?this.#l=this.type+"("+this.#r.map((t=>String(t))).join("|")+")":this.#l=this.#r.map((t=>String(t))).join("")}#u(){if(this!==this.#t)throw new Error("should only call on root");if(this.#a)return this;let t;for(this.toString(),this.#a=!0;t=this.#o.pop();){if("!"!==t.type)continue;let e=t,s=e.#i;for(;s;){for(let r=e.#n+1;!s.type&&r<s.#r.length;r++)for(const e of t.#r){if("string"==typeof e)throw new Error("string part in extglob AST??");e.copyIn(s.#r[r])}e=s,s=e.#i}}return this}push(...t){for(const e of t)if(""!==e){if("string"!=typeof e&&!(e instanceof D&&e.#i===this))throw new Error("invalid part: "+e);this.#r.push(e)}}toJSON(){const t=null===this.type?this.#r.slice().map((t=>"string"==typeof t?t:t.toJSON())):[this.type,...this.#r.map((t=>t.toJSON()))];return this.isStart()&&!this.type&&t.unshift([]),this.isEnd()&&(this===this.#t||this.#t.#a&&"!"===this.#i?.type)&&t.push({}),t}isStart(){if(this.#t===this)return!0;if(!this.#i?.isStart())return!1;if(0===this.#n)return!0;const t=this.#i;for(let e=0;e<this.#n;e++){const s=t.#r[e];if(!(s instanceof D&&"!"===s.type))return!1}return!0}isEnd(){if(this.#t===this)return!0;if("!"===this.#i?.type)return!0;if(!this.#i?.isEnd())return!1;if(!this.type)return this.#i?.isEnd();const t=this.#i?this.#i.#r.length:0;return this.#n===t-1}copyIn(t){"string"==typeof t?this.push(t):this.push(t.clone(this))}clone(t){const e=new D(this.type,t);for(const t of this.#r)e.copyIn(t);return e}static#d(t,e,s,r){let i=!1,n=!1,o=-1,a=!1;if(null===e.type){let h=s,l="";for(;h<t.length;){const s=t.charAt(h++);if(i||"\\"===s)i=!i,l+=s;else if(n)h===o+1?"^"!==s&&"!"!==s||(a=!0):"]"!==s||h===o+2&&a||(n=!1),l+=s;else if("["!==s)if(r.noext||!O(s)||"("!==t.charAt(h))l+=s;else{e.push(l),l="";const i=new D(s,e);h=D.#d(t,i,h,r),e.push(i)}else n=!0,o=h,a=!1,l+=s}return e.push(l),h}let h=s+1,l=new D(null,e);const c=[];let u="";for(;h<t.length;){const s=t.charAt(h++);if(i||"\\"===s)i=!i,u+=s;else if(n)h===o+1?"^"!==s&&"!"!==s||(a=!0):"]"!==s||h===o+2&&a||(n=!1),u+=s;else if("["!==s)if(O(s)&&"("===t.charAt(h)){l.push(u),u="";const e=new D(s,l);l.push(e),h=D.#d(t,e,h,r)}else if("|"!==s){if(")"===s)return""===u&&0===e.#r.length&&(e.#c=!0),l.push(u),u="",e.push(...c,l),h;u+=s}else l.push(u),u="",c.push(l),l=new D(null,e);else n=!0,o=h,a=!1,u+=s}return e.type=null,e.#e=void 0,e.#r=[t.substring(s-1)],h}static fromGlob(t,e={}){const s=new D(null,void 0,e);return D.#d(t,s,0,e),s}toMMPattern(){if(this!==this.#t)return this.#t.toMMPattern();const t=this.toString(),[e,s,r,i]=this.toRegExpSource();if(!(r||this.#e||this.#h.nocase&&!this.#h.nocaseMagicOnly&&t.toUpperCase()!==t.toLowerCase()))return s;const n=(this.#h.nocase?"i":"")+(i?"u":"");return Object.assign(new RegExp(`^${e}$`,n),{_src:e,_glob:t})}toRegExpSource(){if(this.#t===this&&this.#u(),!this.type){const t=this.isStart()&&this.isEnd(),e=this.#r.map((e=>{const[s,r,i,n]="string"==typeof e?D.#p(e,this.#e,t):e.toRegExpSource();return this.#e=this.#e||i,this.#s=this.#s||n,s})).join("");let s="";if(this.isStart()&&"string"==typeof this.#r[0]&&(1!==this.#r.length||!A.has(this.#r[0]))){const t=C,r=this.#h.dot&&t.has(e.charAt(0))||e.startsWith("\\.")&&t.has(e.charAt(2))||e.startsWith("\\.\\.")&&t.has(e.charAt(4)),i=!this.#h.dot&&t.has(e.charAt(0));s=r?"(?!\\.\\.?(?:$|/))":i?k:""}let r="";return this.isEnd()&&this.#t.#a&&"!"===this.#i?.type&&(r="(?:$|\\/)"),[s+e+r,$(e),this.#e=!!this.#e,this.#s]}const t="!"===this.type?"(?:(?!(?:":"(?:",e=this.#r.map((t=>{if("string"==typeof t)throw new Error("string type in extglob ast??");const[e,s,r,i]=t.toRegExpSource();return this.#s=this.#s||i,e})).filter((t=>!(this.isStart()&&this.isEnd()&&!t))).join("|");if(this.isStart()&&this.isEnd()&&!e&&"!"!==this.type){const t=this.toString();return this.#r=[t],this.type=null,this.#e=void 0,[t,$(this.toString()),!1,!1]}let s="";return s="!"===this.type&&this.#c?(this.isStart()&&!this.#h.dot?k:"")+P:t+e+("!"===this.type?"))"+(this.isStart()&&!this.#h.dot?k:"")+N+")":"@"===this.type?")":`)${this.type}`),[s,$(e),this.#e=!!this.#e,this.#s]}static#p(t,e,s=!1){let r=!1,i="",n=!1;for(let o=0;o<t.length;o++){const a=t.charAt(o);if(r)r=!1,i+=(L.has(a)?"\\":"")+a;else if("\\"!==a){if("["===a){const[s,r,a,h]=b(t,o);if(a){i+=s,n=n||r,o+=a-1,e=e||h;continue}}"*"!==a?"?"!==a?i+=a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):(i+=x,e=!0):(i+=s&&"*"===t?P:N,e=!0)}else o===t.length-1?i+="\\\\":r=!0}return[i,$(t),!!e,n]}}const B=(t,{windowsPathsNoEscape:e=!1}={})=>e?t.replace(/[?*()[\]]/g,"[$&]"):t.replace(/[?*()[\]\\]/g,"\\$&"),M=(t,e,s={})=>(R(e),!(!s.nocomment&&"#"===e.charAt(0))&&new ct(e,s).match(t)),F=/^\*+([^+@!?\*\[\(]*)$/,U=t=>e=>!e.startsWith(".")&&e.endsWith(t),V=t=>e=>e.endsWith(t),H=t=>(t=t.toLowerCase(),e=>!e.startsWith(".")&&e.toLowerCase().endsWith(t)),j=t=>(t=t.toLowerCase(),e=>e.toLowerCase().endsWith(t)),G=/^\*+\.\*+$/,z=t=>!t.startsWith(".")&&t.includes("."),W=t=>"."!==t&&".."!==t&&t.includes("."),X=/^\.\*+$/,K=t=>"."!==t&&".."!==t&&t.startsWith("."),q=/^\*+$/,Y=t=>0!==t.length&&!t.startsWith("."),Z=t=>0!==t.length&&"."!==t&&".."!==t,J=/^\?+([^+@!?\*\[\(]*)?$/,Q=([t,e=""])=>{const s=rt([t]);return e?(e=e.toLowerCase(),t=>s(t)&&t.toLowerCase().endsWith(e)):s},tt=([t,e=""])=>{const s=it([t]);return e?(e=e.toLowerCase(),t=>s(t)&&t.toLowerCase().endsWith(e)):s},et=([t,e=""])=>{const s=it([t]);return e?t=>s(t)&&t.endsWith(e):s},st=([t,e=""])=>{const s=rt([t]);return e?t=>s(t)&&t.endsWith(e):s},rt=([t])=>{const e=t.length;return t=>t.length===e&&!t.startsWith(".")},it=([t])=>{const e=t.length;return t=>t.length===e&&"."!==t&&".."!==t},nt="object"==typeof process&&process?"object"==typeof process.env&&process.env&&process.env.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix";M.sep="win32"===nt?"\\":"/";const ot=Symbol("globstar **");M.GLOBSTAR=ot,M.filter=(t,e={})=>s=>M(s,t,e);const at=(t,e={})=>Object.assign({},t,e);M.defaults=t=>{if(!t||"object"!=typeof t||!Object.keys(t).length)return M;const e=M;return Object.assign(((s,r,i={})=>e(s,r,at(t,i))),{Minimatch:class extends e.Minimatch{constructor(e,s={}){super(e,at(t,s))}static defaults(s){return e.defaults(at(t,s)).Minimatch}},AST:class extends e.AST{constructor(e,s,r={}){super(e,s,at(t,r))}static fromGlob(s,r={}){return e.AST.fromGlob(s,at(t,r))}},unescape:(s,r={})=>e.unescape(s,at(t,r)),escape:(s,r={})=>e.escape(s,at(t,r)),filter:(s,r={})=>e.filter(s,at(t,r)),defaults:s=>e.defaults(at(t,s)),makeRe:(s,r={})=>e.makeRe(s,at(t,r)),braceExpand:(s,r={})=>e.braceExpand(s,at(t,r)),match:(s,r,i={})=>e.match(s,r,at(t,i)),sep:e.sep,GLOBSTAR:ot})};const ht=(t,e={})=>(R(t),e.nobrace||!/\{(?:(?!\{).)*\}/.test(t)?[t]:v(t));M.braceExpand=ht,M.makeRe=(t,e={})=>new ct(t,e).makeRe(),M.match=(t,e,s={})=>{const r=new ct(e,s);return t=t.filter((t=>r.match(t))),r.options.nonull&&!t.length&&t.push(e),t};const lt=/[?*]|[+@!]\(.*?\)|\[|\]/;class ct{options;set;pattern;windowsPathsNoEscape;nonegate;negate;comment;empty;preserveMultipleSlashes;partial;globSet;globParts;nocase;isWindows;platform;windowsNoMagicRoot;regexp;constructor(t,e={}){R(t),e=e||{},this.options=e,this.pattern=t,this.platform=e.platform||nt,this.isWindows="win32"===this.platform,this.windowsPathsNoEscape=!!e.windowsPathsNoEscape||!1===e.allowWindowsEscape,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!e.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!e.nonegate,this.comment=!1,this.empty=!1,this.partial=!!e.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=void 0!==e.windowsNoMagicRoot?e.windowsNoMagicRoot:!(!this.isWindows||!this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(const t of this.set)for(const e of t)if("string"!=typeof e)return!0;return!1}debug(...t){}make(){const t=this.pattern,e=this.options;if(!e.nocomment&&"#"===t.charAt(0))return void(this.comment=!0);if(!t)return void(this.empty=!0);this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],e.debug&&(this.debug=(...t)=>console.error(...t)),this.debug(this.pattern,this.globSet);const s=this.globSet.map((t=>this.slashSplit(t)));this.globParts=this.preprocess(s),this.debug(this.pattern,this.globParts);let r=this.globParts.map(((t,e,s)=>{if(this.isWindows&&this.windowsNoMagicRoot){const e=!(""!==t[0]||""!==t[1]||"?"!==t[2]&&lt.test(t[2])||lt.test(t[3])),s=/^[a-z]:/i.test(t[0]);if(e)return[...t.slice(0,4),...t.slice(4).map((t=>this.parse(t)))];if(s)return[t[0],...t.slice(1).map((t=>this.parse(t)))]}return t.map((t=>this.parse(t)))}));if(this.debug(this.pattern,r),this.set=r.filter((t=>-1===t.indexOf(!1))),this.isWindows)for(let t=0;t<this.set.length;t++){const e=this.set[t];""===e[0]&&""===e[1]&&"?"===this.globParts[t][2]&&"string"==typeof e[3]&&/^[a-z]:$/i.test(e[3])&&(e[2]="?")}this.debug(this.pattern,this.set)}preprocess(t){if(this.options.noglobstar)for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)"**"===t[e][s]&&(t[e][s]="*");const{optimizationLevel:e=1}=this.options;return e>=2?(t=this.firstPhasePreProcess(t),t=this.secondPhasePreProcess(t)):t=e>=1?this.levelOneOptimize(t):this.adjascentGlobstarOptimize(t),t}adjascentGlobstarOptimize(t){return t.map((t=>{let e=-1;for(;-1!==(e=t.indexOf("**",e+1));){let s=e;for(;"**"===t[s+1];)s++;s!==e&&t.splice(e,s-e)}return t}))}levelOneOptimize(t){return t.map((t=>0===(t=t.reduce(((t,e)=>{const s=t[t.length-1];return"**"===e&&"**"===s?t:".."===e&&s&&".."!==s&&"."!==s&&"**"!==s?(t.pop(),t):(t.push(e),t)}),[])).length?[""]:t))}levelTwoFileOptimize(t){Array.isArray(t)||(t=this.slashSplit(t));let e=!1;do{if(e=!1,!this.preserveMultipleSlashes){for(let s=1;s<t.length-1;s++){const r=t[s];1===s&&""===r&&""===t[0]||"."!==r&&""!==r||(e=!0,t.splice(s,1),s--)}"."!==t[0]||2!==t.length||"."!==t[1]&&""!==t[1]||(e=!0,t.pop())}let s=0;for(;-1!==(s=t.indexOf("..",s+1));){const r=t[s-1];r&&"."!==r&&".."!==r&&"**"!==r&&(e=!0,t.splice(s-1,2),s-=2)}}while(e);return 0===t.length?[""]:t}firstPhasePreProcess(t){let e=!1;do{e=!1;for(let s of t){let r=-1;for(;-1!==(r=s.indexOf("**",r+1));){let i=r;for(;"**"===s[i+1];)i++;i>r&&s.splice(r+1,i-r);let n=s[r+1];const o=s[r+2],a=s[r+3];if(".."!==n)continue;if(!o||"."===o||".."===o||!a||"."===a||".."===a)continue;e=!0,s.splice(r,1);const h=s.slice(0);h[r]="**",t.push(h),r--}if(!this.preserveMultipleSlashes){for(let t=1;t<s.length-1;t++){const r=s[t];1===t&&""===r&&""===s[0]||"."!==r&&""!==r||(e=!0,s.splice(t,1),t--)}"."!==s[0]||2!==s.length||"."!==s[1]&&""!==s[1]||(e=!0,s.pop())}let i=0;for(;-1!==(i=s.indexOf("..",i+1));){const t=s[i-1];if(t&&"."!==t&&".."!==t&&"**"!==t){e=!0;const t=1===i&&"**"===s[i+1]?["."]:[];s.splice(i-1,2,...t),0===s.length&&s.push(""),i-=2}}}}while(e);return t}secondPhasePreProcess(t){for(let e=0;e<t.length-1;e++)for(let s=e+1;s<t.length;s++){const r=this.partsMatch(t[e],t[s],!this.preserveMultipleSlashes);r&&(t[e]=r,t[s]=[])}return t.filter((t=>t.length))}partsMatch(t,e,s=!1){let r=0,i=0,n=[],o="";for(;r<t.length&&i<e.length;)if(t[r]===e[i])n.push("b"===o?e[i]:t[r]),r++,i++;else if(s&&"**"===t[r]&&e[i]===t[r+1])n.push(t[r]),r++;else if(s&&"**"===e[i]&&t[r]===e[i+1])n.push(e[i]),i++;else if("*"!==t[r]||!e[i]||!this.options.dot&&e[i].startsWith(".")||"**"===e[i]){if("*"!==e[i]||!t[r]||!this.options.dot&&t[r].startsWith(".")||"**"===t[r])return!1;if("a"===o)return!1;o="b",n.push(e[i]),r++,i++}else{if("b"===o)return!1;o="a",n.push(t[r]),r++,i++}return t.length===e.length&&n}parseNegate(){if(this.nonegate)return;const t=this.pattern;let e=!1,s=0;for(let r=0;r<t.length&&"!"===t.charAt(r);r++)e=!e,s++;s&&(this.pattern=t.slice(s)),this.negate=e}matchOne(t,e,s=!1){const r=this.options;if(this.isWindows){const s=""===t[0]&&""===t[1]&&"?"===t[2]&&"string"==typeof t[3]&&/^[a-z]:$/i.test(t[3]),r=""===e[0]&&""===e[1]&&"?"===e[2]&&"string"==typeof e[3]&&/^[a-z]:$/i.test(e[3]);if(s&&r){const s=t[3],r=e[3];s.toLowerCase()===r.toLowerCase()&&(t[3]=r)}else if(r&&"string"==typeof t[0]){const s=e[3],r=t[0];s.toLowerCase()===r.toLowerCase()&&(e[3]=r,e=e.slice(3))}else if(s&&"string"==typeof e[0]){const s=t[3];s.toLowerCase()===e[0].toLowerCase()&&(e[0]=s,t=t.slice(3))}}const{optimizationLevel:i=1}=this.options;i>=2&&(t=this.levelTwoFileOptimize(t)),this.debug("matchOne",this,{file:t,pattern:e}),this.debug("matchOne",t.length,e.length);for(var n=0,o=0,a=t.length,h=e.length;n<a&&o<h;n++,o++){this.debug("matchOne loop");var l=e[o],c=t[n];if(this.debug(e,l,c),!1===l)return!1;if(l===ot){this.debug("GLOBSTAR",[e,l,c]);var u=n,d=o+1;if(d===h){for(this.debug("** at the end");n<a;n++)if("."===t[n]||".."===t[n]||!r.dot&&"."===t[n].charAt(0))return!1;return!0}for(;u<a;){var p=t[u];if(this.debug("\nglobstar while",t,u,e,d,p),this.matchOne(t.slice(u),e.slice(d),s))return this.debug("globstar found match!",u,a,p),!0;if("."===p||".."===p||!r.dot&&"."===p.charAt(0)){this.debug("dot detected!",t,u,e,d);break}this.debug("globstar swallow a segment, and continue"),u++}return!(!s||(this.debug("\n>>> no match, partial?",t,u,e,d),u!==a))}let i;if("string"==typeof l?(i=c===l,this.debug("string match",l,c,i)):(i=l.test(c),this.debug("pattern match",l,c,i)),!i)return!1}if(n===a&&o===h)return!0;if(n===a)return s;if(o===h)return n===a-1&&""===t[n];throw new Error("wtf?")}braceExpand(){return ht(this.pattern,this.options)}parse(t){R(t);const e=this.options;if("**"===t)return ot;if(""===t)return"";let s,r=null;(s=t.match(q))?r=e.dot?Z:Y:(s=t.match(F))?r=(e.nocase?e.dot?j:H:e.dot?V:U)(s[1]):(s=t.match(J))?r=(e.nocase?e.dot?tt:Q:e.dot?et:st)(s):(s=t.match(G))?r=e.dot?W:z:(s=t.match(X))&&(r=K);const i=D.fromGlob(t,this.options).toMMPattern();return r?Object.assign(i,{test:r}):i}makeRe(){if(this.regexp||!1===this.regexp)return this.regexp;const t=this.set;if(!t.length)return this.regexp=!1,this.regexp;const e=this.options,s=e.noglobstar?"[^/]*?":e.dot?"(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?":"(?:(?!(?:\\/|^)\\.).)*?",r=new Set(e.nocase?["i"]:[]);let i=t.map((t=>{const e=t.map((t=>{if(t instanceof RegExp)for(const e of t.flags.split(""))r.add(e);return"string"==typeof t?t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):t===ot?ot:t._src}));return e.forEach(((t,r)=>{const i=e[r+1],n=e[r-1];t===ot&&n!==ot&&(void 0===n?void 0!==i&&i!==ot?e[r+1]="(?:\\/|"+s+"\\/)?"+i:e[r]=s:void 0===i?e[r-1]=n+"(?:\\/|"+s+")?":i!==ot&&(e[r-1]=n+"(?:\\/|\\/"+s+"\\/)"+i,e[r+1]=ot))})),e.filter((t=>t!==ot)).join("/")})).join("|");const[n,o]=t.length>1?["(?:",")"]:["",""];i="^"+n+i+o+"$",this.negate&&(i="^(?!"+i+").+$");try{this.regexp=new RegExp(i,[...r].join(""))}catch(t){this.regexp=!1}return this.regexp}slashSplit(t){return this.preserveMultipleSlashes?t.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(t)?["",...t.split(/\/+/)]:t.split(/\/+/)}match(t,e=this.partial){if(this.debug("match",t,this.pattern),this.comment)return!1;if(this.empty)return""===t;if("/"===t&&e)return!0;const s=this.options;this.isWindows&&(t=t.split("\\").join("/"));const r=this.slashSplit(t);this.debug(this.pattern,"split",r);const i=this.set;this.debug(this.pattern,"set",i);let n=r[r.length-1];if(!n)for(let t=r.length-2;!n&&t>=0;t--)n=r[t];for(let t=0;t<i.length;t++){const o=i[t];let a=r;if(s.matchBase&&1===o.length&&(a=[n]),this.matchOne(a,o,e))return!!s.flipNegate||!this.negate}return!s.flipNegate&&this.negate}static defaults(t){return M.defaults(t).Minimatch}}M.AST=D,M.Minimatch=ct,M.escape=B,M.unescape=$;const ut="object"==typeof performance&&performance&&"function"==typeof performance.now?performance:Date,dt=new Set,pt="object"==typeof process&&process?process:{},ft=(t,e,s,r)=>{"function"==typeof pt.emitWarning?pt.emitWarning(t,e,s,r):console.error(`[${s}] ${e}: ${t}`)};let mt=globalThis.AbortController,gt=globalThis.AbortSignal;if(void 0===mt){gt=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(t,e){this._onabort.push(e)}},mt=class{constructor(){e()}signal=new gt;abort(t){if(!this.signal.aborted){this.signal.reason=t,this.signal.aborted=!0;for(const e of this.signal._onabort)e(t);this.signal.onabort?.(t)}}};let t="1"!==pt.env?.LRU_CACHE_IGNORE_AC_WARNING;const e=()=>{t&&(t=!1,ft("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",e))}}Symbol("type");const Et=t=>t&&t===Math.floor(t)&&t>0&&isFinite(t),St=t=>Et(t)?t<=Math.pow(2,8)?Uint8Array:t<=Math.pow(2,16)?Uint16Array:t<=Math.pow(2,32)?Uint32Array:t<=Number.MAX_SAFE_INTEGER?wt:null:null;class wt extends Array{constructor(t){super(t),this.fill(0)}}class vt{heap;length;static#f=!1;static create(t){const e=St(t);if(!e)return[];vt.#f=!0;const s=new vt(t,e);return vt.#f=!1,s}constructor(t,e){if(!vt.#f)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new e(t),this.length=0}push(t){this.heap[this.length++]=t}pop(){return this.heap[--this.length]}}class Rt{#m;#g;#E;#S;#w;#v;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#R;#y;#_;#I;#b;#$;#T;#O;#k;#C;#A;#L;#x;#N;#P;#D;#B;static unsafeExposeInternals(t){return{starts:t.#x,ttls:t.#N,sizes:t.#L,keyMap:t.#_,keyList:t.#I,valList:t.#b,next:t.#$,prev:t.#T,get head(){return t.#O},get tail(){return t.#k},free:t.#C,isBackgroundFetch:e=>t.#M(e),backgroundFetch:(e,s,r,i)=>t.#F(e,s,r,i),moveToTail:e=>t.#U(e),indexes:e=>t.#V(e),rindexes:e=>t.#H(e),isStale:e=>t.#j(e)}}get max(){return this.#m}get maxSize(){return this.#g}get calculatedSize(){return this.#y}get size(){return this.#R}get fetchMethod(){return this.#w}get memoMethod(){return this.#v}get dispose(){return this.#E}get disposeAfter(){return this.#S}constructor(t){const{max:e=0,ttl:s,ttlResolution:r=1,ttlAutopurge:i,updateAgeOnGet:n,updateAgeOnHas:o,allowStale:a,dispose:h,disposeAfter:l,noDisposeOnSet:c,noUpdateTTL:u,maxSize:d=0,maxEntrySize:p=0,sizeCalculation:f,fetchMethod:m,memoMethod:g,noDeleteOnFetchRejection:E,noDeleteOnStaleGet:S,allowStaleOnFetchRejection:w,allowStaleOnFetchAbort:v,ignoreFetchAbort:R}=t;if(0!==e&&!Et(e))throw new TypeError("max option must be a nonnegative integer");const y=e?St(e):Array;if(!y)throw new Error("invalid max value: "+e);if(this.#m=e,this.#g=d,this.maxEntrySize=p||this.#g,this.sizeCalculation=f,this.sizeCalculation){if(!this.#g&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if("function"!=typeof this.sizeCalculation)throw new TypeError("sizeCalculation set to non-function")}if(void 0!==g&&"function"!=typeof g)throw new TypeError("memoMethod must be a function if defined");if(this.#v=g,void 0!==m&&"function"!=typeof m)throw new TypeError("fetchMethod must be a function if specified");if(this.#w=m,this.#D=!!m,this.#_=new Map,this.#I=new Array(e).fill(void 0),this.#b=new Array(e).fill(void 0),this.#$=new y(e),this.#T=new y(e),this.#O=0,this.#k=0,this.#C=vt.create(e),this.#R=0,this.#y=0,"function"==typeof h&&(this.#E=h),"function"==typeof l?(this.#S=l,this.#A=[]):(this.#S=void 0,this.#A=void 0),this.#P=!!this.#E,this.#B=!!this.#S,this.noDisposeOnSet=!!c,this.noUpdateTTL=!!u,this.noDeleteOnFetchRejection=!!E,this.allowStaleOnFetchRejection=!!w,this.allowStaleOnFetchAbort=!!v,this.ignoreFetchAbort=!!R,0!==this.maxEntrySize){if(0!==this.#g&&!Et(this.#g))throw new TypeError("maxSize must be a positive integer if specified");if(!Et(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#G()}if(this.allowStale=!!a,this.noDeleteOnStaleGet=!!S,this.updateAgeOnGet=!!n,this.updateAgeOnHas=!!o,this.ttlResolution=Et(r)||0===r?r:1,this.ttlAutopurge=!!i,this.ttl=s||0,this.ttl){if(!Et(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#z()}if(0===this.#m&&0===this.ttl&&0===this.#g)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#m&&!this.#g){const t="LRU_CACHE_UNBOUNDED";(t=>!dt.has(t))(t)&&(dt.add(t),ft("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",t,Rt))}}getRemainingTTL(t){return this.#_.has(t)?1/0:0}#z(){const t=new wt(this.#m),e=new wt(this.#m);this.#N=t,this.#x=e,this.#W=(s,r,i=ut.now())=>{if(e[s]=0!==r?i:0,t[s]=r,0!==r&&this.ttlAutopurge){const t=setTimeout((()=>{this.#j(s)&&this.#X(this.#I[s],"expire")}),r+1);t.unref&&t.unref()}},this.#K=s=>{e[s]=0!==t[s]?ut.now():0},this.#q=(i,n)=>{if(t[n]){const o=t[n],a=e[n];if(!o||!a)return;i.ttl=o,i.start=a,i.now=s||r();const h=i.now-a;i.remainingTTL=o-h}};let s=0;const r=()=>{const t=ut.now();if(this.ttlResolution>0){s=t;const e=setTimeout((()=>s=0),this.ttlResolution);e.unref&&e.unref()}return t};this.getRemainingTTL=i=>{const n=this.#_.get(i);if(void 0===n)return 0;const o=t[n],a=e[n];return o&&a?o-((s||r())-a):1/0},this.#j=i=>{const n=e[i],o=t[i];return!!o&&!!n&&(s||r())-n>o}}#K=()=>{};#q=()=>{};#W=()=>{};#j=()=>!1;#G(){const t=new wt(this.#m);this.#y=0,this.#L=t,this.#Y=e=>{this.#y-=t[e],t[e]=0},this.#Z=(t,e,s,r)=>{if(this.#M(e))return 0;if(!Et(s)){if(!r)throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");if("function"!=typeof r)throw new TypeError("sizeCalculation must be a function");if(s=r(e,t),!Et(s))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}return s},this.#J=(e,s,r)=>{if(t[e]=s,this.#g){const s=this.#g-t[e];for(;this.#y>s;)this.#Q(!0)}this.#y+=t[e],r&&(r.entrySize=s,r.totalCalculatedSize=this.#y)}}#Y=t=>{};#J=(t,e,s)=>{};#Z=(t,e,s,r)=>{if(s||r)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#V({allowStale:t=this.allowStale}={}){if(this.#R)for(let e=this.#k;this.#tt(e)&&(!t&&this.#j(e)||(yield e),e!==this.#O);)e=this.#T[e]}*#H({allowStale:t=this.allowStale}={}){if(this.#R)for(let e=this.#O;this.#tt(e)&&(!t&&this.#j(e)||(yield e),e!==this.#k);)e=this.#$[e]}#tt(t){return void 0!==t&&this.#_.get(this.#I[t])===t}*entries(){for(const t of this.#V())void 0===this.#b[t]||void 0===this.#I[t]||this.#M(this.#b[t])||(yield[this.#I[t],this.#b[t]])}*rentries(){for(const t of this.#H())void 0===this.#b[t]||void 0===this.#I[t]||this.#M(this.#b[t])||(yield[this.#I[t],this.#b[t]])}*keys(){for(const t of this.#V()){const e=this.#I[t];void 0===e||this.#M(this.#b[t])||(yield e)}}*rkeys(){for(const t of this.#H()){const e=this.#I[t];void 0===e||this.#M(this.#b[t])||(yield e)}}*values(){for(const t of this.#V())void 0===this.#b[t]||this.#M(this.#b[t])||(yield this.#b[t])}*rvalues(){for(const t of this.#H())void 0===this.#b[t]||this.#M(this.#b[t])||(yield this.#b[t])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(t,e={}){for(const s of this.#V()){const r=this.#b[s],i=this.#M(r)?r.__staleWhileFetching:r;if(void 0!==i&&t(i,this.#I[s],this))return this.get(this.#I[s],e)}}forEach(t,e=this){for(const s of this.#V()){const r=this.#b[s],i=this.#M(r)?r.__staleWhileFetching:r;void 0!==i&&t.call(e,i,this.#I[s],this)}}rforEach(t,e=this){for(const s of this.#H()){const r=this.#b[s],i=this.#M(r)?r.__staleWhileFetching:r;void 0!==i&&t.call(e,i,this.#I[s],this)}}purgeStale(){let t=!1;for(const e of this.#H({allowStale:!0}))this.#j(e)&&(this.#X(this.#I[e],"expire"),t=!0);return t}info(t){const e=this.#_.get(t);if(void 0===e)return;const s=this.#b[e],r=this.#M(s)?s.__staleWhileFetching:s;if(void 0===r)return;const i={value:r};if(this.#N&&this.#x){const t=this.#N[e],s=this.#x[e];if(t&&s){const e=t-(ut.now()-s);i.ttl=e,i.start=Date.now()}}return this.#L&&(i.size=this.#L[e]),i}dump(){const t=[];for(const e of this.#V({allowStale:!0})){const s=this.#I[e],r=this.#b[e],i=this.#M(r)?r.__staleWhileFetching:r;if(void 0===i||void 0===s)continue;const n={value:i};if(this.#N&&this.#x){n.ttl=this.#N[e];const t=ut.now()-this.#x[e];n.start=Math.floor(Date.now()-t)}this.#L&&(n.size=this.#L[e]),t.unshift([s,n])}return t}load(t){this.clear();for(const[e,s]of t){if(s.start){const t=Date.now()-s.start;s.start=ut.now()-t}this.set(e,s.value,s)}}set(t,e,s={}){if(void 0===e)return this.delete(t),this;const{ttl:r=this.ttl,start:i,noDisposeOnSet:n=this.noDisposeOnSet,sizeCalculation:o=this.sizeCalculation,status:a}=s;let{noUpdateTTL:h=this.noUpdateTTL}=s;const l=this.#Z(t,e,s.size||0,o);if(this.maxEntrySize&&l>this.maxEntrySize)return a&&(a.set="miss",a.maxEntrySizeExceeded=!0),this.#X(t,"set"),this;let c=0===this.#R?void 0:this.#_.get(t);if(void 0===c)c=0===this.#R?this.#k:0!==this.#C.length?this.#C.pop():this.#R===this.#m?this.#Q(!1):this.#R,this.#I[c]=t,this.#b[c]=e,this.#_.set(t,c),this.#$[this.#k]=c,this.#T[c]=this.#k,this.#k=c,this.#R++,this.#J(c,l,a),a&&(a.set="add"),h=!1;else{this.#U(c);const s=this.#b[c];if(e!==s){if(this.#D&&this.#M(s)){s.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:e}=s;void 0===e||n||(this.#P&&this.#E?.(e,t,"set"),this.#B&&this.#A?.push([e,t,"set"]))}else n||(this.#P&&this.#E?.(s,t,"set"),this.#B&&this.#A?.push([s,t,"set"]));if(this.#Y(c),this.#J(c,l,a),this.#b[c]=e,a){a.set="replace";const t=s&&this.#M(s)?s.__staleWhileFetching:s;void 0!==t&&(a.oldValue=t)}}else a&&(a.set="update")}if(0===r||this.#N||this.#z(),this.#N&&(h||this.#W(c,r,i),a&&this.#q(a,c)),!n&&this.#B&&this.#A){const t=this.#A;let e;for(;e=t?.shift();)this.#S?.(...e)}return this}pop(){try{for(;this.#R;){const t=this.#b[this.#O];if(this.#Q(!0),this.#M(t)){if(t.__staleWhileFetching)return t.__staleWhileFetching}else if(void 0!==t)return t}}finally{if(this.#B&&this.#A){const t=this.#A;let e;for(;e=t?.shift();)this.#S?.(...e)}}}#Q(t){const e=this.#O,s=this.#I[e],r=this.#b[e];return this.#D&&this.#M(r)?r.__abortController.abort(new Error("evicted")):(this.#P||this.#B)&&(this.#P&&this.#E?.(r,s,"evict"),this.#B&&this.#A?.push([r,s,"evict"])),this.#Y(e),t&&(this.#I[e]=void 0,this.#b[e]=void 0,this.#C.push(e)),1===this.#R?(this.#O=this.#k=0,this.#C.length=0):this.#O=this.#$[e],this.#_.delete(s),this.#R--,e}has(t,e={}){const{updateAgeOnHas:s=this.updateAgeOnHas,status:r}=e,i=this.#_.get(t);if(void 0!==i){const t=this.#b[i];if(this.#M(t)&&void 0===t.__staleWhileFetching)return!1;if(!this.#j(i))return s&&this.#K(i),r&&(r.has="hit",this.#q(r,i)),!0;r&&(r.has="stale",this.#q(r,i))}else r&&(r.has="miss");return!1}peek(t,e={}){const{allowStale:s=this.allowStale}=e,r=this.#_.get(t);if(void 0===r||!s&&this.#j(r))return;const i=this.#b[r];return this.#M(i)?i.__staleWhileFetching:i}#F(t,e,s,r){const i=void 0===e?void 0:this.#b[e];if(this.#M(i))return i;const n=new mt,{signal:o}=s;o?.addEventListener("abort",(()=>n.abort(o.reason)),{signal:n.signal});const a={signal:n.signal,options:s,context:r},h=(r,i=!1)=>{const{aborted:o}=n.signal,h=s.ignoreFetchAbort&&void 0!==r;if(s.status&&(o&&!i?(s.status.fetchAborted=!0,s.status.fetchError=n.signal.reason,h&&(s.status.fetchAbortIgnored=!0)):s.status.fetchResolved=!0),o&&!h&&!i)return l(n.signal.reason);const u=c;return this.#b[e]===c&&(void 0===r?u.__staleWhileFetching?this.#b[e]=u.__staleWhileFetching:this.#X(t,"fetch"):(s.status&&(s.status.fetchUpdated=!0),this.set(t,r,a.options))),r},l=r=>{const{aborted:i}=n.signal,o=i&&s.allowStaleOnFetchAbort,a=o||s.allowStaleOnFetchRejection,h=a||s.noDeleteOnFetchRejection,l=c;if(this.#b[e]===c&&(h&&void 0!==l.__staleWhileFetching?o||(this.#b[e]=l.__staleWhileFetching):this.#X(t,"fetch")),a)return s.status&&void 0!==l.__staleWhileFetching&&(s.status.returnedStale=!0),l.__staleWhileFetching;if(l.__returned===l)throw r};s.status&&(s.status.fetchDispatched=!0);const c=new Promise(((e,r)=>{const o=this.#w?.(t,i,a);o&&o instanceof Promise&&o.then((t=>e(void 0===t?void 0:t)),r),n.signal.addEventListener("abort",(()=>{s.ignoreFetchAbort&&!s.allowStaleOnFetchAbort||(e(void 0),s.allowStaleOnFetchAbort&&(e=t=>h(t,!0)))}))})).then(h,(t=>(s.status&&(s.status.fetchRejected=!0,s.status.fetchError=t),l(t)))),u=Object.assign(c,{__abortController:n,__staleWhileFetching:i,__returned:void 0});return void 0===e?(this.set(t,u,{...a.options,status:void 0}),e=this.#_.get(t)):this.#b[e]=u,u}#M(t){if(!this.#D)return!1;const e=t;return!!e&&e instanceof Promise&&e.hasOwnProperty("__staleWhileFetching")&&e.__abortController instanceof mt}async fetch(t,e={}){const{allowStale:s=this.allowStale,updateAgeOnGet:r=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,ttl:n=this.ttl,noDisposeOnSet:o=this.noDisposeOnSet,size:a=0,sizeCalculation:h=this.sizeCalculation,noUpdateTTL:l=this.noUpdateTTL,noDeleteOnFetchRejection:c=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:u=this.allowStaleOnFetchRejection,ignoreFetchAbort:d=this.ignoreFetchAbort,allowStaleOnFetchAbort:p=this.allowStaleOnFetchAbort,context:f,forceRefresh:m=!1,status:g,signal:E}=e;if(!this.#D)return g&&(g.fetch="get"),this.get(t,{allowStale:s,updateAgeOnGet:r,noDeleteOnStaleGet:i,status:g});const S={allowStale:s,updateAgeOnGet:r,noDeleteOnStaleGet:i,ttl:n,noDisposeOnSet:o,size:a,sizeCalculation:h,noUpdateTTL:l,noDeleteOnFetchRejection:c,allowStaleOnFetchRejection:u,allowStaleOnFetchAbort:p,ignoreFetchAbort:d,status:g,signal:E};let w=this.#_.get(t);if(void 0===w){g&&(g.fetch="miss");const e=this.#F(t,w,S,f);return e.__returned=e}{const e=this.#b[w];if(this.#M(e)){const t=s&&void 0!==e.__staleWhileFetching;return g&&(g.fetch="inflight",t&&(g.returnedStale=!0)),t?e.__staleWhileFetching:e.__returned=e}const i=this.#j(w);if(!m&&!i)return g&&(g.fetch="hit"),this.#U(w),r&&this.#K(w),g&&this.#q(g,w),e;const n=this.#F(t,w,S,f),o=void 0!==n.__staleWhileFetching&&s;return g&&(g.fetch=i?"stale":"refresh",o&&i&&(g.returnedStale=!0)),o?n.__staleWhileFetching:n.__returned=n}}async forceFetch(t,e={}){const s=await this.fetch(t,e);if(void 0===s)throw new Error("fetch() returned undefined");return s}memo(t,e={}){const s=this.#v;if(!s)throw new Error("no memoMethod provided to constructor");const{context:r,forceRefresh:i,...n}=e,o=this.get(t,n);if(!i&&void 0!==o)return o;const a=s(t,o,{options:n,context:r});return this.set(t,a,n),a}get(t,e={}){const{allowStale:s=this.allowStale,updateAgeOnGet:r=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,status:n}=e,o=this.#_.get(t);if(void 0!==o){const e=this.#b[o],a=this.#M(e);return n&&this.#q(n,o),this.#j(o)?(n&&(n.get="stale"),a?(n&&s&&void 0!==e.__staleWhileFetching&&(n.returnedStale=!0),s?e.__staleWhileFetching:void 0):(i||this.#X(t,"expire"),n&&s&&(n.returnedStale=!0),s?e:void 0)):(n&&(n.get="hit"),a?e.__staleWhileFetching:(this.#U(o),r&&this.#K(o),e))}n&&(n.get="miss")}#et(t,e){this.#T[e]=t,this.#$[t]=e}#U(t){t!==this.#k&&(t===this.#O?this.#O=this.#$[t]:this.#et(this.#T[t],this.#$[t]),this.#et(this.#k,t),this.#k=t)}delete(t){return this.#X(t,"delete")}#X(t,e){let s=!1;if(0!==this.#R){const r=this.#_.get(t);if(void 0!==r)if(s=!0,1===this.#R)this.#st(e);else{this.#Y(r);const s=this.#b[r];if(this.#M(s)?s.__abortController.abort(new Error("deleted")):(this.#P||this.#B)&&(this.#P&&this.#E?.(s,t,e),this.#B&&this.#A?.push([s,t,e])),this.#_.delete(t),this.#I[r]=void 0,this.#b[r]=void 0,r===this.#k)this.#k=this.#T[r];else if(r===this.#O)this.#O=this.#$[r];else{const t=this.#T[r];this.#$[t]=this.#$[r];const e=this.#$[r];this.#T[e]=this.#T[r]}this.#R--,this.#C.push(r)}}if(this.#B&&this.#A?.length){const t=this.#A;let e;for(;e=t?.shift();)this.#S?.(...e)}return s}clear(){return this.#st("delete")}#st(t){for(const e of this.#H({allowStale:!0})){const s=this.#b[e];if(this.#M(s))s.__abortController.abort(new Error("deleted"));else{const r=this.#I[e];this.#P&&this.#E?.(s,r,t),this.#B&&this.#A?.push([s,r,t])}}if(this.#_.clear(),this.#b.fill(void 0),this.#I.fill(void 0),this.#N&&this.#x&&(this.#N.fill(0),this.#x.fill(0)),this.#L&&this.#L.fill(0),this.#O=0,this.#k=0,this.#C.length=0,this.#y=0,this.#R=0,this.#B&&this.#A){const t=this.#A;let e;for(;e=t?.shift();)this.#S?.(...e)}}}const yt=require("node:path"),_t=require("node:url"),It=require("node:fs");var bt=i.t(It,2);const $t=require("node:fs/promises"),Tt=require("node:events"),Ot=require("node:stream"),kt=require("node:string_decoder"),Ct="object"==typeof process&&process?process:{stdout:null,stderr:null},At=t=>!!t&&"object"==typeof t&&(t instanceof me||t instanceof Ot||Lt(t)||xt(t)),Lt=t=>!!t&&"object"==typeof t&&t instanceof Tt.EventEmitter&&"function"==typeof t.pipe&&t.pipe!==Ot.Writable.prototype.pipe,xt=t=>!!t&&"object"==typeof t&&t instanceof Tt.EventEmitter&&"function"==typeof t.write&&"function"==typeof t.end,Nt=Symbol("EOF"),Pt=Symbol("maybeEmitEnd"),Dt=Symbol("emittedEnd"),Bt=Symbol("emittingEnd"),Mt=Symbol("emittedError"),Ft=Symbol("closed"),Ut=Symbol("read"),Vt=Symbol("flush"),Ht=Symbol("flushChunk"),jt=Symbol("encoding"),Gt=Symbol("decoder"),zt=Symbol("flowing"),Wt=Symbol("paused"),Xt=Symbol("resume"),Kt=Symbol("buffer"),qt=Symbol("pipes"),Yt=Symbol("bufferLength"),Zt=Symbol("bufferPush"),Jt=Symbol("bufferShift"),Qt=Symbol("objectMode"),te=Symbol("destroyed"),ee=Symbol("error"),se=Symbol("emitData"),re=Symbol("emitEnd"),ie=Symbol("emitEnd2"),ne=Symbol("async"),oe=Symbol("abort"),ae=Symbol("aborted"),he=Symbol("signal"),le=Symbol("dataListeners"),ce=Symbol("discarded"),ue=t=>Promise.resolve().then(t),de=t=>t();class pe{src;dest;opts;ondrain;constructor(t,e,s){this.src=t,this.dest=e,this.opts=s,this.ondrain=()=>t[Xt](),this.dest.on("drain",this.ondrain)}unpipe(){this.dest.removeListener("drain",this.ondrain)}proxyErrors(t){}end(){this.unpipe(),this.opts.end&&this.dest.end()}}class fe extends pe{unpipe(){this.src.removeListener("error",this.proxyErrors),super.unpipe()}constructor(t,e,s){super(t,e,s),this.proxyErrors=t=>e.emit("error",t),t.on("error",this.proxyErrors)}}class me extends Tt.EventEmitter{[zt]=!1;[Wt]=!1;[qt]=[];[Kt]=[];[Qt];[jt];[ne];[Gt];[Nt]=!1;[Dt]=!1;[Bt]=!1;[Ft]=!1;[Mt]=null;[Yt]=0;[te]=!1;[he];[ae]=!1;[le]=0;[ce]=!1;writable=!0;readable=!0;constructor(...t){const e=t[0]||{};if(super(),e.objectMode&&"string"==typeof e.encoding)throw new TypeError("Encoding and objectMode may not be used together");var s;e.objectMode?(this[Qt]=!0,this[jt]=null):!(s=e).objectMode&&s.encoding&&"buffer"!==s.encoding?(this[jt]=e.encoding,this[Qt]=!1):(this[Qt]=!1,this[jt]=null),this[ne]=!!e.async,this[Gt]=this[jt]?new kt.StringDecoder(this[jt]):null,e&&!0===e.debugExposeBuffer&&Object.defineProperty(this,"buffer",{get:()=>this[Kt]}),e&&!0===e.debugExposePipes&&Object.defineProperty(this,"pipes",{get:()=>this[qt]});const{signal:r}=e;r&&(this[he]=r,r.aborted?this[oe]():r.addEventListener("abort",(()=>this[oe]())))}get bufferLength(){return this[Yt]}get encoding(){return this[jt]}set encoding(t){throw new Error("Encoding must be set at instantiation time")}setEncoding(t){throw new Error("Encoding must be set at instantiation time")}get objectMode(){return this[Qt]}set objectMode(t){throw new Error("objectMode must be set at instantiation time")}get async(){return this[ne]}set async(t){this[ne]=this[ne]||!!t}[oe](){this[ae]=!0,this.emit("abort",this[he]?.reason),this.destroy(this[he]?.reason)}get aborted(){return this[ae]}set aborted(t){}write(t,e,s){if(this[ae])return!1;if(this[Nt])throw new Error("write after end");if(this[te])return this.emit("error",Object.assign(new Error("Cannot call write after a stream was destroyed"),{code:"ERR_STREAM_DESTROYED"})),!0;"function"==typeof e&&(s=e,e="utf8"),e||(e="utf8");const r=this[ne]?ue:de;if(!this[Qt]&&!Buffer.isBuffer(t))if(i=t,!Buffer.isBuffer(i)&&ArrayBuffer.isView(i))t=Buffer.from(t.buffer,t.byteOffset,t.byteLength);else if((t=>t instanceof ArrayBuffer||!!t&&"object"==typeof t&&t.constructor&&"ArrayBuffer"===t.constructor.name&&t.byteLength>=0)(t))t=Buffer.from(t);else if("string"!=typeof t)throw new Error("Non-contiguous data written to non-objectMode stream");var i;return this[Qt]?(this[zt]&&0!==this[Yt]&&this[Vt](!0),this[zt]?this.emit("data",t):this[Zt](t),0!==this[Yt]&&this.emit("readable"),s&&r(s),this[zt]):t.length?("string"!=typeof t||e===this[jt]&&!this[Gt]?.lastNeed||(t=Buffer.from(t,e)),Buffer.isBuffer(t)&&this[jt]&&(t=this[Gt].write(t)),this[zt]&&0!==this[Yt]&&this[Vt](!0),this[zt]?this.emit("data",t):this[Zt](t),0!==this[Yt]&&this.emit("readable"),s&&r(s),this[zt]):(0!==this[Yt]&&this.emit("readable"),s&&r(s),this[zt])}read(t){if(this[te])return null;if(this[ce]=!1,0===this[Yt]||0===t||t&&t>this[Yt])return this[Pt](),null;this[Qt]&&(t=null),this[Kt].length>1&&!this[Qt]&&(this[Kt]=[this[jt]?this[Kt].join(""):Buffer.concat(this[Kt],this[Yt])]);const e=this[Ut](t||null,this[Kt][0]);return this[Pt](),e}[Ut](t,e){if(this[Qt])this[Jt]();else{const s=e;t===s.length||null===t?this[Jt]():"string"==typeof s?(this[Kt][0]=s.slice(t),e=s.slice(0,t),this[Yt]-=t):(this[Kt][0]=s.subarray(t),e=s.subarray(0,t),this[Yt]-=t)}return this.emit("data",e),this[Kt].length||this[Nt]||this.emit("drain"),e}end(t,e,s){return"function"==typeof t&&(s=t,t=void 0),"function"==typeof e&&(s=e,e="utf8"),void 0!==t&&this.write(t,e),s&&this.once("end",s),this[Nt]=!0,this.writable=!1,!this[zt]&&this[Wt]||this[Pt](),this}[Xt](){this[te]||(this[le]||this[qt].length||(this[ce]=!0),this[Wt]=!1,this[zt]=!0,this.emit("resume"),this[Kt].length?this[Vt]():this[Nt]?this[Pt]():this.emit("drain"))}resume(){return this[Xt]()}pause(){this[zt]=!1,this[Wt]=!0,this[ce]=!1}get destroyed(){return this[te]}get flowing(){return this[zt]}get paused(){return this[Wt]}[Zt](t){this[Qt]?this[Yt]+=1:this[Yt]+=t.length,this[Kt].push(t)}[Jt](){return this[Qt]?this[Yt]-=1:this[Yt]-=this[Kt][0].length,this[Kt].shift()}[Vt](t=!1){do{}while(this[Ht](this[Jt]())&&this[Kt].length);t||this[Kt].length||this[Nt]||this.emit("drain")}[Ht](t){return this.emit("data",t),this[zt]}pipe(t,e){if(this[te])return t;this[ce]=!1;const s=this[Dt];return e=e||{},t===Ct.stdout||t===Ct.stderr?e.end=!1:e.end=!1!==e.end,e.proxyErrors=!!e.proxyErrors,s?e.end&&t.end():(this[qt].push(e.proxyErrors?new fe(this,t,e):new pe(this,t,e)),this[ne]?ue((()=>this[Xt]())):this[Xt]()),t}unpipe(t){const e=this[qt].find((e=>e.dest===t));e&&(1===this[qt].length?(this[zt]&&0===this[le]&&(this[zt]=!1),this[qt]=[]):this[qt].splice(this[qt].indexOf(e),1),e.unpipe())}addListener(t,e){return this.on(t,e)}on(t,e){const s=super.on(t,e);if("data"===t)this[ce]=!1,this[le]++,this[qt].length||this[zt]||this[Xt]();else if("readable"===t&&0!==this[Yt])super.emit("readable");else if((t=>"end"===t||"finish"===t||"prefinish"===t)(t)&&this[Dt])super.emit(t),this.removeAllListeners(t);else if("error"===t&&this[Mt]){const t=e;this[ne]?ue((()=>t.call(this,this[Mt]))):t.call(this,this[Mt])}return s}removeListener(t,e){return this.off(t,e)}off(t,e){const s=super.off(t,e);return"data"===t&&(this[le]=this.listeners("data").length,0!==this[le]||this[ce]||this[qt].length||(this[zt]=!1)),s}removeAllListeners(t){const e=super.removeAllListeners(t);return"data"!==t&&void 0!==t||(this[le]=0,this[ce]||this[qt].length||(this[zt]=!1)),e}get emittedEnd(){return this[Dt]}[Pt](){this[Bt]||this[Dt]||this[te]||0!==this[Kt].length||!this[Nt]||(this[Bt]=!0,this.emit("end"),this.emit("prefinish"),this.emit("finish"),this[Ft]&&this.emit("close"),this[Bt]=!1)}emit(t,...e){const s=e[0];if("error"!==t&&"close"!==t&&t!==te&&this[te])return!1;if("data"===t)return!(!this[Qt]&&!s)&&(this[ne]?(ue((()=>this[se](s))),!0):this[se](s));if("end"===t)return this[re]();if("close"===t){if(this[Ft]=!0,!this[Dt]&&!this[te])return!1;const t=super.emit("close");return this.removeAllListeners("close"),t}if("error"===t){this[Mt]=s,super.emit(ee,s);const t=!(this[he]&&!this.listeners("error").length)&&super.emit("error",s);return this[Pt](),t}if("resume"===t){const t=super.emit("resume");return this[Pt](),t}if("finish"===t||"prefinish"===t){const e=super.emit(t);return this.removeAllListeners(t),e}const r=super.emit(t,...e);return this[Pt](),r}[se](t){for(const e of this[qt])!1===e.dest.write(t)&&this.pause();const e=!this[ce]&&super.emit("data",t);return this[Pt](),e}[re](){return!this[Dt]&&(this[Dt]=!0,this.readable=!1,this[ne]?(ue((()=>this[ie]())),!0):this[ie]())}[ie](){if(this[Gt]){const t=this[Gt].end();if(t){for(const e of this[qt])e.dest.write(t);this[ce]||super.emit("data",t)}}for(const t of this[qt])t.end();const t=super.emit("end");return this.removeAllListeners("end"),t}async collect(){const t=Object.assign([],{dataLength:0});this[Qt]||(t.dataLength=0);const e=this.promise();return this.on("data",(e=>{t.push(e),this[Qt]||(t.dataLength+=e.length)})),await e,t}async concat(){if(this[Qt])throw new Error("cannot concat in objectMode");const t=await this.collect();return this[jt]?t.join(""):Buffer.concat(t,t.dataLength)}async promise(){return new Promise(((t,e)=>{this.on(te,(()=>e(new Error("stream destroyed")))),this.on("error",(t=>e(t))),this.on("end",(()=>t()))}))}[Symbol.asyncIterator](){this[ce]=!1;let t=!1;const e=async()=>(this.pause(),t=!0,{value:void 0,done:!0});return{next:()=>{if(t)return e();const s=this.read();if(null!==s)return Promise.resolve({done:!1,value:s});if(this[Nt])return e();let r,i;const n=t=>{this.off("data",o),this.off("end",a),this.off(te,h),e(),i(t)},o=t=>{this.off("error",n),this.off("end",a),this.off(te,h),this.pause(),r({value:t,done:!!this[Nt]})},a=()=>{this.off("error",n),this.off("data",o),this.off(te,h),e(),r({done:!0,value:void 0})},h=()=>n(new Error("stream destroyed"));return new Promise(((t,e)=>{i=e,r=t,this.once(te,h),this.once("error",n),this.once("end",a),this.once("data",o)}))},throw:e,return:e,[Symbol.asyncIterator](){return this}}}[Symbol.iterator](){this[ce]=!1;let t=!1;const e=()=>(this.pause(),this.off(ee,e),this.off(te,e),this.off("end",e),t=!0,{done:!0,value:void 0});return this.once("end",e),this.once(ee,e),this.once(te,e),{next:()=>{if(t)return e();const s=this.read();return null===s?e():{done:!1,value:s}},throw:e,return:e,[Symbol.iterator](){return this}}}destroy(t){return this[te]?(t?this.emit("error",t):this.emit(te),this):(this[te]=!0,this[ce]=!0,this[Kt].length=0,this[Yt]=0,"function"!=typeof this.close||this[Ft]||this.close(),t?this.emit("error",t):this.emit(te),this)}static get isStream(){return At}}const ge=h.realpathSync.native,Ee={lstatSync:h.lstatSync,readdir:h.readdir,readdirSync:h.readdirSync,readlinkSync:h.readlinkSync,realpathSync:ge,promises:{lstat:$t.lstat,readdir:$t.readdir,readlink:$t.readlink,realpath:$t.realpath}},Se=t=>t&&t!==Ee&&t!==bt?{...Ee,...t,promises:{...Ee.promises,...t.promises||{}}}:Ee,we=/^\\\\\?\\([a-z]:)\\?$/i,ve=/[\\\/]/,Re=10,ye=15,_e=-16,Ie=128,be=t=>t.isFile()?8:t.isDirectory()?4:t.isSymbolicLink()?Re:t.isCharacterDevice()?2:t.isBlockDevice()?6:t.isSocket()?12:t.isFIFO()?1:0,$e=new Map,Te=t=>{const e=$e.get(t);if(e)return e;const s=t.normalize("NFKD");return $e.set(t,s),s},Oe=new Map,ke=t=>{const e=Oe.get(t);if(e)return e;const s=Te(t.toLowerCase());return Oe.set(t,s),s};class Ce extends Rt{constructor(){super({max:256})}}class Ae extends Rt{constructor(t=16384){super({maxSize:t,sizeCalculation:t=>t.length+1})}}const Le=Symbol("PathScurry setAsCwd");class xe{name;root;roots;parent;nocase;isCWD=!1;#rt;#it;get dev(){return this.#it}#nt;get mode(){return this.#nt}#ot;get nlink(){return this.#ot}#at;get uid(){return this.#at}#ht;get gid(){return this.#ht}#lt;get rdev(){return this.#lt}#ct;get blksize(){return this.#ct}#ut;get ino(){return this.#ut}#R;get size(){return this.#R}#dt;get blocks(){return this.#dt}#pt;get atimeMs(){return this.#pt}#ft;get mtimeMs(){return this.#ft}#mt;get ctimeMs(){return this.#mt}#gt;get birthtimeMs(){return this.#gt}#Et;get atime(){return this.#Et}#St;get mtime(){return this.#St}#wt;get ctime(){return this.#wt}#vt;get birthtime(){return this.#vt}#Rt;#yt;#_t;#It;#bt;#$t;#Tt;#Ot;#kt;#Ct;get parentPath(){return(this.parent||this).fullpath()}get path(){return this.parentPath}constructor(t,e=0,s,r,i,n,o){this.name=t,this.#Rt=i?ke(t):Te(t),this.#Tt=1023&e,this.nocase=i,this.roots=r,this.root=s||this,this.#Ot=n,this.#_t=o.fullpath,this.#bt=o.relative,this.#$t=o.relativePosix,this.parent=o.parent,this.parent?this.#rt=this.parent.#rt:this.#rt=Se(o.fs)}depth(){return void 0!==this.#yt?this.#yt:this.parent?this.#yt=this.parent.depth()+1:this.#yt=0}childrenCache(){return this.#Ot}resolve(t){if(!t)return this;const e=this.getRootString(t),s=t.substring(e.length).split(this.splitSep);return e?this.getRoot(e).#At(s):this.#At(s)}#At(t){let e=this;for(const s of t)e=e.child(s);return e}children(){const t=this.#Ot.get(this);if(t)return t;const e=Object.assign([],{provisional:0});return this.#Ot.set(this,e),this.#Tt&=-17,e}child(t,e){if(""===t||"."===t)return this;if(".."===t)return this.parent||this;const s=this.children(),r=this.nocase?ke(t):Te(t);for(const t of s)if(t.#Rt===r)return t;const i=this.parent?this.sep:"",n=this.#_t?this.#_t+i+t:void 0,o=this.newChild(t,0,{...e,parent:this,fullpath:n});return this.canReaddir()||(o.#Tt|=Ie),s.push(o),o}relative(){if(this.isCWD)return"";if(void 0!==this.#bt)return this.#bt;const t=this.name,e=this.parent;if(!e)return this.#bt=this.name;const s=e.relative();return s+(s&&e.parent?this.sep:"")+t}relativePosix(){if("/"===this.sep)return this.relative();if(this.isCWD)return"";if(void 0!==this.#$t)return this.#$t;const t=this.name,e=this.parent;if(!e)return this.#$t=this.fullpathPosix();const s=e.relativePosix();return s+(s&&e.parent?"/":"")+t}fullpath(){if(void 0!==this.#_t)return this.#_t;const t=this.name,e=this.parent;if(!e)return this.#_t=this.name;const s=e.fullpath()+(e.parent?this.sep:"")+t;return this.#_t=s}fullpathPosix(){if(void 0!==this.#It)return this.#It;if("/"===this.sep)return this.#It=this.fullpath();if(!this.parent){const t=this.fullpath().replace(/\\/g,"/");return/^[a-z]:\//i.test(t)?this.#It=`//?/${t}`:this.#It=t}const t=this.parent,e=t.fullpathPosix(),s=e+(e&&t.parent?"/":"")+this.name;return this.#It=s}isUnknown(){return!(this.#Tt&ye)}isType(t){return this[`is${t}`]()}getType(){return this.isUnknown()?"Unknown":this.isDirectory()?"Directory":this.isFile()?"File":this.isSymbolicLink()?"SymbolicLink":this.isFIFO()?"FIFO":this.isCharacterDevice()?"CharacterDevice":this.isBlockDevice()?"BlockDevice":this.isSocket()?"Socket":"Unknown"}isFile(){return 8==(this.#Tt&ye)}isDirectory(){return 4==(this.#Tt&ye)}isCharacterDevice(){return 2==(this.#Tt&ye)}isBlockDevice(){return 6==(this.#Tt&ye)}isFIFO(){return 1==(this.#Tt&ye)}isSocket(){return 12==(this.#Tt&ye)}isSymbolicLink(){return(this.#Tt&Re)===Re}lstatCached(){return 32&this.#Tt?this:void 0}readlinkCached(){return this.#kt}realpathCached(){return this.#Ct}readdirCached(){const t=this.children();return t.slice(0,t.provisional)}canReadlink(){if(this.#kt)return!0;if(!this.parent)return!1;const t=this.#Tt&ye;return!(0!==t&&t!==Re||256&this.#Tt||this.#Tt&Ie)}calledReaddir(){return!!(16&this.#Tt)}isENOENT(){return!!(this.#Tt&Ie)}isNamed(t){return this.nocase?this.#Rt===ke(t):this.#Rt===Te(t)}async readlink(){const t=this.#kt;if(t)return t;if(this.canReadlink()&&this.parent)try{const t=await this.#rt.promises.readlink(this.fullpath()),e=(await this.parent.realpath())?.resolve(t);if(e)return this.#kt=e}catch(t){return void this.#Lt(t.code)}}readlinkSync(){const t=this.#kt;if(t)return t;if(this.canReadlink()&&this.parent)try{const t=this.#rt.readlinkSync(this.fullpath()),e=this.parent.realpathSync()?.resolve(t);if(e)return this.#kt=e}catch(t){return void this.#Lt(t.code)}}#xt(t){this.#Tt|=16;for(let e=t.provisional;e<t.length;e++){const s=t[e];s&&s.#Nt()}}#Nt(){this.#Tt&Ie||(this.#Tt=(this.#Tt|Ie)&_e,this.#Pt())}#Pt(){const t=this.children();t.provisional=0;for(const e of t)e.#Nt()}#Dt(){this.#Tt|=512,this.#Bt()}#Bt(){if(64&this.#Tt)return;let t=this.#Tt;4==(t&ye)&&(t&=_e),this.#Tt=64|t,this.#Pt()}#Mt(t=""){"ENOTDIR"===t||"EPERM"===t?this.#Bt():"ENOENT"===t?this.#Nt():this.children().provisional=0}#Ft(t=""){"ENOTDIR"===t?this.parent.#Bt():"ENOENT"===t&&this.#Nt()}#Lt(t=""){let e=this.#Tt;e|=256,"ENOENT"===t&&(e|=Ie),"EINVAL"!==t&&"UNKNOWN"!==t||(e&=_e),this.#Tt=e,"ENOTDIR"===t&&this.parent&&this.parent.#Bt()}#Ut(t,e){return this.#Vt(t,e)||this.#Ht(t,e)}#Ht(t,e){const s=be(t),r=this.newChild(t.name,s,{parent:this}),i=r.#Tt&ye;return 4!==i&&i!==Re&&0!==i&&(r.#Tt|=64),e.unshift(r),e.provisional++,r}#Vt(t,e){for(let s=e.provisional;s<e.length;s++){const r=e[s];if((this.nocase?ke(t.name):Te(t.name))===r.#Rt)return this.#jt(t,r,s,e)}}#jt(t,e,s,r){const i=e.name;return e.#Tt=e.#Tt&_e|be(t),i!==t.name&&(e.name=t.name),s!==r.provisional&&(s===r.length-1?r.pop():r.splice(s,1),r.unshift(e)),r.provisional++,e}async lstat(){if(!(this.#Tt&Ie))try{return this.#Gt(await this.#rt.promises.lstat(this.fullpath())),this}catch(t){this.#Ft(t.code)}}lstatSync(){if(!(this.#Tt&Ie))try{return this.#Gt(this.#rt.lstatSync(this.fullpath())),this}catch(t){this.#Ft(t.code)}}#Gt(t){const{atime:e,atimeMs:s,birthtime:r,birthtimeMs:i,blksize:n,blocks:o,ctime:a,ctimeMs:h,dev:l,gid:c,ino:u,mode:d,mtime:p,mtimeMs:f,nlink:m,rdev:g,size:E,uid:S}=t;this.#Et=e,this.#pt=s,this.#vt=r,this.#gt=i,this.#ct=n,this.#dt=o,this.#wt=a,this.#mt=h,this.#it=l,this.#ht=c,this.#ut=u,this.#nt=d,this.#St=p,this.#ft=f,this.#ot=m,this.#lt=g,this.#R=E,this.#at=S;const w=be(t);this.#Tt=this.#Tt&_e|w|32,0!==w&&4!==w&&w!==Re&&(this.#Tt|=64)}#zt=[];#Wt=!1;#Xt(t){this.#Wt=!1;const e=this.#zt.slice();this.#zt.length=0,e.forEach((e=>e(null,t)))}readdirCB(t,e=!1){if(!this.canReaddir())return void(e?t(null,[]):queueMicrotask((()=>t(null,[]))));const s=this.children();if(this.calledReaddir()){const r=s.slice(0,s.provisional);return void(e?t(null,r):queueMicrotask((()=>t(null,r))))}if(this.#zt.push(t),this.#Wt)return;this.#Wt=!0;const r=this.fullpath();this.#rt.readdir(r,{withFileTypes:!0},((t,e)=>{if(t)this.#Mt(t.code),s.provisional=0;else{for(const t of e)this.#Ut(t,s);this.#xt(s)}this.#Xt(s.slice(0,s.provisional))}))}#Kt;async readdir(){if(!this.canReaddir())return[];const t=this.children();if(this.calledReaddir())return t.slice(0,t.provisional);const e=this.fullpath();if(this.#Kt)await this.#Kt;else{let s=()=>{};this.#Kt=new Promise((t=>s=t));try{for(const s of await this.#rt.promises.readdir(e,{withFileTypes:!0}))this.#Ut(s,t);this.#xt(t)}catch(e){this.#Mt(e.code),t.provisional=0}this.#Kt=void 0,s()}return t.slice(0,t.provisional)}readdirSync(){if(!this.canReaddir())return[];const t=this.children();if(this.calledReaddir())return t.slice(0,t.provisional);const e=this.fullpath();try{for(const s of this.#rt.readdirSync(e,{withFileTypes:!0}))this.#Ut(s,t);this.#xt(t)}catch(e){this.#Mt(e.code),t.provisional=0}return t.slice(0,t.provisional)}canReaddir(){if(704&this.#Tt)return!1;const t=ye&this.#Tt;return 0===t||4===t||t===Re}shouldWalk(t,e){return!(4&~this.#Tt)&&!(704&this.#Tt)&&!t.has(this)&&(!e||e(this))}async realpath(){if(this.#Ct)return this.#Ct;if(!(896&this.#Tt))try{const t=await this.#rt.promises.realpath(this.fullpath());return this.#Ct=this.resolve(t)}catch(t){this.#Dt()}}realpathSync(){if(this.#Ct)return this.#Ct;if(!(896&this.#Tt))try{const t=this.#rt.realpathSync(this.fullpath());return this.#Ct=this.resolve(t)}catch(t){this.#Dt()}}[Le](t){if(t===this)return;t.isCWD=!1,this.isCWD=!0;const e=new Set([]);let s=[],r=this;for(;r&&r.parent;)e.add(r),r.#bt=s.join(this.sep),r.#$t=s.join("/"),r=r.parent,s.push("..");for(r=t;r&&r.parent&&!e.has(r);)r.#bt=void 0,r.#$t=void 0,r=r.parent}}class Ne extends xe{sep="\\";splitSep=ve;constructor(t,e=0,s,r,i,n,o){super(t,e,s,r,i,n,o)}newChild(t,e=0,s={}){return new Ne(t,e,this.root,this.roots,this.nocase,this.childrenCache(),s)}getRootString(t){return yt.win32.parse(t).root}getRoot(t){if((t=(t=>t.replace(/\//g,"\\").replace(we,"$1\\"))(t.toUpperCase()))===this.root.name)return this.root;for(const[e,s]of Object.entries(this.roots))if(this.sameRoot(t,e))return this.roots[t]=s;return this.roots[t]=new Be(t,this).root}sameRoot(t,e=this.root.name){return(t=t.toUpperCase().replace(/\//g,"\\").replace(we,"$1\\"))===e}}class Pe extends xe{splitSep="/";sep="/";constructor(t,e=0,s,r,i,n,o){super(t,e,s,r,i,n,o)}getRootString(t){return t.startsWith("/")?"/":""}getRoot(t){return this.root}newChild(t,e=0,s={}){return new Pe(t,e,this.root,this.roots,this.nocase,this.childrenCache(),s)}}class De{root;rootPath;roots;cwd;#qt;#Yt;#Ot;nocase;#rt;constructor(t=process.cwd(),e,s,{nocase:r,childrenCacheSize:i=16384,fs:n=Ee}={}){this.#rt=Se(n),(t instanceof URL||t.startsWith("file://"))&&(t=(0,_t.fileURLToPath)(t));const o=e.resolve(t);this.roots=Object.create(null),this.rootPath=this.parseRootPath(o),this.#qt=new Ce,this.#Yt=new Ce,this.#Ot=new Ae(i);const a=o.substring(this.rootPath.length).split(s);if(1!==a.length||a[0]||a.pop(),void 0===r)throw new TypeError("must provide nocase setting to PathScurryBase ctor");this.nocase=r,this.root=this.newRoot(this.#rt),this.roots[this.rootPath]=this.root;let h=this.root,l=a.length-1;const c=e.sep;let u=this.rootPath,d=!1;for(const t of a){const e=l--;h=h.child(t,{relative:new Array(e).fill("..").join(c),relativePosix:new Array(e).fill("..").join("/"),fullpath:u+=(d?"":c)+t}),d=!0}this.cwd=h}depth(t=this.cwd){return"string"==typeof t&&(t=this.cwd.resolve(t)),t.depth()}childrenCache(){return this.#Ot}resolve(...t){let e="";for(let s=t.length-1;s>=0;s--){const r=t[s];if(r&&"."!==r&&(e=e?`${r}/${e}`:r,this.isAbsolute(r)))break}const s=this.#qt.get(e);if(void 0!==s)return s;const r=this.cwd.resolve(e).fullpath();return this.#qt.set(e,r),r}resolvePosix(...t){let e="";for(let s=t.length-1;s>=0;s--){const r=t[s];if(r&&"."!==r&&(e=e?`${r}/${e}`:r,this.isAbsolute(r)))break}const s=this.#Yt.get(e);if(void 0!==s)return s;const r=this.cwd.resolve(e).fullpathPosix();return this.#Yt.set(e,r),r}relative(t=this.cwd){return"string"==typeof t&&(t=this.cwd.resolve(t)),t.relative()}relativePosix(t=this.cwd){return"string"==typeof t&&(t=this.cwd.resolve(t)),t.relativePosix()}basename(t=this.cwd){return"string"==typeof t&&(t=this.cwd.resolve(t)),t.name}dirname(t=this.cwd){return"string"==typeof t&&(t=this.cwd.resolve(t)),(t.parent||t).fullpath()}async readdir(t=this.cwd,e={withFileTypes:!0}){"string"==typeof t?t=this.cwd.resolve(t):t instanceof xe||(e=t,t=this.cwd);const{withFileTypes:s}=e;if(t.canReaddir()){const e=await t.readdir();return s?e:e.map((t=>t.name))}return[]}readdirSync(t=this.cwd,e={withFileTypes:!0}){"string"==typeof t?t=this.cwd.resolve(t):t instanceof xe||(e=t,t=this.cwd);const{withFileTypes:s=!0}=e;return t.canReaddir()?s?t.readdirSync():t.readdirSync().map((t=>t.name)):[]}async lstat(t=this.cwd){return"string"==typeof t&&(t=this.cwd.resolve(t)),t.lstat()}lstatSync(t=this.cwd){return"string"==typeof t&&(t=this.cwd.resolve(t)),t.lstatSync()}async readlink(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){"string"==typeof t?t=this.cwd.resolve(t):t instanceof xe||(e=t.withFileTypes,t=this.cwd);const s=await t.readlink();return e?s:s?.fullpath()}readlinkSync(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){"string"==typeof t?t=this.cwd.resolve(t):t instanceof xe||(e=t.withFileTypes,t=this.cwd);const s=t.readlinkSync();return e?s:s?.fullpath()}async realpath(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){"string"==typeof t?t=this.cwd.resolve(t):t instanceof xe||(e=t.withFileTypes,t=this.cwd);const s=await t.realpath();return e?s:s?.fullpath()}realpathSync(t=this.cwd,{withFileTypes:e}={withFileTypes:!1}){"string"==typeof t?t=this.cwd.resolve(t):t instanceof xe||(e=t.withFileTypes,t=this.cwd);const s=t.realpathSync();return e?s:s?.fullpath()}async walk(t=this.cwd,e={}){"string"==typeof t?t=this.cwd.resolve(t):t instanceof xe||(e=t,t=this.cwd);const{withFileTypes:s=!0,follow:r=!1,filter:i,walkFilter:n}=e,o=[];i&&!i(t)||o.push(s?t:t.fullpath());const a=new Set,h=(t,e)=>{a.add(t),t.readdirCB(((t,l)=>{if(t)return e(t);let c=l.length;if(!c)return e();const u=()=>{0==--c&&e()};for(const t of l)i&&!i(t)||o.push(s?t:t.fullpath()),r&&t.isSymbolicLink()?t.realpath().then((t=>t?.isUnknown()?t.lstat():t)).then((t=>t?.shouldWalk(a,n)?h(t,u):u())):t.shouldWalk(a,n)?h(t,u):u()}),!0)},l=t;return new Promise(((t,e)=>{h(l,(s=>{if(s)return e(s);t(o)}))}))}walkSync(t=this.cwd,e={}){"string"==typeof t?t=this.cwd.resolve(t):t instanceof xe||(e=t,t=this.cwd);const{withFileTypes:s=!0,follow:r=!1,filter:i,walkFilter:n}=e,o=[];i&&!i(t)||o.push(s?t:t.fullpath());const a=new Set([t]);for(const t of a){const e=t.readdirSync();for(const t of e){i&&!i(t)||o.push(s?t:t.fullpath());let e=t;if(t.isSymbolicLink()){if(!r||!(e=t.realpathSync()))continue;e.isUnknown()&&e.lstatSync()}e.shouldWalk(a,n)&&a.add(e)}}return o}[Symbol.asyncIterator](){return this.iterate()}iterate(t=this.cwd,e={}){return"string"==typeof t?t=this.cwd.resolve(t):t instanceof xe||(e=t,t=this.cwd),this.stream(t,e)[Symbol.asyncIterator]()}[Symbol.iterator](){return this.iterateSync()}*iterateSync(t=this.cwd,e={}){"string"==typeof t?t=this.cwd.resolve(t):t instanceof xe||(e=t,t=this.cwd);const{withFileTypes:s=!0,follow:r=!1,filter:i,walkFilter:n}=e;i&&!i(t)||(yield s?t:t.fullpath());const o=new Set([t]);for(const t of o){const e=t.readdirSync();for(const t of e){i&&!i(t)||(yield s?t:t.fullpath());let e=t;if(t.isSymbolicLink()){if(!r||!(e=t.realpathSync()))continue;e.isUnknown()&&e.lstatSync()}e.shouldWalk(o,n)&&o.add(e)}}}stream(t=this.cwd,e={}){"string"==typeof t?t=this.cwd.resolve(t):t instanceof xe||(e=t,t=this.cwd);const{withFileTypes:s=!0,follow:r=!1,filter:i,walkFilter:n}=e,o=new me({objectMode:!0});i&&!i(t)||o.write(s?t:t.fullpath());const a=new Set,h=[t];let l=0;const c=()=>{let t=!1;for(;!t;){const e=h.shift();if(!e)return void(0===l&&o.end());l++,a.add(e);const u=(e,p,f=!1)=>{if(e)return o.emit("error",e);if(r&&!f){const t=[];for(const e of p)e.isSymbolicLink()&&t.push(e.realpath().then((t=>t?.isUnknown()?t.lstat():t)));if(t.length)return void Promise.all(t).then((()=>u(null,p,!0)))}for(const e of p)!e||i&&!i(e)||o.write(s?e:e.fullpath())||(t=!0);l--;for(const t of p){const e=t.realpathCached()||t;e.shouldWalk(a,n)&&h.push(e)}t&&!o.flowing?o.once("drain",c):d||c()};let d=!0;e.readdirCB(u,!0),d=!1}};return c(),o}streamSync(t=this.cwd,e={}){"string"==typeof t?t=this.cwd.resolve(t):t instanceof xe||(e=t,t=this.cwd);const{withFileTypes:s=!0,follow:r=!1,filter:i,walkFilter:n}=e,o=new me({objectMode:!0}),a=new Set;i&&!i(t)||o.write(s?t:t.fullpath());const h=[t];let l=0;const c=()=>{let t=!1;for(;!t;){const e=h.shift();if(!e)return void(0===l&&o.end());l++,a.add(e);const c=e.readdirSync();for(const e of c)i&&!i(e)||o.write(s?e:e.fullpath())||(t=!0);l--;for(const t of c){let e=t;if(t.isSymbolicLink()){if(!r||!(e=t.realpathSync()))continue;e.isUnknown()&&e.lstatSync()}e.shouldWalk(a,n)&&h.push(e)}}t&&!o.flowing&&o.once("drain",c)};return c(),o}chdir(t=this.cwd){const e=this.cwd;this.cwd="string"==typeof t?this.cwd.resolve(t):t,this.cwd[Le](e)}}class Be extends De{sep="\\";constructor(t=process.cwd(),e={}){const{nocase:s=!0}=e;super(t,yt.win32,"\\",{...e,nocase:s}),this.nocase=s;for(let t=this.cwd;t;t=t.parent)t.nocase=this.nocase}parseRootPath(t){return yt.win32.parse(t).root.toUpperCase()}newRoot(t){return new Ne(this.rootPath,4,void 0,this.roots,this.nocase,this.childrenCache(),{fs:t})}isAbsolute(t){return t.startsWith("/")||t.startsWith("\\")||/^[a-z]:(\/|\\)/i.test(t)}}class Me extends De{sep="/";constructor(t=process.cwd(),e={}){const{nocase:s=!1}=e;super(t,yt.posix,"/",{...e,nocase:s}),this.nocase=s}parseRootPath(t){return"/"}newRoot(t){return new Pe(this.rootPath,4,void 0,this.roots,this.nocase,this.childrenCache(),{fs:t})}isAbsolute(t){return t.startsWith("/")}}class Fe extends Me{constructor(t=process.cwd(),e={}){const{nocase:s=!0}=e;super(t,{...e,nocase:s})}}process.platform;const Ue="win32"===process.platform?Be:"darwin"===process.platform?Fe:Me,Ve=require("url");class He{#Zt;#Jt;#Qt;length;#te;#ee;#se;#re;#ie;#ne;#oe=!0;constructor(t,e,s,r){if(!(t.length>=1))throw new TypeError("empty pattern list");if(!(e.length>=1))throw new TypeError("empty glob list");if(e.length!==t.length)throw new TypeError("mismatched pattern list and glob list lengths");if(this.length=t.length,s<0||s>=this.length)throw new TypeError("index out of range");if(this.#Zt=t,this.#Jt=e,this.#Qt=s,this.#te=r,0===this.#Qt)if(this.isUNC()){const[t,e,s,r,...i]=this.#Zt,[n,o,a,h,...l]=this.#Jt;""===i[0]&&(i.shift(),l.shift());const c=[t,e,s,r,""].join("/"),u=[n,o,a,h,""].join("/");this.#Zt=[c,...i],this.#Jt=[u,...l],this.length=this.#Zt.length}else if(this.isDrive()||this.isAbsolute()){const[t,...e]=this.#Zt,[s,...r]=this.#Jt;""===e[0]&&(e.shift(),r.shift());const i=t+"/",n=s+"/";this.#Zt=[i,...e],this.#Jt=[n,...r],this.length=this.#Zt.length}}pattern(){return this.#Zt[this.#Qt]}isString(){return"string"==typeof this.#Zt[this.#Qt]}isGlobstar(){return this.#Zt[this.#Qt]===ot}isRegExp(){return this.#Zt[this.#Qt]instanceof RegExp}globString(){return this.#se=this.#se||(0===this.#Qt?this.isAbsolute()?this.#Jt[0]+this.#Jt.slice(1).join("/"):this.#Jt.join("/"):this.#Jt.slice(this.#Qt).join("/"))}hasMore(){return this.length>this.#Qt+1}rest(){return void 0!==this.#ee?this.#ee:this.hasMore()?(this.#ee=new He(this.#Zt,this.#Jt,this.#Qt+1,this.#te),this.#ee.#ne=this.#ne,this.#ee.#ie=this.#ie,this.#ee.#re=this.#re,this.#ee):this.#ee=null}isUNC(){const t=this.#Zt;return void 0!==this.#ie?this.#ie:this.#ie="win32"===this.#te&&0===this.#Qt&&""===t[0]&&""===t[1]&&"string"==typeof t[2]&&!!t[2]&&"string"==typeof t[3]&&!!t[3]}isDrive(){const t=this.#Zt;return void 0!==this.#re?this.#re:this.#re="win32"===this.#te&&0===this.#Qt&&this.length>1&&"string"==typeof t[0]&&/^[a-z]:$/i.test(t[0])}isAbsolute(){const t=this.#Zt;return void 0!==this.#ne?this.#ne:this.#ne=""===t[0]&&t.length>1||this.isDrive()||this.isUNC()}root(){const t=this.#Zt[0];return"string"==typeof t&&this.isAbsolute()&&0===this.#Qt?t:""}checkFollowGlobstar(){return!(0===this.#Qt||!this.isGlobstar()||!this.#oe)}markFollowGlobstar(){return!(0===this.#Qt||!this.isGlobstar()||!this.#oe||(this.#oe=!1,0))}}var je=i(4434),Ge=i(2203),ze=i(3193);const We="object"==typeof process&&process?process:{stdout:null,stderr:null},Xe=ze.StringDecoder,Ke=Symbol("EOF"),qe=Symbol("maybeEmitEnd"),Ye=Symbol("emittedEnd"),Ze=Symbol("emittingEnd"),Je=Symbol("emittedError"),Qe=Symbol("closed"),ts=Symbol("read"),es=Symbol("flush"),ss=Symbol("flushChunk"),rs=Symbol("encoding"),is=Symbol("decoder"),ns=Symbol("flowing"),os=Symbol("paused"),as=Symbol("resume"),hs=Symbol("buffer"),ls=Symbol("pipes"),cs=Symbol("bufferLength"),us=Symbol("bufferPush"),ds=Symbol("bufferShift"),ps=Symbol("objectMode"),fs=Symbol("destroyed"),ms=Symbol("error"),gs=Symbol("emitData"),Es=Symbol("emitEnd"),Ss=Symbol("emitEnd2"),ws=Symbol("async"),vs=Symbol("abort"),Rs=Symbol("aborted"),ys=Symbol("signal"),_s=t=>Promise.resolve().then(t),Is="1"!==global._MP_NO_ITERATOR_SYMBOLS_,bs=Is&&Symbol.asyncIterator||Symbol("asyncIterator not implemented"),$s=Is&&Symbol.iterator||Symbol("iterator not implemented");class Ts{constructor(t,e,s){this.src=t,this.dest=e,this.opts=s,this.ondrain=()=>t[as](),e.on("drain",this.ondrain)}unpipe(){this.dest.removeListener("drain",this.ondrain)}proxyErrors(){}end(){this.unpipe(),this.opts.end&&this.dest.end()}}class Os extends Ts{unpipe(){this.src.removeListener("error",this.proxyErrors),super.unpipe()}constructor(t,e,s){super(t,e,s),this.proxyErrors=t=>e.emit("error",t),t.on("error",this.proxyErrors)}}class ks extends Ge{constructor(t){super(),this[ns]=!1,this[os]=!1,this[ls]=[],this[hs]=[],this[ps]=t&&t.objectMode||!1,this[ps]?this[rs]=null:this[rs]=t&&t.encoding||null,"buffer"===this[rs]&&(this[rs]=null),this[ws]=t&&!!t.async||!1,this[is]=this[rs]?new Xe(this[rs]):null,this[Ke]=!1,this[Ye]=!1,this[Ze]=!1,this[Qe]=!1,this[Je]=null,this.writable=!0,this.readable=!0,this[cs]=0,this[fs]=!1,t&&!0===t.debugExposeBuffer&&Object.defineProperty(this,"buffer",{get:()=>this[hs]}),t&&!0===t.debugExposePipes&&Object.defineProperty(this,"pipes",{get:()=>this[ls]}),this[ys]=t&&t.signal,this[Rs]=!1,this[ys]&&(this[ys].addEventListener("abort",(()=>this[vs]())),this[ys].aborted&&this[vs]())}get bufferLength(){return this[cs]}get encoding(){return this[rs]}set encoding(t){if(this[ps])throw new Error("cannot set encoding in objectMode");if(this[rs]&&t!==this[rs]&&(this[is]&&this[is].lastNeed||this[cs]))throw new Error("cannot change encoding");this[rs]!==t&&(this[is]=t?new Xe(t):null,this[hs].length&&(this[hs]=this[hs].map((t=>this[is].write(t))))),this[rs]=t}setEncoding(t){this.encoding=t}get objectMode(){return this[ps]}set objectMode(t){this[ps]=this[ps]||!!t}get async(){return this[ws]}set async(t){this[ws]=this[ws]||!!t}[vs](){this[Rs]=!0,this.emit("abort",this[ys].reason),this.destroy(this[ys].reason)}get aborted(){return this[Rs]}set aborted(t){}write(t,e,s){if(this[Rs])return!1;if(this[Ke])throw new Error("write after end");if(this[fs])return this.emit("error",Object.assign(new Error("Cannot call write after a stream was destroyed"),{code:"ERR_STREAM_DESTROYED"})),!0;"function"==typeof e&&(s=e,e="utf8"),e||(e="utf8");const r=this[ws]?_s:t=>t();var i;return this[ps]||Buffer.isBuffer(t)||(i=t,!Buffer.isBuffer(i)&&ArrayBuffer.isView(i)?t=Buffer.from(t.buffer,t.byteOffset,t.byteLength):(t=>t instanceof ArrayBuffer||"object"==typeof t&&t.constructor&&"ArrayBuffer"===t.constructor.name&&t.byteLength>=0)(t)?t=Buffer.from(t):"string"!=typeof t&&(this.objectMode=!0)),this[ps]?(this.flowing&&0!==this[cs]&&this[es](!0),this.flowing?this.emit("data",t):this[us](t),0!==this[cs]&&this.emit("readable"),s&&r(s),this.flowing):t.length?("string"!=typeof t||e===this[rs]&&!this[is].lastNeed||(t=Buffer.from(t,e)),Buffer.isBuffer(t)&&this[rs]&&(t=this[is].write(t)),this.flowing&&0!==this[cs]&&this[es](!0),this.flowing?this.emit("data",t):this[us](t),0!==this[cs]&&this.emit("readable"),s&&r(s),this.flowing):(0!==this[cs]&&this.emit("readable"),s&&r(s),this.flowing)}read(t){if(this[fs])return null;if(0===this[cs]||0===t||t>this[cs])return this[qe](),null;this[ps]&&(t=null),this[hs].length>1&&!this[ps]&&(this.encoding?this[hs]=[this[hs].join("")]:this[hs]=[Buffer.concat(this[hs],this[cs])]);const e=this[ts](t||null,this[hs][0]);return this[qe](),e}[ts](t,e){return t===e.length||null===t?this[ds]():(this[hs][0]=e.slice(t),e=e.slice(0,t),this[cs]-=t),this.emit("data",e),this[hs].length||this[Ke]||this.emit("drain"),e}end(t,e,s){return"function"==typeof t&&(s=t,t=null),"function"==typeof e&&(s=e,e="utf8"),t&&this.write(t,e),s&&this.once("end",s),this[Ke]=!0,this.writable=!1,!this.flowing&&this[os]||this[qe](),this}[as](){this[fs]||(this[os]=!1,this[ns]=!0,this.emit("resume"),this[hs].length?this[es]():this[Ke]?this[qe]():this.emit("drain"))}resume(){return this[as]()}pause(){this[ns]=!1,this[os]=!0}get destroyed(){return this[fs]}get flowing(){return this[ns]}get paused(){return this[os]}[us](t){this[ps]?this[cs]+=1:this[cs]+=t.length,this[hs].push(t)}[ds](){return this[ps]?this[cs]-=1:this[cs]-=this[hs][0].length,this[hs].shift()}[es](t){do{}while(this[ss](this[ds]())&&this[hs].length);t||this[hs].length||this[Ke]||this.emit("drain")}[ss](t){return this.emit("data",t),this.flowing}pipe(t,e){if(this[fs])return;const s=this[Ye];return e=e||{},t===We.stdout||t===We.stderr?e.end=!1:e.end=!1!==e.end,e.proxyErrors=!!e.proxyErrors,s?e.end&&t.end():(this[ls].push(e.proxyErrors?new Os(this,t,e):new Ts(this,t,e)),this[ws]?_s((()=>this[as]())):this[as]()),t}unpipe(t){const e=this[ls].find((e=>e.dest===t));e&&(this[ls].splice(this[ls].indexOf(e),1),e.unpipe())}addListener(t,e){return this.on(t,e)}on(t,e){const s=super.on(t,e);return"data"!==t||this[ls].length||this.flowing?"readable"===t&&0!==this[cs]?super.emit("readable"):(t=>"end"===t||"finish"===t||"prefinish"===t)(t)&&this[Ye]?(super.emit(t),this.removeAllListeners(t)):"error"===t&&this[Je]&&(this[ws]?_s((()=>e.call(this,this[Je]))):e.call(this,this[Je])):this[as](),s}get emittedEnd(){return this[Ye]}[qe](){this[Ze]||this[Ye]||this[fs]||0!==this[hs].length||!this[Ke]||(this[Ze]=!0,this.emit("end"),this.emit("prefinish"),this.emit("finish"),this[Qe]&&this.emit("close"),this[Ze]=!1)}emit(t,e,...s){if("error"!==t&&"close"!==t&&t!==fs&&this[fs])return;if("data"===t)return!(!this[ps]&&!e)&&(this[ws]?_s((()=>this[gs](e))):this[gs](e));if("end"===t)return this[Es]();if("close"===t){if(this[Qe]=!0,!this[Ye]&&!this[fs])return;const t=super.emit("close");return this.removeAllListeners("close"),t}if("error"===t){this[Je]=e,super.emit(ms,e);const t=!(this[ys]&&!this.listeners("error").length)&&super.emit("error",e);return this[qe](),t}if("resume"===t){const t=super.emit("resume");return this[qe](),t}if("finish"===t||"prefinish"===t){const e=super.emit(t);return this.removeAllListeners(t),e}const r=super.emit(t,e,...s);return this[qe](),r}[gs](t){for(const e of this[ls])!1===e.dest.write(t)&&this.pause();const e=super.emit("data",t);return this[qe](),e}[Es](){this[Ye]||(this[Ye]=!0,this.readable=!1,this[ws]?_s((()=>this[Ss]())):this[Ss]())}[Ss](){if(this[is]){const t=this[is].end();if(t){for(const e of this[ls])e.dest.write(t);super.emit("data",t)}}for(const t of this[ls])t.end();const t=super.emit("end");return this.removeAllListeners("end"),t}collect(){const t=[];this[ps]||(t.dataLength=0);const e=this.promise();return this.on("data",(e=>{t.push(e),this[ps]||(t.dataLength+=e.length)})),e.then((()=>t))}concat(){return this[ps]?Promise.reject(new Error("cannot concat in objectMode")):this.collect().then((t=>this[ps]?Promise.reject(new Error("cannot concat in objectMode")):this[rs]?t.join(""):Buffer.concat(t,t.dataLength)))}promise(){return new Promise(((t,e)=>{this.on(fs,(()=>e(new Error("stream destroyed")))),this.on("error",(t=>e(t))),this.on("end",(()=>t()))}))}[bs](){let t=!1;const e=()=>(this.pause(),t=!0,Promise.resolve({done:!0}));return{next:()=>{if(t)return e();const s=this.read();if(null!==s)return Promise.resolve({done:!1,value:s});if(this[Ke])return e();let r=null,i=null;const n=t=>{this.removeListener("data",o),this.removeListener("end",a),this.removeListener(fs,h),e(),i(t)},o=t=>{this.removeListener("error",n),this.removeListener("end",a),this.removeListener(fs,h),this.pause(),r({value:t,done:!!this[Ke]})},a=()=>{this.removeListener("error",n),this.removeListener("data",o),this.removeListener(fs,h),e(),r({done:!0})},h=()=>n(new Error("stream destroyed"));return new Promise(((t,e)=>{i=e,r=t,this.once(fs,h),this.once("error",n),this.once("end",a),this.once("data",o)}))},throw:e,return:e,[bs](){return this}}}[$s](){let t=!1;const e=()=>(this.pause(),this.removeListener(ms,e),this.removeListener(fs,e),this.removeListener("end",e),t=!0,{done:!0});return this.once("end",e),this.once(ms,e),this.once(fs,e),{next:()=>{if(t)return e();const s=this.read();return null===s?e():{value:s}},throw:e,return:e,[$s](){return this}}}destroy(t){return this[fs]?(t?this.emit("error",t):this.emit(fs),this):(this[fs]=!0,this[hs].length=0,this[cs]=0,"function"!=typeof this.close||this[Qe]||this.close(),t?this.emit("error",t):this.emit(fs),this)}static isStream(t){return!!t&&(t instanceof ks||t instanceof Ge||t instanceof je&&("function"==typeof t.pipe||"function"==typeof t.write&&"function"==typeof t.end))}}const Cs=ks,As="object"==typeof process&&process&&"string"==typeof process.platform?process.platform:"linux";class Ls{relative;relativeChildren;absolute;absoluteChildren;constructor(t,{nobrace:e,nocase:s,noext:r,noglobstar:i,platform:n=As}){this.relative=[],this.absolute=[],this.relativeChildren=[],this.absoluteChildren=[];const o={dot:!0,nobrace:e,nocase:s,noext:r,noglobstar:i,optimizationLevel:2,platform:n,nocomment:!0,nonegate:!0};for(const e of t){const t=new ct(e,o);for(let e=0;e<t.set.length;e++){const s=t.set[e],r=t.globParts[e],i=new He(s,r,0,n),a=new ct(i.globString(),o),h="**"===r[r.length-1],l=i.isAbsolute();l?this.absolute.push(a):this.relative.push(a),h&&(l?this.absoluteChildren.push(a):this.relativeChildren.push(a))}}}ignored(t){const e=t.fullpath(),s=`${e}/`,r=t.relative()||".",i=`${r}/`;for(const t of this.relative)if(t.match(r)||t.match(i))return!0;for(const t of this.absolute)if(t.match(e)||t.match(s))return!0;return!1}childrenIgnored(t){const e=t.fullpath()+"/",s=(t.relative()||".")+"/";for(const t of this.relativeChildren)if(t.match(s))return!0;for(const t of this.absoluteChildren)t.match(e);return!1}}class xs{store;constructor(t=new Map){this.store=t}copy(){return new xs(new Map(this.store))}hasWalked(t,e){return this.store.get(t.fullpath())?.has(e.globString())}storeWalked(t,e){const s=t.fullpath(),r=this.store.get(s);r?r.add(e.globString()):this.store.set(s,new Set([e.globString()]))}}class Ns{store=new Map;add(t,e,s){const r=(e?2:0)|(s?1:0),i=this.store.get(t);this.store.set(t,void 0===i?r:r&i)}entries(){return[...this.store.entries()].map((([t,e])=>[t,!!(2&e),!!(1&e)]))}}class Ps{store=new Map;add(t,e){if(!t.canReaddir())return;const s=this.store.get(t);s?s.find((t=>t.globString()===e.globString()))||s.push(e):this.store.set(t,[e])}get(t){const e=this.store.get(t);if(!e)throw new Error("attempting to walk unknown path");return e}entries(){return this.keys().map((t=>[t,this.store.get(t)]))}keys(){return[...this.store.keys()].filter((t=>t.canReaddir()))}}class Ds{hasWalkedCache;matches=new Ns;subwalks=new Ps;patterns;follow;dot;opts;constructor(t,e){this.opts=t,this.follow=!!t.follow,this.dot=!!t.dot,this.hasWalkedCache=e?e.copy():new xs}processPatterns(t,e){this.patterns=e;const s=e.map((e=>[t,e]));for(let[t,e]of s){this.hasWalkedCache.storeWalked(t,e);const s=e.root(),r=e.isAbsolute()&&!1!==this.opts.absolute;if(s){t=t.resolve("/"===s&&void 0!==this.opts.root?this.opts.root:s);const r=e.rest();if(!r){this.matches.add(t,!0,!1);continue}e=r}if(t.isENOENT())continue;let i,n,o=!1;for(;"string"==typeof(i=e.pattern())&&(n=e.rest());){const s=t.resolve(i);if(s.isUnknown()&&".."!==i)break;t=s,e=n,o=!0}if(i=e.pattern(),n=e.rest(),o){if(this.hasWalkedCache.hasWalked(t,e))continue;this.hasWalkedCache.storeWalked(t,e)}if("string"!=typeof i)if(i===ot){(!t.isSymbolicLink()||this.follow||e.checkFollowGlobstar())&&this.subwalks.add(t,e);const s=n?.pattern(),i=n?.rest();if(n&&(""!==s&&"."!==s||i)){if(".."===s){const e=t.parent||t;i?this.hasWalkedCache.hasWalked(e,i)||this.subwalks.add(e,i):this.matches.add(e,r,!0)}}else this.matches.add(t,r,""===s||"."===s)}else i instanceof RegExp&&this.subwalks.add(t,e);else if(n)this.subwalks.add(t,e);else{const e=".."===i||""===i||"."===i;this.matches.add(t.resolve(i),r,e)}}return this}subwalkTargets(){return this.subwalks.keys()}child(){return new Ds(this.opts,this.hasWalkedCache)}filterEntries(t,e){const s=this.subwalks.get(t),r=this.child();for(const t of e)for(const e of s){const s=e.isAbsolute(),i=e.pattern(),n=e.rest();i===ot?r.testGlobstar(t,e,n,s):i instanceof RegExp?r.testRegExp(t,i,n,s):r.testString(t,i,n,s)}return r}testGlobstar(t,e,s,r){if(!this.dot&&t.name.startsWith(".")||(e.hasMore()||this.matches.add(t,r,!1),t.canReaddir()&&(this.follow||!t.isSymbolicLink()?this.subwalks.add(t,e):t.isSymbolicLink()&&(s&&e.checkFollowGlobstar()?this.subwalks.add(t,s):e.markFollowGlobstar()&&this.subwalks.add(t,e)))),s){const e=s.pattern();if("string"==typeof e&&".."!==e&&""!==e&&"."!==e)this.testString(t,e,s.rest(),r);else if(".."===e){const e=t.parent||t;this.subwalks.add(e,s)}else e instanceof RegExp&&this.testRegExp(t,e,s.rest(),r)}}testRegExp(t,e,s,r){e.test(t.name)&&(s?this.subwalks.add(t,s):this.matches.add(t,r,!1))}testString(t,e,s,r){t.isNamed(e)&&(s?this.subwalks.add(t,s):this.matches.add(t,r,!1))}}class Bs{path;patterns;opts;seen=new Set;paused=!1;aborted=!1;#ae=[];#he;#le;signal;maxDepth;constructor(t,e,s){this.patterns=t,this.path=e,this.opts=s,this.#le="win32"===s.platform?"\\":"/",s.ignore&&(this.#he=((t,e)=>"string"==typeof t?new Ls([t],e):Array.isArray(t)?new Ls(t,e):t)(s.ignore,s)),this.maxDepth=s.maxDepth||1/0,s.signal&&(this.signal=s.signal,this.signal.addEventListener("abort",(()=>{this.#ae.length=0})))}#ce(t){return this.seen.has(t)||!!this.#he?.ignored?.(t)}#ue(t){return!!this.#he?.childrenIgnored?.(t)}pause(){this.paused=!0}resume(){if(this.signal?.aborted)return;let t;for(this.paused=!1;!this.paused&&(t=this.#ae.shift());)t()}onResume(t){this.signal?.aborted||(this.paused?this.#ae.push(t):t())}async matchCheck(t,e){if(e&&this.opts.nodir)return;let s;if(this.opts.realpath){if(s=t.realpathCached()||await t.realpath(),!s)return;t=s}const r=t.isUnknown()||this.opts.stat;return this.matchCheckTest(r?await t.lstat():t,e)}matchCheckTest(t,e){return!t||!(this.maxDepth===1/0||t.depth()<=this.maxDepth)||e&&!t.canReaddir()||this.opts.nodir&&t.isDirectory()||this.#ce(t)?void 0:t}matchCheckSync(t,e){if(e&&this.opts.nodir)return;let s;if(this.opts.realpath){if(s=t.realpathCached()||t.realpathSync(),!s)return;t=s}const r=t.isUnknown()||this.opts.stat;return this.matchCheckTest(r?t.lstatSync():t,e)}matchFinish(t,e){if(this.#ce(t))return;const s=void 0===this.opts.absolute?e:this.opts.absolute;this.seen.add(t);const r=this.opts.mark&&t.isDirectory()?this.#le:"";if(this.opts.withFileTypes)this.matchEmit(t);else if(s)this.matchEmit(t.fullpath()+r);else{const e=t.relative(),s=this.opts.dotRelative&&!e.startsWith(".."+this.#le)?"."+this.#le:"";this.matchEmit(!e&&r?"."+r:s+e+r)}}async match(t,e,s){const r=await this.matchCheck(t,s);r&&this.matchFinish(r,e)}matchSync(t,e,s){const r=this.matchCheckSync(t,s);r&&this.matchFinish(r,e)}walkCB(t,e,s){this.signal?.aborted&&s(),this.walkCB2(t,e,new Ds(this.opts),s)}walkCB2(t,e,s,r){if(this.#ue(t))return r();if(this.signal?.aborted&&r(),this.paused)return void this.onResume((()=>this.walkCB2(t,e,s,r)));s.processPatterns(t,e);let i=1;const n=()=>{0==--i&&r()};for(const[t,e,r]of s.matches.entries())this.#ce(t)||(i++,this.match(t,e,r).then((()=>n())));for(const t of s.subwalkTargets()){if(this.maxDepth!==1/0&&t.depth()>=this.maxDepth)continue;i++;const e=t.readdirCached();t.calledReaddir()?this.walkCB3(t,e,s,n):t.readdirCB(((e,r)=>this.walkCB3(t,r,s,n)),!0)}n()}walkCB3(t,e,s,r){s=s.filterEntries(t,e);let i=1;const n=()=>{0==--i&&r()};for(const[t,e,r]of s.matches.entries())this.#ce(t)||(i++,this.match(t,e,r).then((()=>n())));for(const[t,e]of s.subwalks.entries())i++,this.walkCB2(t,e,s.child(),n);n()}walkCBSync(t,e,s){this.signal?.aborted&&s(),this.walkCB2Sync(t,e,new Ds(this.opts),s)}walkCB2Sync(t,e,s,r){if(this.#ue(t))return r();if(this.signal?.aborted&&r(),this.paused)return void this.onResume((()=>this.walkCB2Sync(t,e,s,r)));s.processPatterns(t,e);let i=1;const n=()=>{0==--i&&r()};for(const[t,e,r]of s.matches.entries())this.#ce(t)||this.matchSync(t,e,r);for(const t of s.subwalkTargets()){if(this.maxDepth!==1/0&&t.depth()>=this.maxDepth)continue;i++;const e=t.readdirSync();this.walkCB3Sync(t,e,s,n)}n()}walkCB3Sync(t,e,s,r){s=s.filterEntries(t,e);let i=1;const n=()=>{0==--i&&r()};for(const[t,e,r]of s.matches.entries())this.#ce(t)||this.matchSync(t,e,r);for(const[t,e]of s.subwalks.entries())i++,this.walkCB2Sync(t,e,s.child(),n);n()}}class Ms extends Bs{matches;constructor(t,e,s){super(t,e,s),this.matches=new Set}matchEmit(t){this.matches.add(t)}async walk(){if(this.signal?.aborted)throw this.signal.reason;return this.path.isUnknown()&&await this.path.lstat(),await new Promise(((t,e)=>{this.walkCB(this.path,this.patterns,(()=>{this.signal?.aborted?e(this.signal.reason):t(this.matches)}))})),this.matches}walkSync(){if(this.signal?.aborted)throw this.signal.reason;return this.path.isUnknown()&&this.path.lstatSync(),this.walkCBSync(this.path,this.patterns,(()=>{if(this.signal?.aborted)throw this.signal.reason})),this.matches}}class Fs extends Bs{results;constructor(t,e,s){super(t,e,s),this.results=new Cs({signal:this.signal,objectMode:!0}),this.results.on("drain",(()=>this.resume())),this.results.on("resume",(()=>this.resume()))}matchEmit(t){this.results.write(t),this.results.flowing||this.pause()}stream(){const t=this.path;return t.isUnknown()?t.lstat().then((()=>{this.walkCB(t,this.patterns,(()=>this.results.end()))})):this.walkCB(t,this.patterns,(()=>this.results.end())),this.results}streamSync(){return this.path.isUnknown()&&this.path.lstatSync(),this.walkCBSync(this.path,this.patterns,(()=>this.results.end())),this.results}}const Us="object"==typeof process&&process&&"string"==typeof process.platform?process.platform:"linux";class Vs{absolute;cwd;root;dot;dotRelative;follow;ignore;magicalBraces;mark;matchBase;maxDepth;nobrace;nocase;nodir;noext;noglobstar;pattern;platform;realpath;scurry;stat;signal;windowsPathsNoEscape;withFileTypes;opts;patterns;constructor(t,e){if(this.withFileTypes=!!e.withFileTypes,this.signal=e.signal,this.follow=!!e.follow,this.dot=!!e.dot,this.dotRelative=!!e.dotRelative,this.nodir=!!e.nodir,this.mark=!!e.mark,e.cwd?(e.cwd instanceof URL||e.cwd.startsWith("file://"))&&(e.cwd=(0,Ve.fileURLToPath)(e.cwd)):this.cwd="",this.cwd=e.cwd||"",this.root=e.root,this.magicalBraces=!!e.magicalBraces,this.nobrace=!!e.nobrace,this.noext=!!e.noext,this.realpath=!!e.realpath,this.absolute=e.absolute,this.noglobstar=!!e.noglobstar,this.matchBase=!!e.matchBase,this.maxDepth="number"==typeof e.maxDepth?e.maxDepth:1/0,this.stat=!!e.stat,this.ignore=e.ignore,this.withFileTypes&&void 0!==this.absolute)throw new Error("cannot set absolute and withFileTypes:true");if("string"==typeof t&&(t=[t]),this.windowsPathsNoEscape=!!e.windowsPathsNoEscape||!1===e.allowWindowsEscape,this.windowsPathsNoEscape&&(t=t.map((t=>t.replace(/\\/g,"/")))),this.matchBase){if(e.noglobstar)throw new TypeError("base matching requires globstar");t=t.map((t=>t.includes("/")?t:`./**/${t}`))}if(this.pattern=t,this.platform=e.platform||Us,this.opts={...e,platform:this.platform},e.scurry){if(this.scurry=e.scurry,void 0!==e.nocase&&e.nocase!==e.scurry.nocase)throw new Error("nocase option contradicts provided scurry option")}else{const t="win32"===e.platform?Be:"darwin"===e.platform?Fe:e.platform?Me:Ue;this.scurry=new t(this.cwd,{nocase:e.nocase,fs:e.fs})}this.nocase=this.scurry.nocase;const s={...e,dot:this.dot,matchBase:this.matchBase,nobrace:this.nobrace,nocase:this.nocase,nocaseMagicOnly:!0,nocomment:!0,noext:this.noext,nonegate:!0,optimizationLevel:2,platform:this.platform,windowsPathsNoEscape:this.windowsPathsNoEscape,debug:!!this.opts.debug},r=this.pattern.map((t=>new ct(t,s))),[i,n]=r.reduce(((t,e)=>(t[0].push(...e.set),t[1].push(...e.globParts),t)),[[],[]]);this.patterns=i.map(((t,e)=>new He(t,n[e],0,this.platform)))}async walk(){return[...await new Ms(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase}).walk()]}walkSync(){return[...new Ms(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase}).walkSync()]}stream(){return new Fs(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase}).stream()}streamSync(){return new Fs(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase}).streamSync()}iterateSync(){return this.streamSync()[Symbol.iterator]()}[Symbol.iterator](){return this.iterateSync()}iterate(){return this.stream()[Symbol.asyncIterator]()}[Symbol.asyncIterator](){return this.iterate()}}function Hs(t,e={}){return new Vs(t,e).streamSync()}function js(t,e={}){return new Vs(t,e).stream()}function Gs(t,e={}){return new Vs(t,e).walkSync()}async function zs(t,e={}){return new Vs(t,e).walk()}function Ws(t,e={}){return new Vs(t,e).iterateSync()}function Xs(t,e={}){return new Vs(t,e).iterate()}const Ks=Hs,qs=Object.assign(js,{sync:Hs}),Ys=Ws,Zs=Object.assign(Xs,{sync:Ws}),Js=Object.assign(Gs,{stream:Hs,iterate:Ws}),Qs=(Object.assign(zs,{glob:zs,globSync:Gs,sync:Js,globStream:js,stream:qs,globStreamSync:Hs,streamSync:Ks,globIterate:Xs,iterate:Zs,globIterateSync:Ws,iterateSync:Ys,Glob:Vs,hasMagic:(t,e={})=>{Array.isArray(t)||(t=[t]);for(const s of t)if(new ct(s,e).hasMagic())return!0;return!1},escape:B,unescape:$}),E?l.resolve(process.env.ALLUSERSPROFILE||"C:\\ProgramData","ssh\\ssh_config"):"/etc/ssh/ssh_config"),tr=l.resolve(a.homedir(),".ssh/config");function er(){const e=t.workspace.getConfiguration("remote.SSH").get("configFile");return e?m(e):tr}function sr(t){return t.type===d().DIRECTIVE}function rr(t){return sr(t)&&"Host"===t.param&&!!t.value&&!!t.config}function ir(t){return sr(t)&&"Include"===t.param&&!!t.value}const nr={host:"Host",hostname:"HostName",user:"User",port:"Port",identityagent:"IdentityAgent",identitiesonly:"IdentitiesOnly",identityfile:"IdentityFile",forwardagent:"ForwardAgent",preferredauthentications:"PreferredAuthentications",proxyjump:"ProxyJump",proxycommand:"ProxyCommand",include:"Include"};function or(t){for(const s of t)sr(s)&&((e=s).param=nr[e.param.toLowerCase()]||e.param),rr(s)&&or(s.config);var e;return t}async function ar(t,e){let s="";await f(t)&&(s=(await h.promises.readFile(t,"utf8")).trim());const r=or(d().parse(s)),i=[];for(let t=0;t<r.length;t++){const s=r[t];if(ir(s)){const r=s.value.split(",").map((t=>t.trim())),n=[];for(const t of r){const s=await zs(g(m(t)),{absolute:!0,cwd:g(l.dirname(e?tr:Qs))});for(const t of s)n.push(await ar(t,e))}i.push([t,n])}}for(const[t,e]of i.reverse())r.splice(t,1,...e.flat());return r}class hr{static async loadFromFS(){const t=await ar(er(),!0);return t.push(...await ar(Qs,!1)),new hr(t)}constructor(t){this.sshConfig=t}getAllConfiguredHosts(){const t=new Set;for(const e of this.sshConfig)if(rr(e)){const s=Array.isArray(e.value)?e.value[0]:e.value;/^!/.test(s)||/[?*]/.test(s)||t.add(s)}return[...t.keys()]}getHostConfiguration(t){return this.sshConfig.compute(t)}}const lr=require("crypto");let cr;var ur=i(9589),dr=i.n(ur);class pr{constructor(){this.event=(t,e,s)=>{const r=this.add(e?t.bind(e):t);return s?.push(r),r}}get size(){return this.listeners?"function"==typeof this.listeners?1:this.listeners.length:0}fire(t){if(this.listeners)if("function"==typeof this.listeners)this.listeners(t);else for(const e of this.listeners)e(t)}dispose(){this.listeners=void 0}add(t){return this.listeners?"function"==typeof this.listeners?this.listeners=[this.listeners,t]:this.listeners.push(t):this.listeners=t,{dispose:()=>this.rm(t)}}rm(t){if(!this.listeners)return;if("function"==typeof this.listeners)return void(this.listeners===t&&(this.listeners=void 0));const e=this.listeners.indexOf(t);-1!==e&&(2===this.listeners.length?this.listeners=0===e?this.listeners[1]:this.listeners[0]:this.listeners=this.listeners.slice(0,e).concat(this.listeners.slice(e+1)))}}const fr=["SSH_AUTH_SOCK","HTTP_PROXY","http_proxy","HTTPS_PROXY","https_proxy","NO_PROXY","no_proxy"],mr="https://cursor.blob.core.windows.net/remote-releases/${commit}/vscode-reh-${platform}-${arch}.tar.gz";function gr(t){return"win32"===process.platform?c().join(t,"dist","scripts","launchSSHAskpass.bat"):c().join(t,"dist","scripts","launchSSHAskpass.sh")}function Er(t){return c().join(t,"dist","scripts","sshAskClient.js")}function Sr(t){return c().join(t,"dist","scripts","remoteServer.js")}var wr;!function(t){t.Linux="linux",t.MacOS="macOS",t.Windows="windows"}(wr||(wr={}));const vr=[wr.Linux,wr.MacOS,wr.Windows];function Rr(t){if(void 0!==t)switch(t.toLowerCase().trim()){case"darwin":case"macos":return wr.MacOS;case"linux":case"alpine":return wr.Linux;case"win32":case"windows":return wr.Windows;default:return}}async function yr({extensionConfig:e,host:s,logger:r,shouldPrompt:i}){const n=e.get("remotePlatform",{});r.debug(`hostname: ${s}, remote platform map: ${JSON.stringify(n)}`);const o=n[s];if(function(t){return Object.values(wr).includes(t)}(o))return r.info(`Using configured platform ${o} for remote host ${s}`),o;if(!i)return;const a=await t.window.showQuickPick(vr,{title:`Select the platform of remote host "${s}"`,ignoreFocusOut:!0});if(void 0===a)throw new Error(`User cancelled platform selection for remote host ${s}`);return r.info(`Selected platform ${a} for remote host ${s}`),_r(e,s,a,r),a}function _r(e,s,r,i){const n=e.get("remotePlatform",{});e.update("remotePlatform",{...n,[s]:r},t.ConfigurationTarget.Global).then((()=>{i.info(`Saved platform ${r} for remote host ${s}`)}),(t=>{i.error(`Error saving platform ${r} for remote host ${s}: ${t}`)}))}function Ir(t,e){if(void 0!==t){if("string"==typeof t)return""!==t.trim()?t.trim():void 0;if("object"==typeof t&&null!==t){const s=t[e];return s?s.trim():void 0}}}async function br({conn:e,logger:s,defaultExtensions:r,askpassHandle:i,progress:n,cancellationToken:o,extensionFolder:u,localServerDownload:d,timeoutMs:p,resolveAttempt:m,hasRemoteCommand:g,forceReinstall:S,killRunningServers:w,askpassStartedEvent:v,askpassFinishedEvent:R}){const y=t.workspace.getConfiguration("remote.SSH");let _=await yr({extensionConfig:y,host:e.config.host,logger:s,shouldPrompt:!1}),I=await async function({extensionConfig:t,host:e,logger:s}){const r=t.get("serverInstallPath");if(s.debug(`hostname: ${e}, remote server install map: ${JSON.stringify(r)}`),null==r)return;if("object"!=typeof r)throw new Error(`Invalid setting 'remote.SSH.serverInstallPath'. It must be a object, but got: ${r}`);const i=r[e];if(null!=i){if("string"==typeof i)return i;throw new Error(`Invalid type server install path for host ${e}. It must be a string, but got: ${i}`)}}({extensionConfig:y,host:e.config.host,logger:s})??"~";I=I.replace(/[/\\]+$/,"");const b=Date.now();let $,T=1,O=!1,k="auto"===d||"always"===d,C="always"===d;const A=await async function(){const e=await async function(){if(!cr){const e=await h.promises.readFile(l.join(t.env.appRoot,"product.json"),"utf8");cr=JSON.parse(e)}return cr}();let s="production";return"cursor-lab"===e.applicationName&&(s="lab"),"cursor-nightly"===e.applicationName&&(s="nightly"),{version:e.version,commit:e.commit??e.nightlyCommit,line:s,serverApplicationName:e.serverApplicationName,serverDataFolderName:e.serverDataFolderName}}(),L=`${I}/${A.serverDataFolderName}/cursor-server-${lr.randomUUID()}.tar.gz`,x=y.get("enableAgentForwarding",!0),N=Ir(y.get("httpProxy"),e.config.host),P=Ir(y.get("httpsProxy"),e.config.host),D=Ir(y.get("noProxy"),e.config.host),B=y.get("serverShutdownTimeout",300);for(;;){if(o.isCancellationRequested)throw new Error("Cancelled");let t=[];try{const o=gr(u);if("win32"!==process.platform)try{await h.promises.chmod(o,493)}catch(t){s.error(`Error setting permissions on askpass script: ${t}`)}const l=Er(u),d={SSH_ASKPASS:o,CURSOR_SSH_ASKPASS_JS:l,CURSOR_SSH_ASKPASS_HANDLE:i,SSH_ASKPASS_REQUIRE:"force"};s.info(`Using askpass script: ${o} with javascript file ${l}. Askpass handle: ${i}`);const b=[];x&&b.push("SSH_AUTH_SOCK"),N&&b.push("HTTP_PROXY","http_proxy"),P&&b.push("HTTPS_PROXY","https_proxy"),D&&b.push("NO_PROXY","no_proxy");const M=Sr(u),F=await h.promises.readFile(M,"base64"),U=lr.randomBytes(12).toString("hex"),V={id:U,commit:A.commit,line:A.line,envVariables:b,extensionIds:r,serverApplicationName:A.serverApplicationName,serverInstallPath:I,serverDataFolderName:A.serverDataFolderName,serverDownloadUrlTemplate:mr,forceReinstall:S,killRunningServers:w,httpProxy:N,httpsProxy:P,noProxy:D,cursorVersion:A.version,serverShutdownTimeout:B,multiplexServerScriptBase64:F,skipRemoteDownload:C,scpServerPath:L};let H;const j={...process.env,...d,CURSOR_SSH_ELECTRON_PATH:process.execPath,DISPLAY:"1"};if(N&&(j.HTTP_PROXY=N,j.http_proxy=N),P&&(j.HTTPS_PROXY=P,j.https_proxy=P),D&&(j.NO_PROXY=D,j.no_proxy=D),_===wr.Windows){const t=kr(V).trim().replace(/^#.*$/gm,"").replace(/\n{2,}/gm,"\n").replace(/^\s*/gm,"").replace(/\}\n/g,"}\n\n").replace(/\}$/,"}\n\n");if(s.info("Command length (8191 max):",t.length),t.length>8191)throw new Error("Command line too long");let r;void 0!==$&&await f($)||($=c().join(a.tmpdir(),`cursor_remote_install_${Math.floor(1e5*Math.random())}.ps1`),await h.promises.writeFile($,t));const i="powershell -NoProfile";r=E?`type "${$}" | `:`cat "${$}" | `;const o=m>1?"Reconnecting":"Connecting";n.report({message:`${o} to the remote host (attempt ${T})...`}),H=await e.execHandler({command:i,hasRemoteCommand:g,env:j,shellCmdPrefix:r})}else{const t=Or(V);let r;void 0!==$&&await f($)||($=c().join(a.tmpdir(),`cursor_remote_install_${Math.floor(1e5*Math.random())}.sh`),await h.promises.writeFile($,t)),r=E?`type "${$}" | `:`cat "${$}" | `;const i="bash --login -c bash",o=m>1?"Reconnecting":"Connecting";n.report({message:`${o} to the remote host (attempt ${T})...`}),H=await e.execHandler({command:i,hasRemoteCommand:g,shellCmdPrefix:r,env:j}),s.info("Started installation script. Waiting for it to finish...")}const G=H.process,z=new pr;t.push(z);const W=[],X=new pr;t.push(X);const K=[];G.stdout.on("data",(t=>{W.push(t),z.fire(t),s.info(`(ssh_tunnel) stdout: ${t.toString("utf8")}`)})),G.stderr.on("data",(t=>{K.push(t),s.info(`(ssh_tunnel) stderr: ${t.toString("utf8")}`),X.fire(t)}));const q=new Promise(((t,e)=>{G.on("error",(t=>{s.error("(ssh_tunnel): Error running command",t),e(t)})),G.on("exit",((e,r)=>{s.info(`(ssh_tunnel): exit: code=${e} signal=${r}`),t({exitCode:e??0})}))})),Y={get stdout(){return Buffer.concat(W).toString("utf8")},get stderr(){return Buffer.concat(K).toString("utf8")},get onStdoutData(){return z.event},get onStderrData(){return X.event},exitPromise:q};let Z;s.info(`Waiting for server to install via process(${H.process.pid})...`),t.push({dispose:()=>{void 0!==Z&&(clearTimeout(Z),Z=void 0)}});let J=!1,Q=()=>{};t.push(Y.onStderrData((()=>{Q()}))),t.push(v((()=>{J=!0,Q()}))),t.push(R((()=>{J=!1,Q()})));const tt=new RegExp(`${U}: end`,"m"),et=$r((await Promise.race([Y.exitPromise.then((t=>({stdout:Y.stdout,stderr:Y.stderr,exitCode:t.exitCode}))),new Promise(((t,e)=>{Q=()=>{void 0!==Z&&clearTimeout(Z),J||(Z=setTimeout((()=>{Z=void 0,e(new Error("Failed to install server within the timeout"))}),p))},Q()})),new Promise((e=>{t.push(Y.onStdoutData((t=>{Q(),tt.test(t.toString("utf8"))&&e({stdout:Y.stdout,stderr:Y.stderr,exitCode:0})})))}))])).stdout,U);if(!et)throw new Error("Failed to install the Cursor Server. Please check the logs for more details.");O="true"===et.isFatalError;const st=parseInt(et.exitCode,10);if(s.info("Server install command exit code: ",st),_=Rr(et.detectedPlatform)??_??wr.Linux,0!==st){if(et.errorMessage.includes("Download failed: ")&&k){n.report({message:"Downloading Cursor Server locally and copying it over"}),s.info(`Download failed: ${et.errorMessage}. Downloading server locally and copying it over...`);const t=mr.replaceAll("${commit}",V.commit).replaceAll("${platform}",et.detectedPlatform).replaceAll("${arch}",et.arch),r=c().join(a.tmpdir(),`cursor-server-${lr.randomUUID()}.tar.gz`);s.info(`Downloading server from ${t} to ${r}`);const i=await fetch(t);if(!i.ok)throw new Error(`Could not install Cursor Server. Remote and local download faileds: (Remote error: ${et.errorMessage}) (Local error: ${i.statusText})`);const o=await i.arrayBuffer();try{await h.promises.writeFile(r,Buffer.from(o)),s.info(`Downloaded server locally to ${r}. Copying to remote host at ${L}`),await e.copyToRemote({localPath:r,remotePath:L,hasRemoteCommand:g,env:j,isWindowsRemote:_===wr.Windows})}finally{try{await h.promises.unlink(r),s.info(`Deleted local server file ${r}`)}catch(t){s.error(`Error deleting local server file ${r}: ${t}`)}}s.info("Successfully SCP'd server to the remote host. Reattempting to connect"),k=!1,C=!0;continue}let t="Couldn't install Cursor Server, install script returned non-zero exit status";throw et.errorMessage&&(t+=`: ${et.errorMessage}`),new Error(t)}let rt=void 0!==et.multiplexListeningOn?parseInt(et.multiplexListeningOn,10):void 0,it=et.multiplexConnectionToken;void 0!==rt&&isNaN(rt)&&(s.error(`Invalid multiplexListeningOn: ${et.multiplexListeningOn}. Continuing without exec server. Docker over SSH will NOT work.`),rt=void 0,it=void 0);const nt=parseInt(et.codeListeningOn,10);if(isNaN(nt))throw new Error(`Invalid codeListeningOn: ${et.codeListeningOn}`);const ot={};for(const t of fr)t in et&&et[t].length>0&&(ot[t]=et[t]);return _=Rr(et.detectedPlatform)??_??wr.Linux,_r(y,e.config.host,_,s),{exitCode:st,subprocess:H.process,multiplexListeningOn:rt,codeListeningOn:nt,socksPort:H.socksPort,remoteNodeExecutable:et.nodeExecutable,errorMessage:et.errorMessage,multiplexConnectionToken:it,codeConnectionToken:et.codeConnectionToken,platform:_,envVars:ot}}catch(t){const r=t instanceof Error?t.message:String(t);if(s.error("Error installing server:",t),void 0===_){_=await yr({extensionConfig:y,host:e.config.host,logger:s,shouldPrompt:!0});continue}if(O||1===m||o.isCancellationRequested)throw t;if(Date.now()-b>=1e3*B)throw s.error(`Failed to connect after ${T} attempts: ${r}`),t;n.report({message:`Failed to connect to the remote server after ${T} attempts; retrying connection in 5 seconds`}),s.info("Retrying connection in 5 seconds..."),await new Promise((t=>setTimeout(t,5e3))),T++}finally{if(t.forEach((t=>t.dispose())),void 0!==$)try{s.info(`Deleting local script ${$}`),await h.promises.unlink($)}catch(t){s.error(`Error deleting random file ${$}: ${t}`)}finally{$=void 0}}}}function $r(t,e){const s=`${e}: start`,r=`${e}: end`,i=t.indexOf(s);if(i<0)return;const n=t.indexOf(r,i+s.length);if(n<0)return;const o={},a=t.substring(i+s.length,n).split(/\r?\n/);for(const t of a){const[e,s]=t.split("==");o[e]=s}return o}const Tr=30;function Or({httpProxy:t,httpsProxy:e,noProxy:s,commit:r,line:i,serverApplicationName:n,id:o,serverInstallPath:a,serverDataFolderName:h,envVariables:l,forceReinstall:c,cursorVersion:u,skipRemoteDownload:d,scpServerPath:p,serverDownloadUrlTemplate:f,multiplexServerScriptBase64:m,extensionIds:g,killRunningServers:E,serverShutdownTimeout:S}){a=a.replace(/^~(?=$|\/|\\)/,"$HOME"),p=p.replace(/^~(?=$|\/|\\)/,"$HOME");let w=!1;try{u&&(u=u.split("-")[0],dr().lt(u,"0.50.5")&&(w=!0))}catch(t){}const v=lr.createHash("sha256").update(m).digest("hex"),R=g.map((t=>"--install-extension "+t)).join(" ");return a.endsWith(`/${h}`)&&(a=a.slice(0,-1*(h.length+1))),`${t?`\nexport HTTP_PROXY="${t}"\nexport http_proxy="${t}"`:""}${e?`\nexport HTTPS_PROXY="${e}"\nexport https_proxy="${e}"`:""}${s?`\nexport NO_PROXY="${s}"\nexport no_proxy="${s}"`:""}\nTMP_DIR="\${XDG_RUNTIME_DIR:-"/tmp"}"\nSERVER_COMMIT="${r}"\nSERVER_LINE="${i}"\nSERVER_DATA_DIR="${a}/${h}"\nSERVER_DIR="$SERVER_DATA_DIR/bin/${r}"\nSERVER_NODE_EXECUTABLE="$SERVER_DIR/node"\nCODE_SERVER_SCRIPT="$SERVER_DIR/bin/${n}"\nCODE_SERVER_LOGFILE="$SERVER_DATA_DIR/.$SERVER_COMMIT.code.log"\nCODE_SERVER_TOKENFILE="$SERVER_DATA_DIR/.$SERVER_COMMIT.code.token"\nCODE_SERVER_PIDFILE="$SERVER_DATA_DIR/.$SERVER_COMMIT.code.pid"\nCODE_SERVER_PROCESS_ALL_VERSIONS_GREP_PATTERN="$SERVER_DATA_DIR/bin/.*/out/server-main.js"\nCODE_LISTENING_ON=\nCODE_SERVER_CONNECTION_TOKEN=\nMULTIPLEX_SERVER_SCRIPT="$SERVER_DATA_DIR/bin/multiplex-server/${v}.js"\nMULTIPLEX_SERVER_LOGFILE="$SERVER_DATA_DIR/.${r}${v}.multiplex.log"\nMULTIPLEX_SERVER_TOKENFILE="$SERVER_DATA_DIR/.${r}${v}.multiplex.token"\nMULTIPLEX_SERVER_PIDFILE="$SERVER_DATA_DIR/.${r}${v}.multiplex.pid"\nMULTIPLEX_SERVER_PROCESS_ALL_VERSIONS_GREP_PATTERN="$SERVER_DATA_DIR/bin/multiplex-server/.*.js"\nMULTIPLEX_LISTENING_ON=\nSERVER_ARCH=\nSERVER_DOWNLOAD_URL=\n# These are magic variable\nexport VSCODE_AGENT_FOLDER="$SERVER_DATA_DIR"\nexport VSCODE_SERVER_SHUTDOWN_TIMEOUT="${S}"\nOS_RELEASE_ID=\nARCH=\nPLATFORM=\nprint_install_results_and_exit() {\n    echo "${o}: start"\n    echo "exitCode==$1=="\n    echo "nodeExecutable==$SERVER_NODE_EXECUTABLE=="\n    echo "multiplexListeningOn==$MULTIPLEX_LISTENING_ON=="\n    echo "multiplexConnectionToken==$MULTIPLEX_SERVER_CONNECTION_TOKEN=="\n    echo "codeListeningOn==$CODE_LISTENING_ON=="\n    echo "errorMessage==$2=="\n    echo "isFatalError==$3=="\n    echo "codeConnectionToken==$CODE_SERVER_CONNECTION_TOKEN=="\n    echo "detectedPlatform==$PLATFORM=="\n    echo "arch==$SERVER_ARCH=="\n    ${l.map((t=>`echo "${t}==$${t}=="`)).join("\n")}\n    echo "${o}: end"\n    exit $1\n}\n\nprint_install_results_and_wait() {\n    # Try to get PIDs from PID files first, fallback to extracting from running processes\n    if [[ -f $CODE_SERVER_PIDFILE ]]; then\n        CODE_SERVER_PID="$(cat $CODE_SERVER_PIDFILE)"\n    else\n        # PID file doesn't exist, try to extract PID from running process\n        CODE_SERVER_RUNNING_PROCESS="$(ps -o pid,args -A | grep $CODE_SERVER_SCRIPT | grep -v grep | head -1)"\n        if [[ -n "$CODE_SERVER_RUNNING_PROCESS" ]]; then\n            CODE_SERVER_PID="$(echo "$CODE_SERVER_RUNNING_PROCESS" | awk '{print $1}')"\n        else\n            print_install_results_and_exit 1 "Code server PID file not found and no running code server process detected" "false"\n        fi\n    fi\n\n    if [[ -f $MULTIPLEX_SERVER_PIDFILE ]]; then\n        MULTIPLEX_SERVER_PID="$(cat $MULTIPLEX_SERVER_PIDFILE)"\n    else\n        # PID file doesn't exist, try to extract PID from running process\n        MULTIPLEX_SERVER_RUNNING_PROCESS="$(ps -o pid,args -A | grep $MULTIPLEX_SERVER_SCRIPT | grep -v grep | head -1)"\n        if [[ -n "$MULTIPLEX_SERVER_RUNNING_PROCESS" ]]; then\n            MULTIPLEX_SERVER_PID="$(echo "$MULTIPLEX_SERVER_RUNNING_PROCESS" | awk '{print $1}')"\n        else\n            echo "Multiplex server PID file not found and no running multiplex server process detected"\n            # This pid doesn't exist, so the while loop will exit immediately\n            MULTIPLEX_SERVER_PID=invalid_pid\n        fi\n    fi\n\n    echo "${o}: start"\n    echo "exitCode==0=="\n    echo "nodeExecutable==$SERVER_NODE_EXECUTABLE=="\n    echo "errorMessage===="\n    echo "isFatalError==false=="\n    echo "multiplexListeningOn==$MULTIPLEX_LISTENING_ON=="\n    echo "multiplexConnectionToken==$MULTIPLEX_SERVER_CONNECTION_TOKEN=="\n    echo "codeListeningOn==$CODE_LISTENING_ON=="\n    echo "codeConnectionToken==$CODE_SERVER_CONNECTION_TOKEN=="\n    echo "detectedPlatform==$PLATFORM=="\n    echo "arch==$SERVER_ARCH=="\n    ${l.map((t=>`echo "${t}==$${t}=="`)).join("\n")}\n    echo "${o}: end"\n    unlock\n    trap - EXIT\n    # We need to wait for both servers to exit -- when using docker over ssh, the code server won't have a connection\n    while ps -o pid -A | grep -w $CODE_SERVER_PID >/dev/null 2>&1\n    do\n        sleep 10\n    done\n    echo "Code server process $CODE_SERVER_PID died"\n    while ps -o pid -A | grep -w $MULTIPLEX_SERVER_PID >/dev/null 2>&1\n    do\n        sleep 10\n    done\n    echo "Multiplex server process $MULTIPLEX_SERVER_PID died"\n    exit 0\n}\n\nget_lockfile() {\n    echo "$TMP_DIR/cursor-remote-lock.$(echo $SERVER_DATA_DIR | (md5sum 2>/dev/null || md5) | awk '{print $1}')"\n}\nif [[ "${E||c}" == "true" ]]; then\n    echo "Killing all running Cursor servers"\n    CODE_SERVER_RUNNING_PROCESS="$(ps -o pid,args -A | grep $CODE_SERVER_PROCESS_ALL_VERSIONS_GREP_PATTERN | grep -v grep || true)"\n    if [[ -z "$CODE_SERVER_RUNNING_PROCESS" ]]; then\n        echo "No running code servers found"\n    fi\n    echo "Killing running code servers: $CODE_SERVER_RUNNING_PROCESS"\n    echo "$CODE_SERVER_RUNNING_PROCESS" | while read -r line; do\n        pid=$(echo "$line" | awk '{print $1}')\n        if [[ -n "$pid" ]]; then\n            echo "Killing server process with PID: $pid"\n            kill -9 "$pid"\n        fi\n    done\n    CODE_SERVER_RUNNING_PROCESS=""\n    echo "Killing all running multiplex servers"\n    MULTIPLEX_SERVER_RUNNING_PROCESS="$(ps -o pid,args -A | grep $MULTIPLEX_SERVER_PROCESS_ALL_VERSIONS_GREP_PATTERN | grep -v grep || true)"\n    if [[ -z "$MULTIPLEX_SERVER_RUNNING_PROCESS" ]]; then\n        echo "No running multiplex servers found"\n    fi\n    echo "Killing running multiplex servers: $MULTIPLEX_SERVER_RUNNING_PROCESS"\n    echo "$MULTIPLEX_SERVER_RUNNING_PROCESS" | while read -r line; do\n        pid=$(echo "$line" | awk '{print $1}')\n        if [[ -n "$pid" ]]; then\n            echo "Killing server process with PID: $pid"\n            kill -9 "$pid"\n        fi\n    done\n    MULTIPLEX_SERVER_RUNNING_PROCESS=""\nfi\n\nif [[ '${c}' == "true" ]]; then\n    echo "Removing all existing Cursor installations"\n    rm -rfv "$SERVER_DATA_DIR/bin"         $SERVER_DATA_DIR/.*.code.log         $SERVER_DATA_DIR/.*.code.pid         $SERVER_DATA_DIR/.*.code.token         $SERVER_DATA_DIR/.*.multiplex.pid         $SERVER_DATA_DIR/.*.multiplex.token         $SERVER_DATA_DIR/.*.multiplex.log         $SERVER_DATA_DIR/.*.pid         $SERVER_DATA_DIR/.*.token         $SERVER_DATA_DIR/.*.log         $(get_lockfile)         $(get_lockfile).target\n\n    # Don't delete the server we just copied\n    echo "Deleting left behind cursor servers, execpt for ${p}"\n    find "$SERVER_DATA_DIR" -name "cursor-server-*.tar.gz" ! -name "$(basename ${p})" -delete -print\n    echo "Done deleting left behind cursor servers"\nfi\n\nunlock() {\n    lockfile=$(get_lockfile)\n    if [ -n "$LOCK_PID" ]; then\n        kill $LOCK_PID 2>/dev/null\n    fi\n    echo "Unlocking $lockfile"\n    rm -f "$lockfile"\n    rm -f "$lockfile.target"\n}\n\nlock() {\n    lockfile=$(get_lockfile)\n    echo "Locking $lockfile"\n    lockAcquired=0\n    for i in {1..${Tr}}; do\n        if [ -f "$lockfile" ]; then\n            # Check if lock is stale (older than 10 seconds)\n            current_time=$(date +%s)\n            lock_time=$(cat "$lockfile" 2>/dev/null || echo 0)\n            if [ $((current_time - lock_time)) -gt 10 ]; then\n                echo "Found stale lock, removing..."\n                rm -f "$lockfile"\n            fi\n        fi\n        touch "$lockfile.target"\n        ln "$lockfile.target" "$lockfile"\n        if [ $? -eq 0 ]; then\n            lockAcquired=1\n            # Start a background process to update timestamp\n            while true; do\n                date +%s > "$lockfile"\n                sleep 1\n            done &\n            LOCK_PID=$!\n            break\n        fi\n        echo "Install in progress, sleeping for a bit..."\n        sleep 1\n    done\n    if [ $lockAcquired -eq 0 ]; then\n        print_install_results_and_exit 1 "Could not acquire lock after multiple attempts"\n    fi\n    trap unlock EXIT\n}\n\nKERNEL="$(uname -s)"\ncase $KERNEL in\n    Darwin)\n        PLATFORM="darwin"\n        ;;\n    Linux)\n        PLATFORM="linux"\n        ;;\n    *)\n        print_install_results_and_exit 1 "Platform not supported: $KERNEL" "true"\n        ;;\nesac\n\nARCH="$(uname -m)"\ncase $ARCH in\n    x86_64 | amd64)\n        SERVER_ARCH="x64"\n        ;;\n    arm64 | aarch64)\n        SERVER_ARCH="arm64"\n        ;;\n    *)\n        print_install_results_and_exit 1 "Architecture not supported: $ARCH" "true"\n        ;;\nesac\n\nOS_RELEASE_ID="$(grep -i '^ID=' /etc/os-release 2>/dev/null | sed 's/^ID=//gi' | sed 's/"//g')"\nif [[ -z $OS_RELEASE_ID ]]; then\n    OS_RELEASE_ID="$(grep -i '^ID=' /usr/lib/os-release 2>/dev/null | sed 's/^ID=//gi' | sed 's/"//g')"\n    if [[ -z $OS_RELEASE_ID ]]; then\n        OS_RELEASE_ID="unknown"\n    fi\nfi\n\n# Create installation folder\nmkdir -p $SERVER_DIR\nif (( $? > 0 )); then\n    print_install_results_and_exit 1 "Error creating server install directory $SERVER_DIR"\nfi\n\n# adjust platform for alpine (musl-libc based binary) download, if needed\nif [[ $OS_RELEASE_ID = alpine ]]; then\n    PLATFORM=$OS_RELEASE_ID\nfi\nSERVER_DOWNLOAD_URL="$(echo "${f.replace(/\$\{/g,"\\${")}" | sed "s/\\\${line}/$SERVER_LINE/g"  | sed "s/\\\${commit}/$SERVER_COMMIT/g" | sed "s/\\\${platform}/$PLATFORM/g" | sed "s/\\\${arch}/$SERVER_ARCH/g")"\nlock\n# Check if server script is already installed\nif [[ ! -f $CODE_SERVER_SCRIPT ]]; then\n    pushd $SERVER_DIR > /dev/null\n    RANDOM_FILENAME="cursor-server-${lr.randomUUID()}.tar.gz"\n    if [[ -f "${p}" ]]; then\n        echo "Found existing server archive at ${p}, using it instead of downloading"\n        mv "${p}" $RANDOM_FILENAME\n    else\n        if [[ '${d}' == 'true' ]]; then\n            echo "Server not found at ${p}, and local download is disabled"\n            print_install_results_and_exit 1 "Download failed: Failed to copy server from local client" "true"\n        fi\n        if [[ ! -z $(which wget) ]]; then\n            echo "Downloading server via wget from $SERVER_DOWNLOAD_URL to $RANDOM_FILENAME"\n            wget --tries=2 --timeout=5 --continue --progress=dot -O $RANDOM_FILENAME $SERVER_DOWNLOAD_URL\n        elif [[ ! -z $(which curl) ]]; then\n            echo "Downloading server via curl from $SERVER_DOWNLOAD_URL to $RANDOM_FILENAME"\n            curl --retry 2 --fail --connect-timeout 5 --location --progress-bar --output $RANDOM_FILENAME $SERVER_DOWNLOAD_URL\n        else\n            print_install_results_and_exit 1 "Download failed: Error no tool to download server binary. Please install wget or curl" "true"\n        fi\n        if (( $? > 0 )); then\n            if [[ "$OS_RELEASE_ID" == 'alpine' && '${w}' = 'true' ]]; then\n                # Only showing this error if the download actually fails, and we know that the version is pre-Alpine\n                # Don't want the download to fail if it actually would have worked!\n                print_install_results_and_exit 1 "Please update Cursor to the latest version to connect to Alpine-based remote servers" "true"\n            fi\n            print_install_results_and_exit 1 "Download failed: Error downloading server from $SERVER_DOWNLOAD_URL" "false"\n        fi\n    fi\n    tar -xf $RANDOM_FILENAME --strip-components 1\n    if (( $? > 0 )); then\n        print_install_results_and_exit 1 "Tar failed to extract server contents from $RANDOM_FILENAME" "false"\n    fi\n    if [[ ! -f $CODE_SERVER_SCRIPT ]]; then\n        print_install_results_and_exit 1 "Failed to extract code server script: $CODE_SERVER_SCRIPT" "false"\n    fi\n    rm -f $RANDOM_FILENAME\n    popd > /dev/null\nelse\n    echo "Server script already installed in $CODE_SERVER_SCRIPT"\nfi\necho "Checking node executable"\nif ! $SERVER_NODE_EXECUTABLE --version; then\n    echo "Node executable at $SERVER_NODE_EXECUTABLE is not working, checking system node"\n    SYSTEM_NODE=$(which node)\n    if [[ -n "$SYSTEM_NODE" ]]; then\n        echo "System node version: $($SYSTEM_NODE --version)"\n        $SYSTEM_NODE -e "process.exit(parseInt(process.version.slice(1)) >= 20 ? 0 : 1)"\n        if [[ $? -eq 0 ]]; then\n            echo "System node version is 20 or higher, creating symlink"\n            ln -sf $SYSTEM_NODE $SERVER_NODE_EXECUTABLE\n            echo "Created symlink from $SERVER_NODE_EXECUTABLE to $SYSTEM_NODE"\n        else\n            print_install_results_and_exit 1 "The bundled NodeJS failed to run, and system node is too old. Please manually install NodeJS 20 or higher on your remote system" "true"\n        fi\n    else\n        print_install_results_and_exit 1 "The bundled NodeJS failed to run, and no system NodeJS executable was found. Please manually install NodeJS 20 or higher on your remote system" "true"\n    fi\nfi\n\n# Clean up stale builds\nOLD_COMMITS=$(ls -1 -t "$SERVER_DATA_DIR/bin" | tail -n +6)\nfor OLD_COMMIT in $OLD_COMMITS; do\n    IS_RUNNING=\`ps ax | grep $OLD_COMMIT | grep -v grep | wc -l | tr -d '[:space:]'\`\n    if [[ $IS_RUNNING -eq 0 ]]; then\n        echo "Cleaning up stale build $OLD_COMMIT"\n        if [[ "$OLD_COMMIT" != "$SERVER_COMMIT" ]]; then\n            rm -rf "$SERVER_DATA_DIR/bin/$OLD_COMMIT" "$SERVER_DATA_DIR/.$OLD_COMMIT.*"\n        fi\n    else\n        echo "Build $OLD_COMMIT is still running, skipping"\n    fi\ndone\n\n# Try to find if server is already running\necho "Checking for running multiplex server: $MULTIPLEX_SERVER_SCRIPT"\nif [[ -f $MULTIPLEX_SERVER_PIDFILE ]]; then\n    MULTIPLEX_SERVER_PID="$(cat $MULTIPLEX_SERVER_PIDFILE)"\n    MULTIPLEX_SERVER_RUNNING_PROCESS="$(ps -o pid,args -A | grep -w $MULTIPLEX_SERVER_PID | grep $MULTIPLEX_SERVER_SCRIPT)"\nelse\n    MULTIPLEX_SERVER_RUNNING_PROCESS="$(ps -o pid,args -A | grep $MULTIPLEX_SERVER_SCRIPT | grep -v grep)"\nfi\necho "Running multiplex server: $MULTIPLEX_SERVER_RUNNING_PROCESS"\n\nif [[ -z $MULTIPLEX_SERVER_RUNNING_PROCESS || ! -f $MULTIPLEX_SERVER_LOGFILE || ! -f $MULTIPLEX_SERVER_TOKENFILE ]]; then\n    if [[ -f $MULTIPLEX_SERVER_LOGFILE ]]; then\n        rm $MULTIPLEX_SERVER_LOGFILE\n    fi\n    if [[ -f $MULTIPLEX_SERVER_TOKENFILE ]]; then\n        rm $MULTIPLEX_SERVER_TOKENFILE\n    fi\n\n    touch $MULTIPLEX_SERVER_TOKENFILE\n    chmod 600 $MULTIPLEX_SERVER_TOKENFILE\n    MULTIPLEX_SERVER_CONNECTION_TOKEN="${lr.randomUUID()}"\n    echo $MULTIPLEX_SERVER_CONNECTION_TOKEN > $MULTIPLEX_SERVER_TOKENFILE\n\n    # This is super counterintuitive, but we UNSET the SSH_AUTH_SOCK before starting the server, because we manually inject it into the extension host later.\n    # This is to prevent us from being used across ALL connections by default\n\n    # Backing it up, NOT exporting it\n    if [[ -n "$SSH_AUTH_SOCK" ]]; then\n        ORIGINAL_SSH_AUTH_SOCK=$SSH_AUTH_SOCK\n        unset SSH_AUTH_SOCK\n    fi\n\n    echo "Creating directory for multiplex server: $(dirname $MULTIPLEX_SERVER_SCRIPT)"\n    mkdir -p $(dirname "$MULTIPLEX_SERVER_SCRIPT")\n    echo "Writing multiplex server script to $MULTIPLEX_SERVER_SCRIPT"\n    echo '${m}' | (base64 -d 2>/dev/null || base64 -D) > "$MULTIPLEX_SERVER_SCRIPT"\n\n    echo "Starting multiplex server: $SERVER_NODE_EXECUTABLE $MULTIPLEX_SERVER_SCRIPT $MULTIPLEX_SERVER_CONNECTION_TOKEN"\n    $SERVER_NODE_EXECUTABLE "$MULTIPLEX_SERVER_SCRIPT" "$MULTIPLEX_SERVER_CONNECTION_TOKEN"  &> $MULTIPLEX_SERVER_LOGFILE &\n    echo $! > $MULTIPLEX_SERVER_PIDFILE\n\n    # Restoring the original SSH_AUTH_SOCK\n    if [[ -n "$ORIGINAL_SSH_AUTH_SOCK" ]]; then\n        export SSH_AUTH_SOCK=$ORIGINAL_SSH_AUTH_SOCK\n        unset ORIGINAL_SSH_AUTH_SOCK\n    fi\nelse\n    echo "Multiplex server script is already running $MULTIPLEX_SERVER_SCRIPT. Running processes are $MULTIPLEX_SERVER_RUNNING_PROCESS"\nfi\n\necho "Reading multiplex server token file $MULTIPLEX_SERVER_TOKENFILE"\n\nif [[ -f $MULTIPLEX_SERVER_TOKENFILE ]]; then\n    echo "Multiplex server token file found"\n    MULTIPLEX_SERVER_CONNECTION_TOKEN="$(cat $MULTIPLEX_SERVER_TOKENFILE)"\nelse\n    print_install_results_and_exit 1 "Multiplex server token file not found: $MULTIPLEX_SERVER_TOKENFILE"\nfi\n\necho "Reading multiplex server log file $MULTIPLEX_SERVER_LOGFILE"\n\nfor i in {1..20}; do\n    if [[ -f $MULTIPLEX_SERVER_LOGFILE ]]; then\n        MULTIPLEX_LISTENING_ON="$(cat $MULTIPLEX_SERVER_LOGFILE | grep -E 'Server listening on .+' | sed 's/Server listening on //')"\n        if [[ -n "$MULTIPLEX_LISTENING_ON" ]]; then\n            break\n        fi\n    fi\n    sleep 0.5\ndone\n\nif [[ -z "$MULTIPLEX_LISTENING_ON" ]]; then\n    echo "Error multiplex server did not start successfully. Below are the logs"\n    # Reading the logfile, to help with debugging\n    ls -al $MULTIPLEX_SERVER_LOGFILE || true\n    cat $MULTIPLEX_SERVER_LOGFILE || true\nfi\n\n\necho "Checking for code servers"\nif [[ -f $CODE_SERVER_PIDFILE ]]; then\n    CODE_SERVER_PID="$(cat $CODE_SERVER_PIDFILE)"\n    CODE_SERVER_RUNNING_PROCESS="$(ps -o pid,args -A | grep -w $CODE_SERVER_PID | grep $CODE_SERVER_SCRIPT)"\nelse\n    CODE_SERVER_RUNNING_PROCESS="$(ps -o pid,args -A | grep $CODE_SERVER_SCRIPT | grep -v grep)"\nfi\n\n# Making sure the token file and log files exists; otherwise we need to start a new server\nif [[ -z $CODE_SERVER_RUNNING_PROCESS || ! -f $CODE_SERVER_TOKENFILE || ! -f $CODE_SERVER_LOGFILE ]]; then\n    echo "Code server script is not running"\n    if [[ -f $CODE_SERVER_LOGFILE ]]; then\n        rm $CODE_SERVER_LOGFILE\n    fi\n    if [[ -f $CODE_SERVER_TOKENFILE ]]; then\n        rm $CODE_SERVER_TOKENFILE\n    fi\n\n    touch $CODE_SERVER_TOKENFILE\n    chmod 600 $CODE_SERVER_TOKENFILE\n    CODE_SERVER_CONNECTION_TOKEN="${lr.randomUUID()}"\n    echo $CODE_SERVER_CONNECTION_TOKEN > $CODE_SERVER_TOKENFILE\n\n    # This is super counterintuitive, but we UNSET the SSH_AUTH_SOCK before starting the server, because we manually inject it into the extension host later.\n    # This is to prevent us from being used across ALL connections by default\n\n    # Backing it up, NOT exporting it\n    if [[ -n "$SSH_AUTH_SOCK" ]]; then\n        ORIGINAL_SSH_AUTH_SOCK=$SSH_AUTH_SOCK\n        unset SSH_AUTH_SOCK\n    fi\n\n    echo "Starting code server script $CODE_SERVER_SCRIPT --start-server --host=127.0.0.1 --port 0 ${R} --connection-token-file $CODE_SERVER_TOKENFILE --telemetry-level off --enable-remote-auto-shutdown --accept-server-license-terms &> $CODE_SERVER_LOGFILE &"\n\n    $CODE_SERVER_SCRIPT --start-server --host=127.0.0.1 --port 0 ${R} --connection-token-file $CODE_SERVER_TOKENFILE --telemetry-level off --enable-remote-auto-shutdown --accept-server-license-terms &> $CODE_SERVER_LOGFILE &\n    echo $! > $CODE_SERVER_PIDFILE\n\n    # Restoring the original SSH_AUTH_SOCK\n    if [[ -n "$ORIGINAL_SSH_AUTH_SOCK" ]]; then\n        export SSH_AUTH_SOCK=$ORIGINAL_SSH_AUTH_SOCK\n        unset ORIGINAL_SSH_AUTH_SOCK\n    fi\nelse\n    echo "Code server script is already running $CODE_SERVER_SCRIPT. Running processes are $CODE_SERVER_RUNNING_PROCESS"\nfi\n\nif [[ -f $CODE_SERVER_TOKENFILE ]]; then\n    CODE_SERVER_CONNECTION_TOKEN="$(cat $CODE_SERVER_TOKENFILE)"\nelse\n    print_install_results_and_exit 1 "Code server token file not found: $CODE_SERVER_TOKENFILE"\nfi\n\nfor i in {1..20}; do\n    if [[ -f $CODE_SERVER_LOGFILE ]]; then\n        CODE_LISTENING_ON="$(cat $CODE_SERVER_LOGFILE | grep -E 'Extension host agent listening on .+' | sed 's/Extension host agent listening on //')"\n        if [[ -n "$CODE_LISTENING_ON" ]]; then\n            break\n        fi\n    fi\n    sleep 0.5\ndone\n\nif [[ -z "$CODE_LISTENING_ON" ]]; then\n    echo "Error code server did not start successfully"\n    # Reading the logfile, to help with debugging\n    ls -al $CODE_SERVER_LOGFILE || true\n    cat $CODE_SERVER_LOGFILE || true\n    print_install_results_and_exit 1 "Code server did not start successfully" "false"\nfi\nprint_install_results_and_wait`}function kr({id:t,line:e,commit:s,scpServerPath:r,serverShutdownTimeout:i,skipRemoteDownload:n,extensionIds:o,envVariables:a,serverInstallPath:h,serverApplicationName:l,forceReinstall:c,killRunningServers:u,serverDataFolderName:d,serverDownloadUrlTemplate:p,httpProxy:f,httpsProxy:m,noProxy:g}){h=(h=h.replace(/^~(?=$|\/|\\)/,"$(Resolve-Path ~)")).replaceAll("/","\\"),r=(r=r.replace(/^~(?=$|\/|\\)/,"$(Resolve-Path ~)")).replaceAll("/","\\"),h.endsWith(`\\${d}`)&&(h=h.slice(0,-1*(d.length+1)));const E=o.map((t=>"--install-extension "+t)).join(" "),S=p.replace(/\$\{line\}/g,e).replace(/\$\{commit\}/g,s).replace(/\$\{platform\}/g,"win32").replace(/\$\{arch\}/g,"x64"),w=p.replace(/\$\{line\}/g,e).replace(/\$\{commit\}/g,s).replace(/\$\{platform\}/g,"win32").replace(/\$\{arch\}/g,"arm64");return`${f?`$env:HTTP_PROXY = "${f}"\n$env:http_proxy = "${f}"\n        `:""}${m?`$env:HTTPS_PROXY = "${m}"\n$env:https_proxy = "${m}"\n        `:""}${g?`$env:NO_PROXY = "${g}"\n$env:no_proxy = "${g}"\n        `:""}\n$TMP_DIR="$env:TEMP\\$([System.IO.Path]::GetRandomFileName())"\n$ProgressPreference = "SilentlyContinue"\n\n$DISTRO_COMMIT="${s}"\n\n$SERVER_APP_NAME="${l}"\n$SERVER_INITIAL_EXTENSIONS="${E}"\n$SERVER_LISTEN_FLAG="--port=0"\n$SERVER_DATA_DIR="${h}\\${d}"\n"Server data directory: $SERVER_DATA_DIR"\n# The server reads this variable to know where to put the extensions/ and data/ folders\n$env:VSCODE_AGENT_FOLDER = "$SERVER_DATA_DIR"\n$env:VSCODE_SERVER_SHUTDOWN_TIMEOUT="${i}"\n$SERVER_DIR="$SERVER_DATA_DIR\\bin\\$DISTRO_COMMIT"\n$SERVER_NODE_EXECUTABLE="$SERVER_DIR\\node.exe"\n$SERVER_SCRIPT="$SERVER_DIR\\bin\\$SERVER_APP_NAME.cmd"\n$SERVER_LOGFILE="$SERVER_DATA_DIR\\.$DISTRO_COMMIT.log"\n$SERVER_PIDFILE="$SERVER_DATA_DIR\\.$DISTRO_COMMIT.pid"\n$SERVER_TOKENFILE="$SERVER_DATA_DIR\\.$DISTRO_COMMIT.token"\n$SERVER_ARCH=\n$SERVER_CONNECTION_TOKEN=\n$SERVER_DOWNLOAD_URL=\n$SERVER_PID=\n\n$LISTENING_ON=\n$OS_RELEASE_ID=\n$ARCH=\n$PLATFORM="win32"\n\n$SCRIPT_ID="${t}"\n\nfunction printInstallResults($code, $errorMessage, $isFatalError) {\n    "\${SCRIPT_ID}: start"\n    "exitCode==$code=="\n    "errorMessage==$errorMessage=="\n    "isFatalError==$isFatalError=="\n    "codeListeningOn==$LISTENING_ON=="\n    "codeConnectionToken==$SERVER_CONNECTION_TOKEN=="\n    "nodeExecutable==$SERVER_NODE_EXECUTABLE=="\n    "detectedPlatform==$PLATFORM=="\n    "arch==$SERVER_ARCH=="\n${a.map((t=>`"${t}==$${t}=="`)).join("\n")}\n    "\${SCRIPT_ID}: end"\n}\n\nfunction printInstallResultsAndExitClean($code, $errorMessage, $isFatalError) {\n    printInstallResults $code $errorMessage $isFatalError\n    exit $code\n}\n\n\nif ($${u} -or $${c}) {\n    Write-Host "Killing all running Cursor servers"\n    Get-Process node -ErrorAction SilentlyContinue | Where-Object Path -Like "$SERVER_DIR\\*" | Stop-Process -Force\n}\n\nif ($${c}) {\n    Write-Host "Removing all existing Cursor installations"\n    Remove-Item -Path "$SERVER_DATA_DIR/bin" -Recurse -Force -ErrorAction SilentlyContinue\n    Remove-Item -Path "$SERVER_DATA_DIR/*.log" -Force -ErrorAction SilentlyContinue\n    Remove-Item -Path "$SERVER_DATA_DIR/*.token" -Force -ErrorAction SilentlyContinue\n    Remove-Item -Path "$SERVER_DATA_DIR/.installation_lock" -Force -ErrorAction SilentlyContinue\n}\n\nfunction acquireLock() {\n    $lockFilePath = (Join-Path "$SERVER_DIR" "cursor-remote.lock")\n    try {\n        $null = ni $lockFilePath -it f -ea si\n    } catch {\n        "error creating lock file. - $($_.ToString())"\n    printInstallResultsAndExitClean 1 "Error creating lock file: $($_.ToString())" "false"\n    }\n\n    for($I = 1; $I -le ${Tr}; $I++) {\n        try {\n            "Acquiring lock $lockFilePath"\n            $global:lockFile = [System.io.File]::Open($lockFilePath, 'Open', 'Read', 'None')\n            break\n        } catch {\n            "Install in progress - $($_.ToString())"\n            sleep -Milliseconds 1000\n        }\n    }\n\n    if($I -le ${Tr}) {\n        "Lock acquired"\n    } else {\n        "Error could not acquire lock after $MAX_LOCK_ATTEMPTS attempts"\n    printInstallResultsAndExitClean 1 "Error could not acquire lock after $MAX_LOCK_ATTEMPTS attempts" "false"\n    }\n}\n\n# Check machine architecture\n$downloadUrl=\n$ARCH=$env:PROCESSOR_ARCHITECTURE\nif ($ARCH -eq "AMD64") {\n    "Architecture: $ARCH"\n    $SERVER_ARCH="x64"\n    $downloadUrl='${S}'\n} elseif ($ARCH -eq "ARM64") {\n    "Architecture: $ARCH"\n    $SERVER_ARCH="arm64"\n    $downloadUrl='${w}'\n} else {\n    "Error architecture not supported: $ARCH"\n    printInstallResultsAndExitClean 1 "Error architecture not supported: $ARCH" "true"\n}\n\n# Create installation folder\nif(!(Test-Path $SERVER_DIR)) {\n    try {\n        ni -it d $SERVER_DIR -f -ea si\n    } catch {\n        "Error creating server install directory $SERVER_DIR - $($_.ToString())"\n        printInstallResultsAndExitClean 1 "Error creating server install directory: $($_.ToString())" "false"\n    }\n\n    if(!(Test-Path $SERVER_DIR)) {\n        "Error creating server install directory $SERVER_DIR"\n        printInstallResultsAndExitClean 1 "Error creating server install directory" "false"\n    }\n}\n\ncd $SERVER_DIR\nacquireLock\n\ntry {\n# Check if server script is already installed\n    if(!(Test-Path $SERVER_SCRIPT)) {\n        del cursor-server.tar.gz\n\n        if(Test-Path "${r}") {\n            "Found existing server archive at ${r}, using it instead of downloading"\n            Move-Item "${r}" "cursor-server.tar.gz"\n        } else {\n            if($${n} -eq $true) {\n                "Server not found at ${r}, and remote download is disabled"\n                printInstallResultsAndExitClean 1 "Download failed: Failed to copy server from local client" "true"\n            }\n\n            "Downloading server from $downloadUrl"\n\n            $REQUEST_ARGUMENTS = @{\n                Uri="$downloadUrl"\n            TimeoutSec=20\n            OutFile="cursor-server.tar.gz"\n            UseBasicParsing=$True\n            }\n\n            [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\n\n            try {\n                Invoke-RestMethod @REQUEST_ARGUMENTS\n            } catch {\n                "Error downloading server: $($_.ToString())"\n                printInstallResultsAndExitClean 1 "Download failed: Failed to download server: $($_.ToString())" "false"\n            }\n        }\n\n        if(Test-Path "cursor-server.tar.gz") {\n            tar -xf cursor-server.tar.gz --strip-components 1\n\n            del cursor-server.tar.gz\n        }\n\n        if(!(Test-Path $SERVER_SCRIPT)) {\n            "Error while installing the server binary $SERVER_SCRIPT"\n        exit 1\n        }\n    }\nelse {\n        "Server script already installed in $SERVER_SCRIPT"\n    }\n\n# Try to find if server is already running\n    if(Get-Process node -ErrorAction SilentlyContinue | Where-Object Path -Like "$SERVER_DIR\\*") {\n        "Server script is already running $SERVER_SCRIPT"\n    }\nelse {\n        "Starting server $SERVER_SCRIPT"\n        if(Test-Path $SERVER_LOGFILE) {\n        del $SERVER_LOGFILE\n        }\n        if(Test-Path $SERVER_PIDFILE) {\n        del $SERVER_PIDFILE\n        }\n        if(Test-Path $SERVER_TOKENFILE) {\n        del $SERVER_TOKENFILE\n        }\n\n        $SERVER_CONNECTION_TOKEN="${lr.randomUUID()}"\n        [System.IO.File]::WriteAllLines($SERVER_TOKENFILE, $SERVER_CONNECTION_TOKEN)\n\n        $SCRIPT_ARGUMENTS="--start-server --host=127.0.0.1 $SERVER_LISTEN_FLAG $SERVER_INITIAL_EXTENSIONS --connection-token-file $SERVER_TOKENFILE --telemetry-level off --enable-remote-auto-shutdown --accept-server-license-terms *> '$SERVER_LOGFILE'"\n\n        $START_ARGUMENTS = @{\n            FilePath = "powershell.exe"\n        WindowStyle = "hidden"\n        ArgumentList = @(\n                "-ExecutionPolicy", "Unrestricted", "-NoLogo", "-NoProfile", "-NonInteractive", "-c", "$SERVER_SCRIPT $SCRIPT_ARGUMENTS"\n            )\n        PassThru = $True\n        }\n\n        $SERVER_ID = (start @START_ARGUMENTS).ID\n\n        if($SERVER_ID) {\n            [System.IO.File]::WriteAllLines($SERVER_PIDFILE, $SERVER_ID)\n        }\n    }\n\n    if(Test-Path $SERVER_TOKENFILE) {\n        $SERVER_CONNECTION_TOKEN="$(cat $SERVER_TOKENFILE)"\n    }\nelse {\n        "Error server token file not found $SERVER_TOKENFILE"\n    printInstallResultsAndExitClean 1 "Error server token file not found $SERVER_TOKENFILE" "false"\n    }\n\n    sleep -Milliseconds 500\n\n\n    $SELECT_ARGUMENTS = @{\n        Path = $SERVER_LOGFILE\n    Pattern = "Extension host agent listening on (\\d+)"\n    }\n\n    for($I = 1; $I -le 40; $I++) {\n        "Checking for server port from log file $SERVER_LOGFILE"\n        if(Test-Path $SERVER_LOGFILE) {\n            $GROUPS = (Select-String @SELECT_ARGUMENTS).Matches.Groups\n            if($GROUPS) {\n                $LISTENING_ON = $GROUPS[1].Value\n                "Listening on port: $LISTENING_ON"\n                break\n            }\n        }\n\n        sleep -Milliseconds 500\n    }\n\n} finally {\n    $lockFile.Close()\n}\n\nif (!$LISTENING_ON) {\n    "Error server did not start successfully. Could not extract server port from log file $SERVER_LOGFILE"\n    printInstallResultsAndExitClean 1 "Error server did not start successfully. Could not extract server port from log file $SERVER_LOGFILE" "false"\n}\n\nif(!(Test-Path $SERVER_LOGFILE)) {\n    "Error server log file not found $SERVER_LOGFILE"\n    printInstallResultsAndExitClean 1 "Error server log file not found $SERVER_LOGFILE" "false"\n}\n\nif(Test-Path $SERVER_PIDFILE) {\n    $SERVER_PID="$(cat $SERVER_PIDFILE)"\n}\n\nif(!$SERVER_PID) {\n    "Error server pid file not found $SERVER_PIDFILE"\n    printInstallResultsAndExitClean 1 "Error server pid file not found $SERVER_PIDFILE" "false"\n}\n\n# Finish server setup\nprintInstallResults 0 "" "false"\n\nwhile($True) {\n    if(!(gps -Id $SERVER_PID)) {\n        "server died, exit"\n    exit 0\n    }\n    sleep 30\n}\n`}async function Cr(t,e,s,{env:r,cwd:i}={}){const n=await t.spawn(e,s,{env:r,cwd:i});let o="",a="";n.stdout.onDidReceiveMessage((t=>{o+=Buffer.from(t).toString("utf-8")})),n.stderr.onDidReceiveMessage((t=>{a+=Buffer.from(t).toString("utf-8")}));const{status:h,message:l}=await n.onExit;if(0!==h)throw new Error(`Command failed with exit code ${h}${l?": "+l:""}: stdout: ${o}, stderr: ${a}`);return{stdout:o,stderr:a}}class Ar{constructor(t,e){this.logger=t,this.config=e}async copyToRemote({localPath:t,remotePath:s,hasRemoteCommand:r,env:i,isWindowsRemote:n}){const o=["-v"];r&&o.push("-o","RemoteCommand=none");let c,u=this.config.destination;for(const t of["ssh ","ssh.exe ",this.config.sshPath+" "])if(u.startsWith(t)){u=u.slice(t.length);break}try{let r;if(n||E){const e=await h.promises.readFile(t,"base64"),s=Math.floor(1e5*Math.random());c=l.join(a.tmpdir(),`cursor_remote_copy_${s}.b64`),this.logger.info(`Base64-encoding local file ${t} to temp file ${c}`),await h.promises.writeFile(c,e),t=c}if(n)if(s=(s=s.replace(/^~(?=$|\/|\\)/,"%USERPROFILE%")).replaceAll("/","\\"),E){const e=`"powershell -NoProfile -Command \`"^\`$input ^| Set-Content '${s}.temp'; Remove-Item -Force '${s}' -ErrorAction Ignore; certutil -decode '${s}.temp' '${s}'; echo 'wrote decoded'; Remove-Item -Force '${s}.temp' -ErrorAction Ignore\`""`;r=`type "${t}" | ${this.config.sshPath} ${o.join(" ")} ${u} ${e}`}else r=`\nCMD=$(cat <<'POWERSHELL_CMD_EOF'\npowershell -NoProfile -Command "$input | Set-Content '${s}.temp'; echo 'finished copy'; Remove-Item -Force '${s}' -ErrorAction Ignore; certutil -decode '${s}.temp' '${s}'; echo 'wrote decoded'; Remove-Item -Force '${s}.temp' -ErrorAction Ignore"\nPOWERSHELL_CMD_EOF\n)\ncat "${t}" | ${this.config.sshPath} ${o.join(" ")} ${u} "$CMD"`;else s=s.replace(/^~(?=$|\/|\\)/,"$HOME"),E?(s=s.replaceAll("$","`$"),r=`type "${t}" | ${this.config.sshPath} ${o.join(" ")} ${u} "bash -c \`'cat | (tr -d \`"[:space:]\`" || true) | (base64 -d 2>/dev/null || base64 -D || true) > \`"${s}\`"\`'"`):r=`cat "${t}" | ${this.config.sshPath} ${o.join(" ")} ${u} 'cat > "${s}"'`;this.logger.info(`Copying file to remote via SSH pipe: ${r}`),delete(i={...i}).ARGV0;const d=e.spawn(r,{env:i,shell:E?"powershell":"bash",detached:!E,windowsHide:!0});await async function(t,e,s){let r="",i="";s.stdout.on("data",(s=>{const i=Buffer.from(s).toString("utf-8");r+=i;const n=r.split("\n");r=n.pop()||"";for(const s of n)s.trim()&&t.info(`[${e}][stdout]: ${s.trim()}`)})),s.stdout.on("end",(()=>{r.trim()&&t.info(`[${e}][stdout]: ${r.trim()}`),r=""})),s.stderr.on("data",(s=>{const r=Buffer.from(s).toString("utf-8");i+=r;const n=i.split("\n");i=n.pop()||"";for(const s of n)s.trim()&&t.info(`[${e}][stderr]: ${s.trim()}`)})),s.stderr.on("end",(()=>{i.trim()&&t.info(`[${e}][stderr]: ${i.trim()}`),i=""}));const n=await new Promise(((t,e)=>{s.on("error",(t=>{e(t)})),s.on("close",((e,s)=>{t(e??0)}))}));if(r.trim()&&(t.info(`[${e}][stdout]: ${r.trim()}`),r=""),i.trim()&&(t.info(`[${e}][stderr]: ${i.trim()}`),i=""),0!==n)throw new Error(`[${e}] Command failed with exit code ${n}`)}(this.logger,"copyToRemote",d)}finally{if(c)try{await h.promises.unlink(c)}catch(t){this.logger.error(`Error deleting temp file ${c}: ${t}`)}}}async execHandler({hasRemoteCommand:t,env:r,command:i,shellCmdPrefix:n}){const o=["-v","-T"];t&&o.push("-o","RemoteCommand=none");const a=await new Promise(((t,e)=>{const r=s.createServer({pauseOnConnect:!0});r.on("error",e),r.on("listening",(()=>{const e=r.address().port;r.close((()=>t(e)))})),r.listen(0,"127.0.0.1")}));o.push("-D",`${a}`);let h=this.config.destination;for(const t of["ssh ","ssh.exe ",this.config.sshPath+" "])if(h.startsWith(t)){h=h.slice(t.length);break}return o.push(h),o.push(i),this.logger.info(`Launching SSH server via shell with command: ${n}${this.config.sshPath} ${o.join(" ")}`),delete(r={...r}).ARGV0,{process:e.spawn(`${n}${[this.config.sshPath,...o].join(" ")}`,{env:r,shell:!0,detached:!E,windowsHide:!0}),socksPort:a}}}const Lr=require("http"),xr=require("util");var Nr=function(t,e,s){if(null!=e){if("object"!=typeof e&&"function"!=typeof e)throw new TypeError("Object expected.");var r,i;if(s){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(void 0===r){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],s&&(i=r)}if("function"!=typeof r)throw new TypeError("Object not disposable.");i&&(r=function(){try{i.call(this)}catch(t){return Promise.reject(t)}}),t.stack.push({value:e,dispose:r,async:s})}else s&&t.stack.push({async:!0});return e},Pr=function(t){return function(e){function s(s){e.error=e.hasError?new t(s,e.error,"An error was suppressed during disposal."):s,e.hasError=!0}var r,i=0;return function t(){for(;r=e.stack.pop();)try{if(!r.async&&1===i)return i=0,e.stack.push(r),Promise.resolve().then(t);if(r.dispose){var n=r.dispose.call(r.value);if(r.async)return i|=2,Promise.resolve(n).then(t,(function(e){return s(e),t()}))}else i|=1}catch(t){s(t)}if(1===i)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}()}}("function"==typeof SuppressedError?SuppressedError:function(t,e,s){var r=new Error(s);return r.name="SuppressedError",r.error=t,r.suppressed=e,r});const Dr={end:()=>{},setAttribute:()=>{},setError:()=>{},spanContext:()=>{},[Symbol.dispose]:()=>{}};function Br(e){try{return t.tracing.span(e)}catch(t){return Dr}}const Mr="Switch to Anysphere Remote Containers",Fr="Reload Window";class Ur{constructor(t,e,s){this.commandServer=t,this.logger=e,this.platform=s}async stat(e){if(this.logger.info(`[remoteFileSystem][stat] path: ${e}`),e.includes("/cli/servers/Stable-")&&e.endsWith("/server/node"))throw t.window.showErrorMessage("The VSCode Remote Containers extension is not supported with the Anysphere Remote SSH extension. Please uninstall the VSCode Remote Containers extension and install the Anysphere Remote Containers extension instead.",Mr).then((async e=>{e===Mr&&(await t.commands.executeCommand("workbench.extensions.installExtension","anysphere.remote-containers"),await t.commands.executeCommand("workbench.extensions.uninstallExtension","ms-vscode-remote.remote-containers"),await t.window.showInformationMessage("Please reload Cursor to complete the installation of the Anysphere Remote Containers extension.",Fr)===Fr&&await t.commands.executeCommand("workbench.action.reloadWindow"))})).then(void 0,(t=>{this.logger.error(`Error switching to Anysphere Remote Containers: ${t}`)})),t.FileSystemError.FileNotFound(e);let s,r;if(this.platform===wr.Linux)s="--format=%F,%s,%Y,%X,%W";else{if(this.platform!=wr.MacOS)throw new Error(`Unsupported platform: ${this.platform}`);s="-f=%HT,%z,%m,%a,%B"}try{r=await this.commandServer.checkOutput("stat",[s,e])}catch(s){throw this.logger.error(`[remoteFileSystem][stat] Failed to stat file: ${s}`),t.FileSystemError.FileNotFound(e)}const[i,n,o,a,h]=r.trim().split(",");let l,c=i.toLowerCase();return l=c.includes("directory")?t.FileType.Directory:c.includes("symbolic link")?t.FileType.SymbolicLink:t.FileType.File,{type:l,size:parseInt(n),mtime:1e3*parseInt(o),ctime:1e3*parseInt(h)}}async mkdirp(t){this.logger.info(`[remoteFileSystem][mkdirp] path: ${t}`),await this.commandServer.checkOutput("mkdir",["-p",t])}async rm(t){this.logger.info(`[remoteFileSystem][rm] path: ${t}`),await this.commandServer.checkOutput("rm",["-rf",t])}async read(e){this.logger.info(`[remoteFileSystem][read] path: ${e}`);const s=await this.commandServer.spawn("cat",[e]),r=new t.EventEmitter;return s.stdout.onDidReceiveMessage((t=>{r.fire(t)})),{onDidReceiveMessage:r.event,onEnd:s.stdout.onEnd}}async write(t){this.logger.info(`[remoteFileSystem][write] path: ${t}`);const e=await this.commandServer.spawn("bash",["-c",`cat - > '${t}'`]);e.stderr.onDidReceiveMessage((t=>{this.logger.error(`[remoteFileSystem][write][stderr] ${Buffer.from(t).toString("utf-8")}`)})),e.stdout.onDidReceiveMessage((t=>{this.logger.error(`[remoteFileSystem][write][stdout] ${Buffer.from(t).toString("utf-8")}`)}));const s=new Promise(((t,s)=>{e.onExit.then((({status:e})=>{0===e?(this.logger.error("[remoteFileSystem][write] Finished writing file"),t()):(this.logger.error(`[remoteFileSystem][write] Failed to write to file. Exit code: ${e}`),s(new Error(`Failed to write to file. Exit code: ${e}`)))}),(t=>{this.logger.error("[remoteFileSystem][write] Failed to write to file",t),s(t)}))}));return{stream:e.stdin,done:s}}async connect(t){this.logger.info(`[remoteFileSystem][connect][${t}] connecting`);const e=`\nconst net = require('net');\nconst fs = require('fs');\nprocess.stdin.pause();\nconst client = net.createConnection({ path: '${t}'}, () => {\n\tconsole.error('Connection established');\n\tclient.pipe(process.stdout);\n\tprocess.stdin.pipe(client);\n});\nclient.on('close', function (hadError) {\n\tconsole.error(hadError ? 'Remote close with error' : 'Remote close');\n\tprocess.exit(hadError ? 1 : 0);\n});\nclient.on('error', function (err) {\n\tprocess.stderr.write(err && (err.stack || err.message) || String(err));\n});\nprocess.stdin.on('close', function (hadError) {\n\tconsole.error(hadError ? 'Remote stdin close with error' : 'Remote stdin close');\n\tprocess.exit(hadError ? 1 : 0);\n});\nprocess.on('uncaughtException', function (err) {\n\tfs.writeSync(process.stderr.fd, 'error: ' + (err.stack || err.message) + '\\n');\n\tprocess.exit(1);\n});`,{stdin:s,stdout:r,stderr:i,onExit:n}=await this.commandServer.spawn("node",["-e",e]);return i.onDidReceiveMessage((e=>{this.logger.error(`[remoteFileSystem][connect][${t}] stderr: ${Buffer.from(e).toString("utf-8")}`)})),{stream:{write:t=>s.write(t),end:()=>s.end(),onDidReceiveMessage:r.onDidReceiveMessage,onEnd:r.onEnd},done:new Promise(((e,s)=>{n.then((r=>{if(0!==r.status)return this.logger.error(`[remoteFileSystem][connect][${t}] Socket exited with status: ${r.status}: ${r.message}`),void s(new Error(`[remoteFileSystem][connect][${t}] Socket exited with status: ${r.status}: ${r.message}`));e()}),(t=>{s(t)}))}))}}async rename(t,e){this.logger.info(`[remoteFileSystem][rename] fromPath: ${t}, toPath: ${e}`),await this.commandServer.checkOutput("mv",[t,e])}async readdir(e){this.logger.info(`[remoteFileSystem][readdir] path: ${e}`);const s=(await this.commandServer.checkOutput("ls",["-la",e])).split("\n").slice(1),r=[];for(const e of s){if(""===e.trim())continue;const s=e.trim().split(/\s+/),i=s[s.length-1];if("."===i||".."===i)continue;let n=t.FileType.File;s[0].startsWith("d")?n=t.FileType.Directory:s[0].startsWith("l")&&(n=t.FileType.SymbolicLink),r.push({name:i,type:n})}return r}}class Vr{constructor(e,s,r,i,n,o){this.server=e,this.logger=s,this.remoteAddress=r,this.localAddress=i,this.protocol=n,this.privacy=o,this._dispose_event_emitter=new t.EventEmitter,this.onDidDispose=this._dispose_event_emitter.event,e.on("error",(t=>{this.logger.error("[tunnel] server threw an error",t),this.dispose()}))}dispose(){this.logger.info(`[tunnel] disposing of tunnel (remote) ${this.remoteAddress.host}:${this.remoteAddress.port} -> (local) ${this.localAddress.host}:${this.localAddress.port}`),this.server.close((t=>{void 0!==t&&this.logger.error("[tunnel] server threw an error when closing",t)})),this._dispose_event_emitter.fire()}}async function Hr(t,e,i){const n=s.createServer(),o=e.remoteAddress.port,a=e.localAddressPort??0;n.on("connection",(s=>{s.pause();const n=lr.randomUUID(),a=i();if(void 0===a)return t.error("[tunnel-forwarding] socksPort is undefined"),void s.destroy();const h={proxy:{host:"127.0.0.1",port:a,type:5},command:"connect",destination:{host:e.remoteAddress.host,port:o}};r.SocksClient.createConnection(h).then((r=>{r.socket.on("error",(r=>{t.error(`[tunnel-forwarding][127.0.0.1:${c} -> 127.0.0.1:${a} -> ${e.remoteAddress.host}:${e.remoteAddress.port}][${n}] socks connection threw an error`,r),s.destroy()})),s.on("error",(s=>{t.error(`[tunnel-forwarding][127.0.0.1:${c} -> 127.0.0.1:${a} -> ${e.remoteAddress.host}:${e.remoteAddress.port}][${n}] local connection threw an error`,s),r.socket.destroy()})),r.socket.on("close",(()=>{t.info(`[tunnel-forwarding][127.0.0.1:${c} -> 127.0.0.1:${a} -> ${e.remoteAddress.host}:${e.remoteAddress.port}][${n}] socks connection closed`)})),s.on("close",(()=>{t.info(`[tunnel-forwarding][127.0.0.1:${c} -> 127.0.0.1:${a} -> ${e.remoteAddress.host}:${e.remoteAddress.port}][${n}] local connection closed`)})),t.info(`[tunnel-forwarding][127.0.0.1:${c} -> 127.0.0.1:${a} -> ${e.remoteAddress.host}:${e.remoteAddress.port}][${n}] resuming socket`),s.resume(),s.pipe(r.socket),r.socket.pipe(s),t.info(`[tunnel-forwarding][127.0.0.1:${c} -> 127.0.0.1:${a} -> ${e.remoteAddress.host}:${e.remoteAddress.port}][${n}] socks forwarding established`)})).catch((r=>{t.error(`[tunnel-forwarding][127.0.0.1:${c} -> 127.0.0.1:${a} -> ${e.remoteAddress.host}:${e.remoteAddress.port}][${n}] error while creating socks forwarding`,r),s.destroy()}))}));let h=0===a;const l=new Promise(((s,r)=>{n.on("error",(e=>{if(!h)return t.error("[tunnel-forwarding] server threw an error; trying again on port 0",e),n.listen(0,"127.0.0.1"),void(h=!0);t.error("[tunnel-forwarding] server threw an error",e),r(e)})),n.on("listening",(()=>{const i=n.address();if("string"==typeof i||null===i)return void r(new Error(`Invalid address: ${i}`));const o=i.port;t.info(`[tunnel-forwarding][127.0.0.1:${o} -> ${e.remoteAddress.host}:${e.remoteAddress.port}] server listening`),s(o)}))}));n.listen(a,"127.0.0.1"),n.on("close",(()=>{t.info(`[tunnel-forwarding][127.0.0.1:${c} -> ${e.remoteAddress.host}:${e.remoteAddress.port}] server closed`)}));const c=await l;return new Vr(n,t,e.remoteAddress,{port:c,host:"127.0.0.1"},e.protocol,e.privacy)}class jr{constructor(t,e,s,r){if(this.commandServer=t,this.platform=e,this.logger=s,this.socksPortGetter=r,e===wr.Windows)throw new Error("Hopping through windows remote servers is not supported");this.fs=new Ur(t,s,e)}async spawn(t,e,s){return this.logger.info(`[execServer][spawn] command: ${t}, args: ${e}, options: ${JSON.stringify(s)}`),await this.commandServer.spawn(t,e,s)}async env(){this.logger.info("[execServer][env]");const t=await this.commandServer.checkOutput("printenv");let e;switch(this.platform){case wr.Linux:e="linux";break;case wr.MacOS:e="darwin";break;case wr.Windows:e="win32";break;default:throw new Error(`Unsupported platform: ${this.platform}`)}return{env:Object.fromEntries(t.trim().split("\n").map((t=>t.split("=",2)))),osPlatform:e,osRelease:void 0}}async kill(t){this.logger.info(`[execServer][kill] processId: ${t}`),await this.commandServer.checkOutput("kill",["-9",t.toString()])}async tcpForward(t){return await Hr(this.logger,t,this.socksPortGetter)}async tcpConnect(t,e){this.logger.info(`[execServer][tcpConnect] host: ${t}, port: ${e}`);const s=`\nconst net = require('net');\nconst fs = require('fs');\nprocess.stdin.pause();\nconst client = net.createConnection({ host: '${t}', port: ${e}}, () => {\n\tconsole.error('Connection established');\n\tclient.pipe(process.stdout);\n\tprocess.stdin.pipe(client);\n});\nclient.on('close', function (hadError) {\n\tconsole.error(hadError ? 'Remote close with error' : 'Remote close');\n\tprocess.exit(hadError ? 1 : 0);\n});\nclient.on('error', function (err) {\n\tprocess.stderr.write(err && (err.stack || err.message) || String(err));\n});\nprocess.stdin.on('close', function (hadError) {\n\tconsole.error(hadError ? 'Remote stdin close with error' : 'Remote stdin close');\n\tprocess.exit(hadError ? 1 : 0);\n});\nprocess.on('uncaughtException', function (err) {\n\tfs.writeSync(process.stderr.fd, 'error: ' + (err.stack || err.message) + '\\n');\n\tprocess.exit(1);\n});`,{stdin:r,stdout:i,stderr:n,onExit:o}=await this.commandServer.spawn("node",["-e",s]);return n.onDidReceiveMessage((t=>{this.logger.error(`[tcpConnect] stderr: ${t}`)})),{stream:{write:t=>r.write(t),end:()=>r.end(),onDidReceiveMessage:i.onDidReceiveMessage,onEnd:i.onEnd},done:new Promise(((t,e)=>{o.then((()=>{t()}),(t=>{e(t)}))}))}}}var Gr=i(4615);class zr{constructor(t,e,s,r,i,n){this.remoteServerPort=t,this.token=e,this.logger=s,this.envVars=r,this.remoteNodePath=i,this.pingIntervalMs=n,this.disposed=!1,this.pingUntilShutdown()}async pingUntilShutdown(){for(;!this.disposed;)this.logger.info(`[remote-ssh] Pinging remote server on port ${this.remoteServerPort}`),await this.checkOutput("echo",["1"]),await new Promise((t=>setTimeout(t,this.pingIntervalMs)))}spawn(e,r,i){return new Promise(((n,o)=>{const a=lr.randomUUID(),h=s.createConnection(this.remoteServerPort,"127.0.0.1",(()=>{const s={...this.envVars,...i?.env};delete s.ARGV0,"node"===e&&(e=this.remoteNodePath);const o={command:e,args:r,env:s,cwd:i?.cwd,token:this.token,id:a};this.logger.info(`[command][${a}] Sending command request: ${JSON.stringify(o)}`),h.write(JSON.stringify(o)+"\n");const l=new t.EventEmitter,c=new t.EventEmitter;let u,d;const p=new Promise(((t,e)=>{u=t,d=e}));let f;const m=new Promise((t=>{f=t}));let g;const E=new Promise((t=>{g=t})),S=Gr();h.pipe(S),S.on("data",(t=>{try{const e=JSON.parse(t);if("stdout"===e.type&&void 0!==e.data){const t=Buffer.from(e.data,"base64");l.fire(new Uint8Array(t))}else if("stderr"===e.type&&void 0!==e.data){const t=Buffer.from(e.data,"base64");c.fire(new Uint8Array(t))}else if("exit"===e.type)this.logger.info(`[command][${a}] Process exited with code ${e.code||0}`),u({status:e.code||0}),f(),g(),h.end(),h.destroy();else if("stdout-end"===e.type)f();else{if("stderr-end"!==e.type)throw new Error(`[command][${a}] Unexpected response: ${t}`);g()}}catch(e){this.logger.error(`[command][${a}] Error parsing ${t}: ${e}`),d(e),h.destroy()}})),h.on("close",(()=>{this.logger.info(`[command][${a}] Socket close event received`),f(),g(),d(new Error(`[command][${a}] Socket closed without exit code`))})),h.on("end",(()=>{this.logger.info(`[command][${a}] Socket end event received`)})),n({stdout:{onDidReceiveMessage:l.event,onEnd:m},stderr:{onDidReceiveMessage:c.event,onEnd:E},onExit:p,stdin:{write:t=>!h.destroyed&&(h.write(Buffer.from(t).toString("base64")),!0),end:()=>{this.logger.info(`[command][${a}] Stdin end`),h.write(Buffer.from([0]))}}})}));h.on("error",(t=>{this.logger.error(`[command][${a}] Socket error: ${t}`),o(t)}))}))}async checkOutput(t,e,s){const r=await this.spawn(t,e,s);let i="",n="";r.stdout.onDidReceiveMessage((t=>{const e=(new TextDecoder).decode(t);i+=e})),r.stderr.onDidReceiveMessage((t=>{const e=(new TextDecoder).decode(t);n+=e}));const o=await r.onExit;if(0!==o.status)throw new Error(`Command '${t} ${e?.join(" ")||""}' failed with exit code ${o.status}: stdout: ${i}, stderr: ${n}`);return i}dispose(){this.disposed=!0}}var Wr=function(t){return function(e){function s(s){e.error=e.hasError?new t(s,e.error,"An error was suppressed during disposal."):s,e.hasError=!0}var r,i=0;return function t(){for(;r=e.stack.pop();)try{if(!r.async&&1===i)return i=0,e.stack.push(r),Promise.resolve().then(t);if(r.dispose){var n=r.dispose.call(r.value);if(r.async)return i|=2,Promise.resolve(n).then(t,(function(e){return s(e),t()}))}else i|=1}catch(t){s(t)}if(1===i)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}()}}("function"==typeof SuppressedError?SuppressedError:function(t,e,s){var r=new Error(s);return r.name="SuppressedError",r.error=t,r.suppressed=e,r});const Xr=(0,xr.promisify)(e.execFile),Kr="ssh-remote";function qr(t){return"cursor-remote-ssh.reinstall."+t}function Yr(t){return"cursor-remote-ssh.kill-running-servers."+t}function Zr(t){return`${Kr}+${t}`}class Jr{constructor(e,s){this.context=e,this.logger=s,this.askpassStartedEventEmitter=new t.EventEmitter,this.askpassFinishedEventEmitter=new t.EventEmitter,this.tunnelFactory=t=>Hr(this.logger,t,(()=>this.remoteServer?.socksPort))}terminateProcessSync(t){if(E)e.execFileSync("taskkill",["/T","/F","/PID",t.pid.toString()],{stdio:["pipe","pipe","ignore"]});else if(w||S){const s=l.join(this.context.extensionPath,"dist","scripts","terminateProcess.sh");try{h.chmodSync(s,493)}catch(t){this.logger.error(`Error setting permissions on terminate script: ${t}`)}const r=e.spawnSync(s,[t.pid.toString()]);if(r.error)throw r.error}else t.kill("SIGKILL")}async checkForOpenSSH(t){try{await Xr(t,["-V"])}catch(e){throw new Error(`${t} -V failed - do you have OpenSSH installed?`)}}async setupAskpassServer(){if(void 0!==this.askpassServer){const t=this.askpassServer.address();if(null===t)throw new Error("Askpass server already setup but address is null");return"string"==typeof t?t:t.port.toString()}const e=Lr.createServer((async(e,s)=>{if(this.logger.info(`Askpass server received request: ${e.method} ${e.url}`),"POST"===e.method){let r="";for await(const t of e)r+=t.toString();this.logger.info(`Askpass server received request body: ${r}`),this.askpassStartedEventEmitter.fire();try{const e=JSON.parse(r);if(this.logger.info(`Received SSH askpass request: ${e.request}`),e.request.includes("The authenticity of host")&&e.request.includes("can't be established"))"Yes"===await t.window.showQuickPick(["Yes","No"],{title:e.request+" Do you want to trust this host?",placeHolder:"Yes"})?(s.writeHead(200,{"Content-Type":"text/plain"}),s.end("yes")):(s.writeHead(200,{"Content-Type":"text/plain"}),s.end("no"));else{const r=await t.window.showInputBox({title:e.request,password:!0,ignoreFocusOut:!0});void 0===r?(this.logger.error("Password authentication cancelled"),s.writeHead(500,{"Content-Type":"text/plain"}),s.end("Password authentication cancelled")):(s.writeHead(200,{"Content-Type":"text/plain"}),s.end(r||""))}}catch(t){this.logger.error(`Error parsing request: ${t}`),s.writeHead(400,{"Content-Type":"text/plain"}),s.end("Invalid request format")}finally{this.askpassFinishedEventEmitter.fire()}}else s.writeHead(405,{"Content-Type":"text/plain"}),s.end("Method Not Allowed")}));this.askpassServer=e;const s=new Promise(((t,s)=>{e.on("error",(t=>{this.logger.error("SSH askpass server threw an error",t),s(t)})),e.on("listening",(()=>{const r=e.address();if(null!==r){if("string"==typeof r)return this.logger.info(`SSH askpass server listening on ${r}`),void t(r);this.logger.info(`SSH askpass server listening on port ${r.port}`),t(r.port.toString())}else s(new Error(`Invalid address: ${r}`))}))}));if(E)e.listen(0,"127.0.0.1");else{const t=await h.promises.mkdtemp(l.join(a.tmpdir(),"cursor-ssh-")),s=l.join(t,"socket.sock");e.listen(s)}return await s}async setupForwardingServer(t,e,i,n,o){const a=e();if(void 0!==a){const e=a.address();if(null===e)throw new Error(`[forwarding][${t}] Server address should not be null`);if("string"==typeof e)throw new Error(`[forwarding][${t}] Server address should not be a string, since we always listen on a port`);return this.logger.info(`[forwarding][${t}] returning existing forwarding server listening on local port ${e.port}`),e.port}this.logger.info(`[forwarding][${t}] creating new forwarding server`);const h=s.createServer(),l=new Promise(((s,r)=>{h.on("listening",(()=>{const e=h.address();if("string"==typeof e||null===e)return void r(new Error(`Invalid address: ${e}`));const i=e.port;this.logger.info(`[forwarding][${t}] server listening on ${i}`),s(i)})),h.on("error",(s=>{this.logger.error(`[forwarding][${t}] server threw an error`,s),e()===h&&i(void 0),r(s),h.close()}))}));h.on("connection",(e=>{const s=lr.randomUUID();e.pause();const i=n();if(void 0===i)return this.logger.error(`[forwarding][${t}][127.0.0.1:${c} -> 127.0.0.1:${i}][${s}] remote server not configured`),void e.destroy();if(this.logger.info(`[forwarding][${t}][127.0.0.1:${c} -> 127.0.0.1:${i}][${s}] received connection request`),void 0===this.remoteServer)return this.logger.error(`[forwarding][${t}][127.0.0.1:${c} -> 127.0.0.1:${i}][${s}] remote server not configured`),void e.destroy();const o=this.remoteServer.socksPort;r.SocksClient.createConnection({proxy:{host:"127.0.0.1",port:o,type:5},command:"connect",destination:{host:"127.0.0.1",port:i}}).then((r=>{r.socket.on("error",(n=>{this.logger.error(`[forwarding][${t}][127.0.0.1:${c} -> 127.0.0.1:${o} -> 127.0.0.1:${i}][${s}] socks connection threw an error`,n),e.destroy(),r.socket.destroy()})),r.socket.on("close",(()=>{this.logger.info(`[forwarding][${t}][127.0.0.1:${c} -> 127.0.0.1:${o} -> 127.0.0.1:${i}][${s}] socks connection closed`)})),e.on("error",(e=>{this.logger.info(`[forwarding][${t}][127.0.0.1:${c} -> 127.0.0.1:${o} -> 127.0.0.1:${i}][${s}] local connection threw an error`,e),r.socket.destroy()})),e.resume(),e.pipe(r.socket),r.socket.pipe(e),this.logger.info(`[forwarding][${t}][127.0.0.1:${c} -> 127.0.0.1:${o} -> 127.0.0.1:${i}][${s}] socks forwarding established`)})).catch((r=>{this.logger.error(`[forwarding][${t}][127.0.0.1:${c} -> 127.0.0.1:${o} -> 127.0.0.1:${i}][${s}] error while creating socks forwarding`,r),e.destroy()}))})),h.listen(0,"127.0.0.1");const c=await Promise.race([l,new Promise(((t,e)=>{o.addEventListener("abort",(()=>{e(new Error("Timeout while waiting for forwarding server to listen"))}),{once:!0})}))]);return i(h),this.logger.info(`[forwarding][${t}] Set up server`),c}oldParseAuthority(t){const e=o.parseEncoded(t).toString(),s=e.match(/^ssh-remote\+(?:([^@]+)@)?([^:]+)(?::(\d+))?$/);if(!s)throw new Error(`Invalid authority format: ${e}`);let[,r,i,n]=s;return i?.startsWith("ssh ")?i=i.substring(4):i?.startsWith("ssh.exe ")&&(i=i.substring(8)),r?.startsWith("ssh ")?r=r.substring(4):r?.startsWith("ssh.exe ")&&(r=r.substring(8)),n?.startsWith("ssh ")?n=n.substring(4):n?.startsWith("ssh.exe ")&&(n=n.substring(8)),new o(i,r,n?parseInt(n,10):void 0)}async ensureServerIsConnected(t){const e=this.execServer,s=this.localCodePort;if(void 0===s)throw new Error("Local code port is not set");for(let e=0;e<3;e++){let r;try{if(200===(await fetch(`http://127.0.0.1:${s}/version`,{signal:t})).status){this.logger.info(`Successfully connected to Cursor server at http://127.0.0.1:${s}/version`);break}}catch(t){r=t}if(this.logger.error(`Failed to connect to Cursor server at http://127.0.0.1:${s}, attempt ${e+1} of 3`,r),2===e)throw new Error("Failed to connect to Cursor code server. Ensure that your remote host ssh config has 'AllowTcpForwarding yes' in '/etc/ssh/sshd_config'. Please check the logs and try reinstalling the server.");await new Promise(((e,s)=>{const r=setTimeout(e,1e3);t.addEventListener("abort",(()=>{s(new Error("Timeout while waiting for exec server to respond")),clearTimeout(r)}),{once:!0})}))}if(e){const{stdout:s}=await Promise.race([Cr(e,"echo",["1"]),new Promise(((e,s)=>{t.addEventListener("abort",(()=>{s(new Error("Timeout while waiting for exec server to respond"))}),{once:!0})}))]);if("1"!==s.trim())throw new Error(`Failed to connect to Cursor multiplex server (got '${s.trim()}'; expected '1'). Ensure that your remote host ssh config has 'AllowTcpForwarding yes' in '/etc/ssh/sshd_config'. Please check the logs and try reinstalling the server.`);this.logger.info("Successfully ran 'echo 1' against the multiplex server")}}async setupForwardingServers(e){const s=this.remoteServer;if(void 0===s)throw new Error("Remote server is not set");this.localCodePort=await this.setupForwardingServer("code",(()=>this.codeServerForwarding),(t=>this.codeServerForwarding=t),(()=>this.remoteServer?.listeningOn),e),this.logger.info(`[remote-ssh] codeListeningOn (remote=${s.listeningOn}; local=${this.localCodePort}) codeConnectionToken: ${s.codeConnectionToken}`);const r=void 0===s.multiplexListeningOn?void 0:await this.setupForwardingServer("multiplex",(()=>this.multiplexForwarding),(t=>this.multiplexForwarding=t),(()=>this.remoteServer?.multiplexListeningOn),e);let i;if(void 0!==r&&void 0!==s.multiplexConnectionToken){this.logger.info(`[remote-ssh] multiplexListeningOn (remote=${s.multiplexListeningOn}; local=${r}) multiplexConnectionToken: ${s.multiplexConnectionToken}`);const e=Math.min(1e3*Math.floor(t.workspace.getConfiguration("remote.SSH").get("serverShutdownTimeout",60)/3),6e4),n=new zr(r,s.multiplexConnectionToken,this.logger,s.envVars,s.remoteNodeExecutable,e);this.commandServer?.dispose(),this.commandServer=n,i=new jr(n,s.platform,this.logger,(()=>this.remoteServer?.socksPort))}this.execServer=i}makeResolvedAuthority(){if(void 0===this.remoteServer)throw new Error("Remote server must be set if connection is valid!");if(void 0===this.localCodePort)throw new Error("Local code port must be set if connection is valid!");{const e=new t.ResolvedAuthority("127.0.0.1",this.localCodePort,this.remoteServer.codeConnectionToken);return e.extensionHostEnv=this.remoteServer.envVars,this.logger.info(`[remote-ssh] Resolved authority: ${JSON.stringify(e)}. Socks port: ${this.remoteServer.socksPort}`),e}}async resolve(e,s){const r={stack:[],error:void 0,hasError:!1};try{if(!e.startsWith("ssh-remote+"))throw new Error(`Invalid authority format: ${e}`);let i;try{i=o.parseAuthorityNew(e.substring(11))}catch{i=this.oldParseAuthority(e)}this.logger.info(`Resolving ssh remote authority '${i}' (Unparsed '${e}') (attempt #${s.resolveAttempt})`);const n=t.workspace.getConfiguration("remote.SSH").get("path","ssh");let a=t.workspace.getConfiguration("remote.SSH").get("localServerDownload","auto");["off","auto","always"].includes(a)||(this.logger.error(`Invalid value for remote.SSH.localServerDownload. Must be one of: off, auto, always: ${a}`),a="auto");const h=1e3*t.workspace.getConfiguration("remote.SSH").get("connectTimeout",180),l=t.workspace.getConfiguration("remote.SSH").get("defaultExtensions",[]),c=function(t,e,s){if(null!=e){if("object"!=typeof e&&"function"!=typeof e)throw new TypeError("Object expected.");var r,i;if(s){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(void 0===r){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],s&&(i=r)}if("function"!=typeof r)throw new TypeError("Object not disposable.");i&&(r=function(){try{i.call(this)}catch(t){return Promise.reject(t)}}),t.stack.push({value:e,dispose:r,async:s})}else s&&t.stack.push({async:!0});return e}(r,Br("cursor-remote-ssh.resolveAuthority"),!1);if(s.resolveAttempt>1){let t=!1;const e=new AbortController,s=setTimeout((()=>{e.abort()}),3e3);try{await Promise.race([(async()=>{try{this.logger.info("Received re-connection request; checking to see if existing connection is still valid"),await this.ensureServerIsConnected(e.signal),t=!0}catch(s){try{this.logger.error("Could not re-use existing SOCKS connection; attempting to re-establish SOCKS forwarding",s),await this.setupForwardingServers(e.signal),await this.ensureServerIsConnected(e.signal),t=!0}catch(t){this.logger.error("Could not re-establish SOCKS forwarding; re-establishing entire SSH connection",t)}}})(),new Promise(((t,s)=>{e.signal.addEventListener("abort",(()=>{s(new Error("Timeout while checking if existing connection is still valid"))}),{once:!0})}))])}catch(t){this.logger.error("Unexpected error while checking if existing connection is still valid",t)}finally{clearTimeout(s)}if(t)return this.logger.info("Reusing existing connection"),this.makeResolvedAuthority()}try{return await t.window.withProgress({location:t.ProgressLocation.Notification,title:"Setting up SSH Host ([details](command:opensshremotes.showLog))",cancellable:!0},((r,o)=>Promise.race([(async()=>{r.report({message:"Starting Remote SSH..."});const u=void 0!==(await hr.loadFromFS()).getHostConfiguration(i.hostname).RemoteCommand;await this.checkForOpenSSH(n);const d=await this.setupAskpassServer(),p=new Ar(this.logger,{sshPath:n,destination:i.toConnectionString(),host:i.hostname});if(void 0!==this.remoteServer){this.logger.info(`Terminating existing SSH process with pid: ${this.remoteServer.opensshProcess.pid}`);try{this.terminateProcessSync(this.remoteServer.opensshProcess)}catch(t){this.logger.error("Failed to terminate existing SSH process",t)}this.remoteServer=void 0}const f=this.context.globalState.get(qr(e),!1),m=this.context.globalState.get(Yr(e),!1),{codeConnectionToken:g,codeListeningOn:E,multiplexConnectionToken:S,multiplexListeningOn:w,subprocess:v,envVars:R,socksPort:y,platform:_,remoteNodeExecutable:I}=await br({conn:p,logger:this.logger,hasRemoteCommand:u,extensionFolder:this.context.extensionPath,timeoutMs:h,forceReinstall:f,localServerDownload:a,resolveAttempt:s.resolveAttempt,defaultExtensions:l,askpassHandle:d,progress:r,cancellationToken:o,killRunningServers:m,askpassStartedEvent:this.askpassStartedEventEmitter.event,askpassFinishedEvent:this.askpassFinishedEventEmitter.event});this.remoteServer={opensshProcess:v,listeningOn:E,multiplexListeningOn:w,codeConnectionToken:g,socksPort:y,multiplexConnectionToken:S,envVars:R,remoteNodeExecutable:I,platform:_};const b=new AbortController,$=setTimeout((()=>{b.abort()}),5e3);try{await this.setupForwardingServers(b.signal),await this.ensureServerIsConnected(b.signal)}finally{clearTimeout($)}this.logger.info(`[remote-ssh] Resolved exec server. Socks port: ${y}`),void 0!==this.labelFormatterDisposable&&this.labelFormatterDisposable.dispose(),this.labelFormatterDisposable=t.workspace.registerResourceLabelFormatter({scheme:"vscode-remote",authority:`${e}*`,formatting:{label:"${path}",separator:"/",tildify:!0,workspaceSuffix:`SSH: ${i.hostname}`}}),this.context.environmentVariableCollection.persistent=!1;for(const[t,e]of Object.entries(R))this.logger.info(`[remote-ssh] Setting environment variable ${t}=${e}`),this.context.environmentVariableCollection.replace(t,e);const T=this.makeResolvedAuthority();return await this.context.globalState.update(qr(e),void 0),await this.context.globalState.update(Yr(e),void 0),c.setAttribute("success",!0),T})(),new Promise(((t,e)=>{o.isCancellationRequested?e(new Error("Cancelled")):o.onCancellationRequested((()=>{e(new Error("Cancelled"))}))}))])))}catch(s){c.setAttribute("success",!1);const r=s instanceof Error?s.message:String(s);c.setError(r),this.logger.error("Error resolving SSH authority",s),this.logger.show();const i="Reload Window",n="Reinstall Server",o=await t.window.showErrorMessage(`Connection to Cursor server failed: ${r}`,i,n);throw o===i?(this.logger.info("Reloading window"),await t.commands.executeCommand("workbench.action.reloadWindow")):o===n&&(await this.context.globalState.update(qr(e),!0),await t.commands.executeCommand("workbench.action.reloadWindow")),t.RemoteAuthorityResolverError.NotAvailable(s.message,!0)}}catch(t){r.error=t,r.hasError=!0}finally{Wr(r)}}async resolveExecServer(t,e){if(e.execServer)throw new Error("Nested exec servers over SSH are not supported. Instead, please use jump hosts via the SSH config.");if(void 0!==this.remoteServer&&void 0===this.execServer)throw new Error("Windows SSH hosts are not supported for intermediate resolvers (1)");if(0===e.resolveAttempt&&void 0!==this.execServer)return this.logger.info("[remote-ssh][resolveExecServer] Returning exec server from initial connection"),this.execServer;if(this.logger.info("[remote-ssh][resolveExecServer] Resolving connection"),await this.resolve(t,e),void 0===this.execServer)throw new Error("Windows SSH hosts are not supported for intermediate resolvers (2)");return this.logger.info("[remote-ssh][resolveExecServer] Returning exec server from newly resolved connection"),this.execServer}async killForwardingServers(){void 0!==this.remoteServer?.opensshProcess&&this.terminateProcessSync(this.remoteServer.opensshProcess),await Promise.all([new Promise(((t,e)=>{void 0!==this.codeServerForwarding?this.codeServerForwarding.close((s=>{this.logger.info("[forwarding] code server forwarding closed"),this.codeServerForwarding=void 0,s?e(s):t()})):t()})),new Promise(((t,e)=>{void 0!==this.multiplexForwarding?this.multiplexForwarding.close((s=>{this.logger.info("[forwarding] multiplex forwarding closed"),this.multiplexForwarding=void 0,s?e(s):t()})):t()}))])}dispose(){this.labelFormatterDisposable?.dispose(),void 0!==this.remoteServer?.opensshProcess&&this.terminateProcessSync(this.remoteServer.opensshProcess),void 0!==this.askpassServer&&this.askpassServer.close((()=>{this.logger.info("Askpass server closed")})),this.codeServerForwarding?.close((()=>{this.logger.info("[forwarding] code server forwarding closed")})),this.multiplexForwarding?.close((()=>{this.logger.info("[forwarding] multiplex forwarding closed")})),this.askpassStartedEventEmitter.dispose(),this.askpassFinishedEventEmitter.dispose(),this.commandServer?.dispose()}}async function Qr(){const e=t.window.createQuickPick(),s={current:[]},r={current:void 0},i=[{label:"$(add) Add New SSH Host...",alwaysShow:!0},{label:"Configure SSH Hosts...",alwaysShow:!0}],n=()=>{e.items=[...s.current,...i,...r.current?[r.current]:[]]};hr.loadFromFS().then((t=>{const e=t.getAllConfiguredHosts();s.current=e.map((t=>({label:t}))),n()})),e.placeholder="e.g. ubuntu@ec2-3-106-99.amazonaws.com, or named host below",e.title="Select configured SSH host or enter user@host",n();const a=[];try{return await new Promise(((t,s)=>{a.push(e.onDidChangeValue((t=>{t.length>0?r.current={label:` ${t}`,alwaysShow:!0}:r.current=void 0,n()})),e.onDidAccept((async()=>{const s=e.selectedItems[0];if(!s)return void t(void 0);if(s.label===i[0].label)return await si(),e.hide(),void t(void 0);if(s.label===i[1].label)return await ri(),e.hide(),void t(void 0);let n;n=r.current?.label===s.label?r.current.label.substr(2).trim():s.label,n=n.replaceAll("\\\\","\\").replaceAll("\\","\\\\");const a=new o(n);t(a),e.hide()})),e.onDidHide((()=>{t(void 0),e.dispose()}))),e.show()}))}finally{a.forEach((t=>t.dispose()))}}async function ti(t,e){const s=await Qr();if(s)return await ei(s.toEncodedString(),t)}function ei(e,s){return t.commands.executeCommand("vscode.newWindow",{remoteAuthority:Zr(e),reuseWindow:s})}async function si(){const e=er();await f(e)||(await h.promises.mkdir((0,l.dirname)(e),{recursive:!0}),await h.promises.writeFile(e,"")),await t.commands.executeCommand("vscode.open",t.Uri.file(e),{preview:!1});const s=t.window.activeTextEditor;if(s?.document.uri.fsPath!==e)return;const r=s.document,i=r.lineAt(r.lineCount-1);i.isEmptyOrWhitespace||await s.edit((t=>{t.insert(i.range.end,"\n")})),await s.insertSnippet(new t.SnippetString("\nHost ${1:dev}\n\tHostName ${2:dev.example.com}\n\tUser ${3:john}"),new t.Position(r.lineCount,0))}async function ri(){const e=er();await f(e)||(await h.promises.mkdir((0,l.dirname)(e),{recursive:!0}),await h.promises.writeFile(e,"")),t.commands.executeCommand("vscode.open",t.Uri.file(e))}class ii{constructor(){this._isDisposed=!1,this._disposables=[]}dispose(){this._isDisposed||(this._isDisposed=!0,function(t){for(;t.length;){const e=t.pop();e&&e.dispose()}}(this._disposables))}_register(t){return this._isDisposed?t.dispose():this._disposables.push(t),t}get isDisposed(){return this._isDisposed}}class ni{constructor(t,e){this.hostname=t,this.locations=e}}class oi{constructor(t,e){this.path=t,this.hostname=e}}class ai extends ii{constructor(e){super(),this.locationHistory=e,this._onDidChangeTreeData=this._register(new t.EventEmitter),this.onDidChangeTreeData=this._onDidChangeTreeData.event,this._register(t.commands.registerCommand("opensshremotes.addNewSshHost",(()=>si()))),this._register(t.commands.registerCommand("opensshremotes.explorer.refresh",(()=>this.refresh()))),this._register(t.commands.registerCommand("opensshremotes.explorer.emptyWindowInNewWindow",(t=>this.openRemoteSSHWindow(t,!1)))),this._register(t.commands.registerCommand("opensshremotes.explorer.emptyWindowInCurrentWindow",(t=>this.openRemoteSSHWindow(t,!0)))),this._register(t.commands.registerCommand("opensshremotes.explorer.reopenFolderInNewWindow",(t=>this.openRemoteSSHLocationWindow(t,!1)))),this._register(t.commands.registerCommand("opensshremotes.explorer.reopenFolderInCurrentWindow",(t=>this.openRemoteSSHLocationWindow(t,!0)))),this._register(t.commands.registerCommand("opensshremotes.explorer.deleteFolderHistoryItem",(t=>this.deleteHostLocation(t)))),this._register(t.workspace.onDidChangeConfiguration((t=>{t.affectsConfiguration("remote.SSH.configFile")&&this.refresh()}))),this._register(t.workspace.onDidSaveTextDocument((t=>{t.uri.fsPath===er()&&this.refresh()})))}getTreeItem(e){if(e instanceof oi){const s=l.posix.basename(e.path).replace(/\.code-workspace$/," (Workspace)"),r=new t.TreeItem(s);return r.description=l.posix.dirname(e.path),r.iconPath=new t.ThemeIcon("folder"),r.contextValue="opensshremotes.explorer.folder",r}const s=new t.TreeItem(e.hostname);return s.collapsibleState=e.locations.length?t.TreeItemCollapsibleState.Collapsed:t.TreeItemCollapsibleState.None,s.iconPath=new t.ThemeIcon("vm"),s.contextValue="opensshremotes.explorer.host",s}async getChildren(t){return t?t instanceof ni?t.locations.map((e=>new oi(e,t.hostname))):[]:(await hr.loadFromFS()).getAllConfiguredHosts().map((t=>new ni(t,this.locationHistory.getHistory(t))))}refresh(){this._onDidChangeTreeData.fire()}async deleteHostLocation(t){await this.locationHistory.removeLocation(t.hostname,t.path),this.refresh()}async openRemoteSSHWindow(t,e){ei(new o(t.hostname).toEncodedString(),e)}async openRemoteSSHLocationWindow(e,s){!function(e,s,r){t.commands.executeCommand("vscode.openFolder",t.Uri.from({scheme:"vscode-remote",authority:Zr(e),path:s}),{forceNewWindow:!r})}(new o(e.hostname).toEncodedString(),e.path,s)}}class hi{static{this.STORAGE_KEY="remoteLocationHistory_v0"}constructor(t){this.context=t,this.remoteLocationHistory={},this.remoteLocationHistory=t.globalState.get(hi.STORAGE_KEY)||{}}getHistory(t){return this.remoteLocationHistory[t]||[]}async addLocation(t,e){let s=this.remoteLocationHistory[t]||[];s.includes(e)||(s.unshift(e),this.remoteLocationHistory[t]=s,await this.context.globalState.update(hi.STORAGE_KEY,this.remoteLocationHistory))}async removeLocation(t,e){let s=this.remoteLocationHistory[t]||[];s=s.filter((t=>t!==e)),this.remoteLocationHistory[t]=s,await this.context.globalState.update(hi.STORAGE_KEY,this.remoteLocationHistory)}}async function li(e){const s=t.window.createOutputChannel("Remote - SSH",{log:!0});e.subscriptions.push(s);const r="ms-vscode-remote.remote-ssh",i="Anysphere Remote SSH";return await async function(){const n={stack:[],error:void 0,hasError:!1};try{const c=Nr(n,Br("cursor-remote-ssh.activate"),!1);try{const n=(async()=>{if(void 0!==t.extensions.getExtension(r)){const e="Uninstall & Restart Cursor",s="Ignore";if(await t.window.showWarningMessage(`In order to use ${i}, \`${r}\` must be uninstalled.`,e,s)!==e)throw t.window.showInformationMessage(`${i} has been disabled for this session.`),new Error(`${i} has been disabled for this session`);t.commands.executeCommand("workbench.extensions.uninstallExtension",r).then((()=>t.commands.executeCommand("workbench.action.reloadWindow")),(()=>t.commands.executeCommand("workbench.action.reloadWindow")))}const n=new Jr(e,s);e.subscriptions.push(t.workspace.registerRemoteAuthorityResolver(Kr,n)),e.subscriptions.push(n);const c=new hi(e),u=function(){let e=t.workspace.workspaceFile;if(e&&"vscode-remote"===e.scheme&&e.authority.startsWith(Kr)&&e.path.endsWith(".code-workspace")){const[,t]=e.authority.split("+");return[o.parseEncoded(t).hostname,e.path]}if(e=t.workspace.workspaceFolders?.[0].uri,e&&"vscode-remote"===e.scheme&&e.authority.startsWith(Kr)){const[,t]=e.authority.split("+");return[o.parseEncoded(t).hostname,e.path]}}();u&&await c.addLocation(u[0],u[1]);const d=new ai(c);e.subscriptions.push(t.window.createTreeView("sshHosts",{treeDataProvider:d})),e.subscriptions.push(d),e.subscriptions.push(t.commands.registerCommand("opensshremotes.openEmptyWindow",(()=>ti(!1)))),e.subscriptions.push(t.commands.registerCommand("opensshremotes.openEmptyWindowInCurrentWindow",(()=>ti(!0)))),e.subscriptions.push(t.commands.registerCommand("opensshremotes.openConfigFile",(()=>ri()))),e.subscriptions.push(t.commands.registerCommand("opensshremotes.showLog",(()=>s.show()))),e.subscriptions.push(t.commands.registerCommand("opensshremotes.killServerAndReload",(async()=>{void 0!==t.env.remoteAuthority?(await e.globalState.update(Yr(t.env.remoteAuthority),!0),await t.commands.executeCommand("workbench.action.reloadWindow")):await t.window.showErrorMessage("No remote authority found")}))),e.subscriptions.push(t.commands.registerCommand("opensshremotes.reinstallServerAndReload",(async()=>{void 0!==t.env.remoteAuthority?(await e.globalState.update(qr(t.env.remoteAuthority),!0),await t.commands.executeCommand("workbench.action.reloadWindow")):await t.window.showErrorMessage("No remote authority found")}))),e.subscriptions.push(t.commands.registerCommand("opensshremotes.triggerReconnect",(async()=>{void 0!==t.env.remoteAuthority?await n.killForwardingServers():await t.window.showErrorMessage("No remote authority found")}))),e.subscriptions.push(t.commands.registerCommand("opensshremotes.generateConnectionReport",(()=>async function(e,s){const r=await Qr();if(!r)return;s.show();const i=t.workspace.getConfiguration("remote.SSH").get("path","ssh"),{server:n,address:o}=await async function(e){const s=Lr.createServer((async(s,r)=>{if(e.info(`Askpass server received request: ${s.method} ${s.url}`),"POST"===s.method){let i="";for await(const t of s)i+=t.toString();e.info(`Askpass server received request body: ${i}`);try{const s=JSON.parse(i);if(e.info(`Received SSH askpass request: ${s.request}`),s.request.includes("The authenticity of host")&&s.request.includes("can't be established"))"Yes"===await t.window.showQuickPick(["Yes","No"],{title:s.request+" Do you want to trust this host?",placeHolder:"Yes"})?(r.writeHead(200,{"Content-Type":"text/plain"}),r.end("yes")):(r.writeHead(200,{"Content-Type":"text/plain"}),r.end("no"));else{const i=await t.window.showInputBox({title:s.request,password:!0,ignoreFocusOut:!0});void 0===i?(e.error("Password authentication cancelled"),r.writeHead(500,{"Content-Type":"text/plain"}),r.end("Password authentication cancelled")):(r.writeHead(200,{"Content-Type":"text/plain"}),r.end(i||""))}}catch(t){e.error(`Error parsing request: ${t}`),r.writeHead(400,{"Content-Type":"text/plain"}),r.end("Invalid request format")}}else r.writeHead(405,{"Content-Type":"text/plain"}),r.end("Method Not Allowed")})),r=new Promise(((t,r)=>{s.on("error",(t=>{e.error("SSH askpass server threw an error",t),r(t)})),s.on("listening",(()=>{const i=s.address();if(null!==i){if("string"==typeof i)return e.info(`SSH askpass server listening on ${i}`),void t(i);e.info(`SSH askpass server listening on port ${i.port}`),t(i.port.toString())}else r(new Error(`Invalid address: ${i}`))}))}));if(E)s.listen(0,"127.0.0.1");else{const t=await h.promises.mkdtemp(l.join(a.tmpdir(),"cursor-ssh-")),e=l.join(t,"socket.sock");s.listen(e)}return{server:s,address:await r}}(s);let c=[],u=[];try{await t.window.withProgress({location:t.ProgressLocation.Notification,title:"Generating connection report...",cancellable:!1},(async()=>{const n=t.workspace.getConfiguration("remote.SSH"),a=new Ar(s,{sshPath:i,destination:r.toConnectionString(),host:r.hostname});if(await yr({extensionConfig:n,host:a.config.host,logger:s,shouldPrompt:!0})===wr.Windows)return void t.window.showErrorMessage("Connection reports are not supported on Windows remote hosts");s.info(`Generating connection report for ${r}...`);const h=gr(e.extensionPath),d=Er(e.extensionPath),p=(f=e.extensionPath,l.join(f,"dist","scripts","connectionReport.sh"));var f;const m=void 0!==(await hr.loadFromFS()).getHostConfiguration(r.hostname).RemoteCommand,g=Ir(n.get("httpProxy"),a.config.host),S=Ir(n.get("httpsProxy"),a.config.host),w=Ir(n.get("noProxy"),a.config.host),v={...process.env,SSH_ASKPASS:h,CURSOR_SSH_ASKPASS_JS:d,CURSOR_SSH_ASKPASS_HANDLE:o,SSH_ASKPASS_REQUIRE:"force",CURSOR_SSH_ELECTRON_PATH:process.execPath,DISPLAY:"1"};let R;g&&(v.HTTP_PROXY=g,v.http_proxy=g),S&&(v.HTTPS_PROXY=S,v.https_proxy=S),w&&(v.NO_PROXY=w,v.no_proxy=w),R=E?`type "${p}" | `:`cat "${p}" | `;const{process:y}=await a.execHandler({hasRemoteCommand:m,command:"bash --login -c bash 2>&1",shellCmdPrefix:R,env:v});y.stdout.on("data",(t=>{c.push(t.toString())})),y.stderr.on("data",(t=>{u.push(`[${(new Date).toISOString()}] ${t.toString()}`),s.info("[connectionReport][ssh] "+t.toString())})),await new Promise(((t,e)=>{y.on("error",(t=>{s.error("Failed to generate connection report",t),e(t)})),y.on("close",(r=>{0!==r&&(s.error(`Process exited with code ${r} `),e(new Error(`Process exited with code ${r} `))),s.info("Connection report completed."),t()}))}))}))}catch(e){s.error("Failed to generate connection report",e),await t.window.showErrorMessage("Failed to generate connection report -- please check the logs")}finally{n.close()}const d=`Cursor Remote SSH Connection Diagnostic Report - ${r.hostname}\nGenerated on: ${(new Date).toISOString()}\n\n****************************************************************************\n* WARNING: This report may contain sensitive information.                  *\n* Please review and redact any sensitive information before sharing.       *\n****************************************************************************\n`+c.join("")+"\n\n\n Raw SSH logs:\n"+u.join(""),p=await t.workspace.openTextDocument({content:d,language:"plaintext"});await t.window.showTextDocument(p)}(e,s))))})();return n instanceof Promise&&await n,c.setAttribute("success",!0),n}catch(t){throw c.setError(t instanceof Error?t.message:String(t)),c.setAttribute("success",!1),t}}catch(t){n.error=t,n.hasError=!0}finally{Pr(n)}}()}function ci(){}})(),module.exports=n})();